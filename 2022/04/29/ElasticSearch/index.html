<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CMicrosoft+YaHei:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CMonaco:300,300italic,400,400italic,700,700italic%7CMenlo:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ssssv11.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="ElasticSearch">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch">
<meta property="og:url" content="https://ssssv11.github.io/2022/04/29/ElasticSearch/index.html">
<meta property="og:site_name" content="Ssssv">
<meta property="og:description" content="ElasticSearch">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/23/LfaZtI.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/23/LfTNP1.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/23/LfTLR0.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/23/Lf7ndH.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/26/L77Xss.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/26/L7qMKH.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/26/L7LdfK.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/26/L7LTmj.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/04/26/LHAlp4.png">
<meta property="article:published_time" content="2022-04-29T13:49:53.721Z">
<meta property="article:modified_time" content="2022-04-29T13:49:57.582Z">
<meta property="article:author" content="Ssssv11">
<meta property="article:tag" content="中间件">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/04/23/LfaZtI.png">


<link rel="canonical" href="https://ssssv11.github.io/2022/04/29/ElasticSearch/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>ElasticSearch | Ssssv</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Ssssv</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">23</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">39</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E4%B8%8E-Solr"><span class="nav-number">1.2.</span> <span class="nav-text">ES 与 Solr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="nav-number">1.3.</span> <span class="nav-text">倒排索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Windows"><span class="nav-number">1.4.1.</span> <span class="nav-text">Windows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux"><span class="nav-number">1.4.2.</span> <span class="nav-text">Linux</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">1.5.</span> <span class="nav-text">ES 的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Index-%E7%B4%A2%E5%BC%95"><span class="nav-number">1.5.1.</span> <span class="nav-text">Index 索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Type-%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.5.2.</span> <span class="nav-text">Type 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Doc-%E6%96%87%E6%A1%A3"><span class="nav-number">1.5.3.</span> <span class="nav-text">Doc 文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Field-%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.4.</span> <span class="nav-text">Field 属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ES-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">ES 的基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E7%9A%84-RESTful-%E9%A3%8E%E6%A0%BC"><span class="nav-number">2.1.</span> <span class="nav-text">ES 的 RESTful 风格</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GET-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.1.</span> <span class="nav-text">GET 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#POST-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.2.</span> <span class="nav-text">POST 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PUT-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.3.</span> <span class="nav-text">PUT 请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DELETE-%E8%AF%B7%E6%B1%82"><span class="nav-number">2.1.4.</span> <span class="nav-text">DELETE 请求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">2.2.</span> <span class="nav-text">ES 索引的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-number">2.2.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.2.</span> <span class="nav-text">查看索引信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="nav-number">2.2.3.</span> <span class="nav-text">删除索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E4%B8%AD-Field-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.3.</span> <span class="nav-text">ES 中 Field 的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#String"><span class="nav-number">2.3.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Numbers"><span class="nav-number">2.3.2.</span> <span class="nav-text">Numbers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Date"><span class="nav-number">2.3.3.</span> <span class="nav-text">Date</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Boolean"><span class="nav-number">2.3.4.</span> <span class="nav-text">Boolean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Binary"><span class="nav-number">2.3.5.</span> <span class="nav-text">Binary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alias"><span class="nav-number">2.3.6.</span> <span class="nav-text">Alias</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Range"><span class="nav-number">2.3.7.</span> <span class="nav-text">Range</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GEO"><span class="nav-number">2.3.8.</span> <span class="nav-text">GEO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP"><span class="nav-number">2.3.9.</span> <span class="nav-text">IP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.4.</span> <span class="nav-text">ES 指定数据结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-%E6%96%87%E6%A1%A3%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">2.5.</span> <span class="nav-text">ES 文档的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="nav-number">2.5.1.</span> <span class="nav-text">新建文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="nav-number">2.5.2.</span> <span class="nav-text">修改文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="nav-number">2.5.3.</span> <span class="nav-text">删除文档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Java-%E6%93%8D%E4%BD%9C-ES"><span class="nav-number">3.</span> <span class="nav-text">Java 操作 ES</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">3.1.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.</span> <span class="nav-text">Java 操作索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">删除索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="nav-number">3.3.</span> <span class="nav-text">Java 操作文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="nav-number">3.3.1.</span> <span class="nav-text">创建文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">修改文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">删除文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E5%A4%84%E7%90%86"><span class="nav-number">3.3.4.</span> <span class="nav-text">批处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ES-%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="nav-number">4.</span> <span class="nav-text">ES 的查询操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#term-amp-terms-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.1.</span> <span class="nav-text">term &amp; terms 查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#term"><span class="nav-number">4.1.1.</span> <span class="nav-text">term</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#terms"><span class="nav-number">4.1.2.</span> <span class="nav-text">terms</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#match-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.2.</span> <span class="nav-text">match 查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#match-all"><span class="nav-number">4.2.1.</span> <span class="nav-text">match_all</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#match"><span class="nav-number">4.2.2.</span> <span class="nav-text">match</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Boolean-match"><span class="nav-number">4.2.3.</span> <span class="nav-text">Boolean match</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multi-match"><span class="nav-number">4.2.4.</span> <span class="nav-text">multi_match</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#id-amp-ids-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.3.</span> <span class="nav-text">id &amp; ids 查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#id"><span class="nav-number">4.3.1.</span> <span class="nav-text">id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ids"><span class="nav-number">4.3.2.</span> <span class="nav-text">ids</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#prefix-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.4.</span> <span class="nav-text">prefix 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fuzzy-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.5.</span> <span class="nav-text">fuzzy 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wildcard-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.6.</span> <span class="nav-text">wildcard 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#range-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.7.</span> <span class="nav-text">range 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#regexp-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.8.</span> <span class="nav-text">regexp 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scroll-%E5%88%86%E9%A1%B5"><span class="nav-number">4.9.</span> <span class="nav-text">scroll 分页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#delete-by-query-%E5%88%A0%E9%99%A4"><span class="nav-number">4.10.</span> <span class="nav-text">delete_by_query 删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.11.</span> <span class="nav-text">复合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bool-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.11.1.</span> <span class="nav-text">bool 查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#boosting-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.11.2.</span> <span class="nav-text">boosting 查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#filter-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.12.</span> <span class="nav-text">filter 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#highlight-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.13.</span> <span class="nav-text">highlight 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.14.</span> <span class="nav-text">聚合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cardinality-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.14.1.</span> <span class="nav-text">cardinality 查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot-%E9%9B%86%E6%88%90-ES"><span class="nav-number">5.</span> <span class="nav-text">SpringBoot 集成 ES</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ssssv11"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">Ssssv11</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Ssssv11" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Ssssv11" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ssssv11.github.io/2022/04/29/ElasticSearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Ssssv11">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ssssv">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ElasticSearch
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-29 21:49:53 / Modified: 21:49:57" itemprop="dateCreated datePublished" datetime="2022-04-29T21:49:53+08:00">2022-04-29</time>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <center>ElasticSearch</center>

<span id="more"></span>

<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Elasticsearch(ES) 是一个基于 <strong>Lucene</strong> 的搜索服务器。它提供了一个分布式多用户能力的<strong>全文检索引擎</strong>，基于 RESTful web 接口。Elasticsearch 是用 Java 语言开发的，并作为 Apache 许可条款下的开放源码发布，是一种流行的企业级搜索引擎。Elasticsearch 用于云计算中能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<blockquote>
<p><strong>Lucene</strong></p>
<p>Lucene 是 apache 软件基金会 jakarta 项目组的一个子项目，是一个开源的全文检索引擎工具包，但它不是一个完整的全文检索引擎，而是一个全文检索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎</p>
<p><strong>全文检索</strong></p>
<p>将一段句子进行分词，并且将分出的单个词语统一的放到一个分词库中，在搜索时根据关键字<br>去分词库中检索，找到匹配的内容。</p>
</blockquote>
<p>在平时进行搜索时会发现搜索出来的结果数量十分庞大且搜索时的关键词可以不准确。在 MySQL 中的模糊查询很难达到高效地搜索出想要的结果，因此我们需要使用 ES。</p>
<br/>

<h2 id="ES-与-Solr"><a href="#ES-与-Solr" class="headerlink" title="ES 与 Solr"></a>ES 与 Solr</h2><blockquote>
<p>Solr 是一个独立的企业级搜索应用服务器，它对外提供类似于 Web-service 的 API 接口。用户可以通过 http 请求，向搜索引擎服务器提交一定格式的 XML 文件，生成索引；也可以通过 Http Get 操作提出查找请求，并得到 XML 格式的返回结果。</p>
</blockquote>
<p><strong>区别</strong></p>
<ul>
<li>效率</li>
<li><ul>
<li>当对已有数据进行搜索时，Solr 比 ES 更快。</li>
<li>当数据是实时变化时，Solr 的查询速度会降低很多，ES 的查询速度基本没有变化</li>
</ul>
</li>
<li>集群</li>
<li><ul>
<li>Solr 搭建集群需要依赖于 ZooKeeper 的管理</li>
<li>ES 本身就支持集群的搭建，自带分布式协调管理功能，不需要依赖第三方件</li>
</ul>
</li>
<li>格式</li>
<li><ul>
<li>Solr 支持更多格式的数据，如JSON、XML、CSV</li>
<li>ES 仅支持 JSON 文件格式</li>
</ul>
</li>
</ul>
<br/>

<h2 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h2><p>倒排索引又叫反向索引(inverted index)</p>
<p>当用户发起查询时（假设查询为一个关键词），搜索引擎会扫描索引库中的所有文档，找出所有包含关键词的文档，这样依次从文档中去查找是否含有关键词的方法叫做正向索引。互联网上存在的网页（或称文档）不计其数，这样遍历的索引结构效率低下，无法满足用户需求。</p>
<p>为了增加效率，搜索引擎会把正向索引变为反向索引（倒排索引）即把 “文档 → 单词” 的形式变为 “单词 → 文档” 的形式。</p>
<p><strong>倒排索引(Inverted Index)</strong></p>
<p>倒排索引是实现“单词-文档矩阵”的一种具体存储形式，通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。倒排索引主要由两个部分组成：”单词词典”和”倒排文件”。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/LfaZtI"><img src="https://s1.ax1x.com/2022/04/23/LfaZtI.png" alt="LfaZtI.png"></a></p>
<p><strong>实例</strong></p>
<p>比如在文件中有句子：</p>
<ol>
<li>Java YYDS</li>
<li>Java 真简单</li>
<li>Java 好</li>
<li>ES 好用，YYDS</li>
</ol>
<p>那么单词词典可能为：</p>
<table>
<thead>
<tr>
<th align="center">单词ID</th>
<th align="center">单词</th>
<th align="center">文件ID</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Java</td>
<td align="center">1，2，3</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">YYDS</td>
<td align="center">1，4</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Java YYDS</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">真简单</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">好</td>
<td align="center">3，4</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">ES</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">好用</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">…</td>
<td align="center">…</td>
<td align="center">…</td>
</tr>
</tbody></table>
<p><strong>过程</strong></p>
<ul>
<li>首先将存放的数据以一定的方式进行分词，并且将分词的内容存放到一个单独的分词库中</li>
<li>当用户查询数据时，将用户的查询关键字进行分词</li>
<li>在分词库中匹配内容，得到数据的 ID 标识</li>
<li>根据 ID 标识在文件中拉取指定的数据</li>
</ul>
<br/>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>官网: <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/start">https://www.elastic.co/cn/start</a></p>
<p><strong>elasticsearch</strong></p>
<p>下载后修改 <code>elasticsearch-8.1.3\config\jvm.options</code> 中的配置:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms512m</span><br><span class="line">-Xmx512m</span><br></pre></td></tr></table></figure>

<p>开启服务 <code>elasticsearch-8.1.3\bin\elasticsearch.bat</code>，进入 localhost:9200 页面出现界面：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/LfTNP1"><img src="https://s1.ax1x.com/2022/04/23/LfTNP1.png" alt="LfTNP1.png"></a></p>
<p>代表安装成功。</p>
<br/>

<p><strong>elasticsearch-head</strong></p>
<p>下载 ES 可视化工具 elasticsearch-head :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mobz/elasticsearch-head.git</span><br></pre></td></tr></table></figure>

<p>进入 elasticsearch-head 目录执行:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> install</span><br><span class="line"><span class="built_in">npm</span> run start</span><br></pre></td></tr></table></figure>

<p>访问 <code>localhost:9100</code> 就可以访问到可视化界面</p>
<p>解决跨域问题:</p>
<p>修改 <code>elasticsearch-8.1.3\config\elasticsearch.yml</code> 文件:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Enable security features</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">xpack.security.enrollment.enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents</span></span><br><span class="line"><span class="attr">xpack.security.http.ssl:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">keystore.path:</span> <span class="string">certs/http.p12</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">http:</span> </span><br><span class="line">  <span class="attr">cors:</span> </span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<p>再开启 elasticsearch 服务后访问 localhost：9100 即可进入可视化界面：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/LfTLR0"><img src="https://s1.ax1x.com/2022/04/23/LfTLR0.png" alt="LfTLR0.png"></a></p>
<br/>

<p><strong>kibana</strong></p>
<p>修改 <code>kibana-8.1.3\config\kibana.yml</code> 配置:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>

<p>运行 <code>kibana-8.1.3\bin\kibana.bat</code> 访问 localhost:5601 界面：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/Lf7ndH"><img src="https://s1.ax1x.com/2022/04/23/Lf7ndH.png" alt="Lf7ndH.png"></a></p>
<br/>

<p><strong>IK</strong></p>
<p>下载地址: <a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>
<p>解压到 elasticsearch 安装目录plugin目录中后重启 ES，打开kibana：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我爱学习&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">GET _analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我爱学习&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;我&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;爱学习&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;我&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;爱学习&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;学习&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span> <span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>安装 IK 可能会出现的问题：</p>
<ul>
<li><p>IK 版本号与 ES 不符合</p>
<p>在 IK 文件夹中修改 plugin-descriptor.properties 文件中  <code>version</code> 和 <code>elasticsearch.version</code> 为相应版本即可。</p>
</li>
<li><p>Exception in thread “main” java.nio.file.NotDirectoryException: &#x2F;Library&#x2F;ElasticSearch&#x2F;plugins&#x2F;.DS_Store</p>
<p>cd 进入 es 的 plugins 目录，使用 <code>ls -a</code> 查看所有目录，使用 <code>rm DS_Store</code> 删除隐藏的 DS_Store 目录</p>
</li>
</ul>
<br/>

<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>docker-compose.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span> </span><br><span class="line">  <span class="attr">image:</span> <span class="string">daocloud.io/library/elasticsearch:7.8.0</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/kibana:7.8.0</span></span><br><span class="line">  	<span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  	<span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">  	<span class="attr">ports:</span></span><br><span class="line">  	  <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line">  	<span class="attr">environment:</span></span><br><span class="line">  	  <span class="bullet">-</span> <span class="string">elasticsearch_url=http:ip:9200</span></span><br><span class="line">  	<span class="attr">depends_on:</span></span><br><span class="line">  	  <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<br>

<h2 id="ES-的结构"><a href="#ES-的结构" class="headerlink" title="ES 的结构"></a>ES 的结构</h2><h3 id="Index-索引"><a href="#Index-索引" class="headerlink" title="Index 索引"></a>Index 索引</h3><p>在 ES 的服务中可以创建多个索引，每一个索引默认被分为 5片，每一个分片都会存在至少一个备份分片。</p>
<p>备份分片不会帮助检索数据，当 ES 检索压力特别大时才会帮助检索数据。备份的分片必须放在不同的服务器中。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/L77Xss"><img src="https://s1.ax1x.com/2022/04/26/L77Xss.png" alt="L77Xss.png"></a></p>
<br/>

<h3 id="Type-类型"><a href="#Type-类型" class="headerlink" title="Type 类型"></a>Type 类型</h3><p>一个索引下可以创建多个类型。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/L7qMKH"><img src="https://s1.ax1x.com/2022/04/26/L7qMKH.png" alt="L7qMKH.png"></a></p>
<p><strong>注意：</strong></p>
<ul>
<li>在 ES 5.x 版本中，一个 Index 下可以创建多个 Type</li>
<li>在 ES 6.x 版本中，一个 Index 下可以创建一个 Type</li>
<li>在 ES 7.x 版本后则不支持 Type</li>
</ul>
<br>

<h3 id="Doc-文档"><a href="#Doc-文档" class="headerlink" title="Doc 文档"></a>Doc 文档</h3><p>一个类型下可以有多个文档。相当于MySQL表中的多行数据</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/L7LdfK"><img src="https://s1.ax1x.com/2022/04/26/L7LdfK.png" alt="L7LdfK.png"></a></p>
<br/>

<h3 id="Field-属性"><a href="#Field-属性" class="headerlink" title="Field 属性"></a>Field 属性</h3><p>一个文档中可以包含多个属性。</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/L7LTmj"><img src="https://s1.ax1x.com/2022/04/26/L7LTmj.png" alt="L7LTmj.png"></a></p>
<br/>

<h1 id="ES-的基本操作"><a href="#ES-的基本操作" class="headerlink" title="ES 的基本操作"></a>ES 的基本操作</h1><h2 id="ES-的-RESTful-风格"><a href="#ES-的-RESTful-风格" class="headerlink" title="ES 的 RESTful 风格"></a>ES 的 RESTful 风格</h2><h3 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h3><ul>
<li>查询索引信息：http:ip:port&#x2F;index</li>
<li>查询指导文档信息：http:ip:port&#x2F;index&#x2F;type&#x2F;doc_id</li>
</ul>
<h3 id="POST-请求"><a href="#POST-请求" class="headerlink" title="POST 请求"></a>POST 请求</h3><ul>
<li><p>查询文档：http:ip:port&#x2F;index&#x2F;type&#x2F;_search</p>
<p>在请求体中添加 JSON 字符串来代表查询条件</p>
</li>
<li><p>修改文档：http:ip:port&#x2F;index&#x2F;doc_id&#x2F;_update</p>
<p>在请求体中添加 JSON 字符串来代表修改的具体信息</p>
</li>
</ul>
<h3 id="PUT-请求"><a href="#PUT-请求" class="headerlink" title="PUT 请求"></a>PUT 请求</h3><ul>
<li><p>创建索引：http:ip:port&#x2F;index</p>
<p>在请求体中指导索引的信息</p>
</li>
<li><p>创建索引时指定索引的类型及文档属性信息：http:ip:port&#x2F;index&#x2F;type&#x2F;_mappings</p>
</li>
</ul>
<h3 id="DELETE-请求"><a href="#DELETE-请求" class="headerlink" title="DELETE 请求"></a>DELETE 请求</h3><ul>
<li>删除所有：http:ip:port&#x2F;index</li>
<li>删除指定文档：http:ip:port&#x2F;index&#x2F;type&#x2F;doc_id</li>
</ul>
<br/>

<h2 id="ES-索引的操作"><a href="#ES-索引的操作" class="headerlink" title="ES 索引的操作"></a>ES 索引的操作</h2><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT /person</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;person&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看索引信息"><a href="#查看索引信息" class="headerlink" title="查看索引信息"></a>查看索引信息</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET /person</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;person&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;routing&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;allocation&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;include&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;_tier_preference&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;data_content&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;provided_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;person&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;creation_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1650961791806&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8V_k19znTDWyqzPY8phJug&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;created&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8010399&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>也可以在 Kibana 中进入 Stack Management 中的索引管理来查看：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/LHAlp4"><img src="https://s1.ax1x.com/2022/04/26/LHAlp4.png" alt="LHAlp4.png"></a></p>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DELETE /person</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>同样在图形化界面可以很方便的删除索引</p>
<br/>

<h2 id="ES-中-Field-的数据类型"><a href="#ES-中-Field-的数据类型" class="headerlink" title="ES 中 Field 的数据类型"></a>ES 中 Field 的数据类型</h2><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul>
<li><p>text</p>
<p>将当前 Field 进行分词，一般用于全文检索。</p>
</li>
<li><p>keyword</p>
<p>不会将当前 Filed 进行分词</p>
</li>
</ul>
<h3 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h3><ul>
<li><p>long</p>
</li>
<li><p>integer</p>
</li>
<li><p>short</p>
</li>
<li><p>byte</p>
</li>
<li><p>double</p>
</li>
<li><p>float</p>
</li>
<li><p>half_float</p>
</li>
<li><p>scaled_float</p>
<p>根据一个 long 和 scaled 来表示一个浮点数：long &#x3D; 345, scaled &#x3D; 100  –&gt;  3.45</p>
</li>
<li><p>unsigned_long</p>
</li>
</ul>
<h3 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h3><ul>
<li><p>date</p>
<p>以毫秒存储，可以指定具体的格式：<code>yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_milli</code></p>
</li>
<li><p>date-nanos</p>
<p>以纳秒存储，格式同 date</p>
</li>
</ul>
<h3 id="Boolean"><a href="#Boolean" class="headerlink" title="Boolean"></a>Boolean</h3><ul>
<li>boolean</li>
</ul>
<h3 id="Binary"><a href="#Binary" class="headerlink" title="Binary"></a>Binary</h3><ul>
<li><p>binary</p>
<p>支持基于 Base64 编码的字符串</p>
</li>
</ul>
<h3 id="Alias"><a href="#Alias" class="headerlink" title="Alias"></a>Alias</h3><ul>
<li><p>alias</p>
<p>可以为 filed 指定别名，可以用来代替搜索请求中的目标(target)字段</p>
</li>
</ul>
<h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a>Range</h3><p>在赋值时无需指定具体的内容，只需要指定存储一个范围即可：gt、lt、gte、lte</p>
<ul>
<li><p>integer_range</p>
</li>
<li><p>float_range</p>
</li>
<li><p>long_range</p>
</li>
<li><p>double_range</p>
</li>
<li><p>date_range</p>
</li>
<li><p>ip_range</p>
</li>
</ul>
<h3 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h3><ul>
<li><p>geo_point</p>
<p>用于存储经纬度，即坐标点</p>
</li>
<li><p>geo_shape</p>
<p>用于存储复杂的地理形状</p>
</li>
</ul>
<h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><ul>
<li><p>ip</p>
<p>用于存储 ipv4 或 ipv6</p>
</li>
</ul>
<p>更多数据类型可以参考<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">官方文档</a></p>
<br>

<h2 id="ES-指定数据结构"><a href="#ES-指定数据结构" class="headerlink" title="ES 指定数据结构"></a>ES 指定数据结构</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PUT /book</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span>					<span class="comment">// 分片数</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="number">1</span>					<span class="comment">// 备份数</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>											<span class="comment">// 指定数据结构</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>									<span class="comment">// 属性</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>											<span class="comment">// 属性名1</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span>							<span class="comment">// 属性1 类型</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span>	<span class="comment">// 指定分词器</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span>							<span class="comment">// 设置当前 Field 可以作为查询条件</span></span><br><span class="line">        <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span>							<span class="comment">// 设置是否需要额外存储</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;onSale&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&quot;</span>		<span class="comment">// 时间类型指定格式化方式</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;descr&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="ES-文档的操作"><a href="#ES-文档的操作" class="headerlink" title="ES 文档的操作"></a>ES 文档的操作</h2><blockquote>
<p>ES 文档在 ES 服务中的唯一标识：<code>_index(索引)</code> <code>_id</code>  为组合来锁定一个文档</p>
</blockquote>
<h3 id="新建文档"><a href="#新建文档" class="headerlink" title="新建文档"></a>新建文档</h3><p><strong>自动生成 ID</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_doc</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Java&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;W.K&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-26&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;descr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Java从入门到放弃&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;vRuBZYAB2IoWYOLtwDpW&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>发现 ID 是自动生成的很长很乱，不便于我们后续操作</p>
<p><strong>注意：在 Elastic Search 7.x 之后就不支持 type 了，可以使用 _doc 来指定索引中的文档</strong></p>
<p><strong>手动指定 ID</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MySQL&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XXX&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">10928</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-26&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;descr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MySQL从入门到入牢&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>发现 ID 是我们在请求体中指定的</p>
<br>

<h3 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h3><p><strong>覆盖式修改</strong></p>
<p>与指定 ID 的新建文档相似，覆盖式修改文档即若该 ID 存在，则创建一个文档来覆盖已存在的文档</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MySQL&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XXX&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">15000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;onSale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-26&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;descr&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MySQL从入门到入牢&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;updated&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看出用这种方式来修改文档的话会十分不方便，只需要修改一个属性也需要写出其他属性和值</p>
<p><strong>_doc方式修改</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_update/<span class="number">1</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;doc&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XY&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">12000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;updated&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以发现使用 _doc 方式修改只需要指定需要修改的属性及其值</p>
<br>

<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELETE /book/_doc/vRuBZYAB2IoWYOLtwDpW</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;vRuBZYAB2IoWYOLtwDpW&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;deleted&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<br>

<h1 id="Java-操作-ES"><a href="#Java-操作-ES" class="headerlink" title="Java 操作 ES"></a>Java 操作 ES</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p><strong>创建 Maven 项目 导入依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- elasticsearch --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- elasticsearch-java --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>co.elastic.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- JUnit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"> 	  <span class="comment">&lt;!-- JackSon --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：在 ElasticSearch 8.x 后 RestHighLevelClient 被弃用，新版本中使用全新的 Java 客户端 Elasticsearch Java API Client</strong></p>
<br>

<p><strong>创建连接</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestClient <span class="title function_">getRestClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RestClient.builder(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>)</span><br><span class="line">        ).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnection</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    System.out.println(client);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Java-操作索引"><a href="#Java-操作索引" class="headerlink" title="Java 操作索引"></a>Java 操作索引</h2><h3 id="创建索引-1"><a href="#创建索引-1" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建客户端</span></span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用JackSon映射器创建传输层</span></span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">      restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建API客户端</span></span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建索引</span></span><br><span class="line">    <span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span> <span class="operator">=</span> client.indices().create(c -&gt; c.index(<span class="string">&quot;person&quot;</span>)</span><br><span class="line">                .settings(s -&gt; s.numberOfReplicas(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                        .numberOfShards(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应状态</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">acknowledged</span> <span class="operator">=</span> createIndexResponse.acknowledged();</span><br><span class="line">    System.out.println(<span class="string">&quot;索引操作 = &quot;</span> + acknowledged);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭ES客户端</span></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="删除索引-1"><a href="#删除索引-1" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 创建客户端</span></span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用JackSon映射器创建传输层</span></span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建API客户端</span></span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查索引是否存在</span></span><br><span class="line">    System.out.println(client.indices().exists(e -&gt; e.index(<span class="string">&quot;person&quot;</span>)).value());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除索引</span></span><br><span class="line">    System.out.println(client.indices().delete(e -&gt; e.index(<span class="string">&quot;person&quot;</span>)).acknowledged());</span><br><span class="line">  </span><br><span class="line">  	transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当索引不存在时会抛出异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span></span><br><span class="line"></span><br><span class="line">co.elastic.clients.elasticsearch._types.ElasticsearchException: [es/indices.delete] failed: [index_not_found_exception] no such index [person]</span><br><span class="line"></span><br><span class="line">	at co.elastic.clients.transport.rest_client.RestClientTransport.getHighLevelResponse(RestClientTransport.java:<span class="number">281</span>)</span><br><span class="line">	at co.elastic.clients.transport.rest_client.RestClientTransport.performRequest(RestClientTransport.java:<span class="number">147</span>)</span><br><span class="line">	at co.elastic.clients.elasticsearch.indices.ElasticsearchIndicesClient.delete(ElasticsearchIndicesClient.java:<span class="number">382</span>)</span><br><span class="line">	at co.elastic.clients.elasticsearch.indices.ElasticsearchIndicesClient.delete(ElasticsearchIndicesClient.java:<span class="number">398</span>)</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Java-操作文档"><a href="#Java-操作文档" class="headerlink" title="Java 操作文档"></a>Java 操作文档</h2><h3 id="创建文档"><a href="#创建文档" class="headerlink" title="创建文档"></a>创建文档</h3><p><strong>实体类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@JsonIgnore</span>																	<span class="comment">// 忽略 ID</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span>					<span class="comment">// 指定日期格式</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1001</span>, <span class="string">&quot;xiaoA&quot;</span>, <span class="number">22</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="comment">// 添加数据</span></span><br><span class="line">    <span class="type">CreateResponse</span> <span class="variable">createResponse</span> <span class="operator">=</span> client.create(e -&gt; e.index(<span class="string">&quot;person&quot;</span>).id(person.getId()+<span class="string">&quot;&quot;</span>).document(person));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;createResponse.result() = &quot;</span> + createResponse.result());</span><br><span class="line"></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 ES 8.x 中可以直接穿入对象</p>
<ul>
<li>index：索引名</li>
<li>id：文档的 ID</li>
<li>document：文档数据</li>
</ul>
<br>

<h3 id="修改文档-1"><a href="#修改文档-1" class="headerlink" title="修改文档"></a>修改文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用map集合封装需要修改的内容</span></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;newXiaoA&quot;</span>);</span><br><span class="line">    <span class="comment">// 构建请求</span></span><br><span class="line">    UpdateResponse&lt;Person&gt; updateResponse = client.update(e -&gt; e.index(<span class="string">&quot;person&quot;</span>).id(<span class="string">&quot;1001&quot;</span>).doc(map), Person.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;updateResponse.result() = &quot;</span> + updateResponse.result());</span><br><span class="line"></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="删除文档-1"><a href="#删除文档-1" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建请求</span></span><br><span class="line">    <span class="type">DeleteResponse</span> <span class="variable">deleteResponse</span> <span class="operator">=</span> client.delete(e -&gt; e.index(<span class="string">&quot;person&quot;</span>).id(<span class="string">&quot;1001&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;deleteResponse.result() = &quot;</span> + deleteResponse.result());</span><br><span class="line"></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h3><p><strong>批量添加</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBatchCreateDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建一个批量数据集合</span></span><br><span class="line">    List&lt;BulkOperation&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">            d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1002</span>, <span class="string">&quot;xiaoB&quot;</span>, <span class="number">20</span>, <span class="keyword">new</span> <span class="title class_">Date</span>())).id(<span class="string">&quot;1002&quot;</span>).index(<span class="string">&quot;person&quot;</span>)).build());</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">            d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1003</span>, <span class="string">&quot;xiaoC&quot;</span>, <span class="number">21</span>, <span class="keyword">new</span> <span class="title class_">Date</span>())).id(<span class="string">&quot;1003&quot;</span>).index(<span class="string">&quot;person&quot;</span>)).build());</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">            d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="number">1004</span>, <span class="string">&quot;xiaoD&quot;</span>, <span class="number">24</span>, <span class="keyword">new</span> <span class="title class_">Date</span>())).id(<span class="string">&quot;1004&quot;</span>).index(<span class="string">&quot;person&quot;</span>)).build());</span><br><span class="line">    <span class="comment">// 调用bulk方法执行批量插入操作</span></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(e -&gt; e.index(<span class="string">&quot;person&quot;</span>).operations(list));</span><br><span class="line">    System.out.println(<span class="string">&quot;bulkResponse.items() = &quot;</span> + bulkResponse.items());</span><br><span class="line"></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>批量添加的核心是需要构建一个泛型为 <code>BulkOperation</code> 的 <code>ArrayList</code> 集合，实质上是将多个请求包装到一个集合中，进行统一请求，进行构建请求时调用 <code>bulk</code> 方法，实现批量添加效果。</p>
<p><strong>批量删除</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBatchDeleteDoc</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构建一个批量数据集合</span></span><br><span class="line">    List&lt;BulkOperation&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().delete(</span><br><span class="line">            d -&gt; d.id(<span class="string">&quot;1003&quot;</span>).index(<span class="string">&quot;person&quot;</span>)).build());</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().delete(</span><br><span class="line">            d -&gt; d.id(<span class="string">&quot;1004&quot;</span>).index(<span class="string">&quot;person&quot;</span>)).build());</span><br><span class="line">    <span class="comment">// 调用bulk方法执行批量插入操作</span></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(e -&gt; e.index(<span class="string">&quot;person&quot;</span>).operations(list));</span><br><span class="line">    System.out.println(<span class="string">&quot;bulkResponse.items() = &quot;</span> + bulkResponse.items());</span><br><span class="line"></span><br><span class="line">    transport.close();</span><br><span class="line">    restClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h1 id="ES-的查询操作"><a href="#ES-的查询操作" class="headerlink" title="ES 的查询操作"></a>ES 的查询操作</h1><p>准备数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsLogs</span> &#123;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String ID;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date sendDate;</span><br><span class="line">    <span class="keyword">private</span> String longCode;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String corpName;</span><br><span class="line">    <span class="keyword">private</span> String smsContent;</span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="keyword">private</span> Integer operatorId;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="keyword">private</span> Integer fee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSms</span> &#123;</span><br><span class="line">    <span class="type">RestClient</span> <span class="variable">restClient</span> <span class="operator">=</span> ESClient.getRestClient();</span><br><span class="line">    <span class="type">ElasticsearchTransport</span> <span class="variable">transport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(</span><br><span class="line">            restClient, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>()</span><br><span class="line">    );</span><br><span class="line">    <span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(transport);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createSmsIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(</span><br><span class="line">                client.indices().create(c -&gt; c.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                        .settings(s -&gt; s.numberOfReplicas(<span class="string">&quot;1&quot;</span>).numberOfShards(<span class="string">&quot;3&quot;</span>))</span><br><span class="line">        ).acknowledged());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTestData</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        List&lt;BulkOperation&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1000&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10690000&quot;</span>, <span class="string">&quot;17800000000&quot;</span>, <span class="string">&quot;美团外卖&quot;</span>, <span class="string">&quot;您的外卖已送达，请及时取走&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;深圳&quot;</span>, <span class="string">&quot;192.168.0.0&quot;</span>, <span class="number">2</span>)).id(<span class="string">&quot;1000&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1001&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10698888&quot;</span>, <span class="string">&quot;17800001111&quot;</span>, <span class="string">&quot;滴滴打车&quot;</span>, <span class="string">&quot;打车优惠券速来领取&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;四川&quot;</span>, <span class="string">&quot;192.168.0.1&quot;</span>, <span class="number">1</span>)).id(<span class="string">&quot;1001&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1002&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10699999&quot;</span>, <span class="string">&quot;17800002222&quot;</span>, <span class="string">&quot;青桔单车&quot;</span>, <span class="string">&quot;共享单车月卡限免&quot;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;192.168.0.2&quot;</span>, <span class="number">2</span>)).id(<span class="string">&quot;1002&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1003&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10697777&quot;</span>, <span class="string">&quot;17800003333&quot;</span>, <span class="string">&quot;曹操专车&quot;</span>, <span class="string">&quot;比滴滴更便宜的打车软件&quot;</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="string">&quot;武汉&quot;</span>, <span class="string">&quot;192.168.0.3&quot;</span>, <span class="number">1</span>)).id(<span class="string">&quot;1003&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1004&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10696666&quot;</span>, <span class="string">&quot;17800004444&quot;</span>, <span class="string">&quot;盒马鲜生&quot;</span>, <span class="string">&quot;盒马今晚加工费五折，快来选购吧&quot;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;四川&quot;</span>, <span class="string">&quot;192.168.0.4&quot;</span>, <span class="number">3</span>)).id(<span class="string">&quot;1004&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1005&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10695555&quot;</span>, <span class="string">&quot;17800005555&quot;</span>, <span class="string">&quot;中国移动&quot;</span>, <span class="string">&quot;本月话费109.87元，已欠费34.21元，请及时充值&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;192.168.0.5&quot;</span>, <span class="number">2</span>)).id(<span class="string">&quot;1005&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1006&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10694444&quot;</span>, <span class="string">&quot;17800006666&quot;</span>, <span class="string">&quot;建设银行&quot;</span>, <span class="string">&quot;消费8.00元，剩余余额1.11元&quot;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;北京&quot;</span>, <span class="string">&quot;192.168.0.6&quot;</span>, <span class="number">2</span>)).id(<span class="string">&quot;1006&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1007&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10693333&quot;</span>, <span class="string">&quot;17800007777&quot;</span>, <span class="string">&quot;蚂蚁花呗&quot;</span>, <span class="string">&quot;本月待还花呗1898元，请注意期限&quot;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;192.168.0.7&quot;</span>, <span class="number">1</span>)).id(<span class="string">&quot;1007&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1008&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10692222&quot;</span>, <span class="string">&quot;17800008888&quot;</span>, <span class="string">&quot;申通快递&quot;</span>, <span class="string">&quot;您的快递已放在快递站，取件码KF-123，请即使取走&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;192.168.0.8&quot;</span>, <span class="number">3</span>)).id(<span class="string">&quot;1008&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1009&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10691111&quot;</span>, <span class="string">&quot;17800009999&quot;</span>, <span class="string">&quot;流量提醒&quot;</span>, <span class="string">&quot;本月流量已到限额，即将开启限速&quot;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;福建&quot;</span>, <span class="string">&quot;192.168.0.9&quot;</span>, <span class="number">4</span>)).id(<span class="string">&quot;1009&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1010&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10700000&quot;</span>, <span class="string">&quot;17800010000&quot;</span>, <span class="string">&quot;Github&quot;</span>, <span class="string">&quot;您的登录验证码为[927182]，五分钟内有效&quot;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;西安&quot;</span>, <span class="string">&quot;192.168.1.0&quot;</span>, <span class="number">2</span>)).id(<span class="string">&quot;1010&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">BulkOperation</span>.Builder().create(</span><br><span class="line">                d -&gt; d.document(<span class="keyword">new</span> <span class="title class_">SmsLogs</span>(<span class="string">&quot;1011&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;10701111&quot;</span>, <span class="string">&quot;17800011111&quot;</span>, <span class="string">&quot;广州交警&quot;</span>, <span class="string">&quot;您的交警12123平台账号当前在其他手机设备上登录&quot;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;192.168.1.1&quot;</span>, <span class="number">3</span>)).id(<span class="string">&quot;1011&quot;</span>).index(<span class="string">&quot;sms&quot;</span>)).build());</span><br><span class="line"></span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(e -&gt; e.index(<span class="string">&quot;sms&quot;</span>).operations(list));</span><br><span class="line">        System.out.println(<span class="string">&quot;bulkResponse.items() = &quot;</span> + bulkResponse.items());</span><br><span class="line"></span><br><span class="line">        transport.close();</span><br><span class="line">        restClient.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="term-amp-terms-查询"><a href="#term-amp-terms-查询" class="headerlink" title="term &amp; terms 查询"></a>term &amp; terms 查询</h2><h3 id="term"><a href="#term" class="headerlink" title="term"></a>term</h3><blockquote>
<p>term 查询代表完全匹配查询。在搜索之前不会对搜索的关键词进行分词，会将关键词与分词库匹配</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;province.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="number">0.87546873</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">0.87546873</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10698888&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800001111&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;滴滴打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;打车优惠券速来领取&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1004&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">0.87546873</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10696666&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800004444&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;盒马鲜生&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;盒马今晚加工费五折，快来选购吧&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1004&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>若需要对查询结果进行分页：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;province.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTermQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(</span><br><span class="line">                s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                        .query(q -&gt; q</span><br><span class="line">                                .term(t -&gt;t</span><br><span class="line">                                        .field(<span class="string">&quot;province.keyword&quot;</span>)</span><br><span class="line">                                        .value(<span class="string">&quot;四川&quot;</span>)))</span><br><span class="line">                        .from(<span class="number">0</span>)</span><br><span class="line">                        .size(<span class="number">2</span>),</span><br><span class="line">                SmsLogs.class);</span><br><span class="line">        searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line"></span><br><span class="line">        transport.close();</span><br><span class="line">        restClient.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="terms"><a href="#terms" class="headerlink" title="terms"></a>terms</h3><blockquote>
<p>terms 查询和 term 查询机制相同。但 terms 查询可以指定一个 field 对应的多个 value</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;province.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;福建&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10698888&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800001111&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;滴滴打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;打车优惠券速来领取&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1004&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10696666&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800004444&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;盒马鲜生&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;盒马今晚加工费五折，快来选购吧&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1004&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1009&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10691111&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800009999&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;流量提醒&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;本月流量已到限额，即将开启限速&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;福建&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1009&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTermsQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">            .query(q -&gt; q</span><br><span class="line">                    .terms(t -&gt; t</span><br><span class="line">                            .field(<span class="string">&quot;province.keyword&quot;</span>)</span><br><span class="line">                            .terms(e -&gt; e.value(Arrays.asList(FieldValue.of(<span class="string">&quot;四川&quot;</span>), FieldValue.of(<span class="string">&quot;福建&quot;</span>)))))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="match-查询"><a href="#match-查询" class="headerlink" title="match 查询"></a>match 查询</h2><p>match 查询属于高层查询，它会根据查询的字段类型来自动采取不同的查询方式：</p>
<ul>
<li>Date 或 number：将查询的字符串内容转换为 date 或 number 类型</li>
<li>keyword 等不能被分词的类型：不会将查询的内容进行分词处理</li>
<li>text 等可以被分词的类型：将指定的查询内容根据指定的分词器进行分词处理，再从分词库中查询匹配的内容</li>
</ul>
<p>match 查询底层就是多个 term 查询，将多个 term 查询封装到了一起。</p>
<h3 id="match-all"><a href="#match-all" class="headerlink" title="match_all"></a>match_all</h3><blockquote>
<p>不指定查询条件查询全部内容</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMatchAllQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .matchAll(m -&gt; m)),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在输出中我们可以发现，虽然是查找全部但我们的 12 条数据只输出了 10 条，这是因为默认的 size 就是 10。可以指定查询的 size：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMatchAllQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .matchAll(m -&gt; m))</span><br><span class="line">                    .size(<span class="number">20</span>),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">    System.out.println(searchResponse.hits().hits().size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就可以输出我们全部的 12 条数据了。</p>
<br>

<h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><blockquote>
<p>可以指定 field 及其 value 的查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打车优惠券&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="number">9.540798</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">9.540798</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10698888&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800001111&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;滴滴打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;打车优惠券速来领取&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">2.5155065</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10697777&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800003333&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;曹操专车&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;比滴滴更便宜的打车软件&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;武汉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;sms&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1002&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0741045</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;createDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sendDate&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-04-26 14:28:44&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;longCode&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;10699999&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;mobile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;17800002222&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;corpName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;青桔单车&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;共享单车月卡限免&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;operatorId&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;province&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;重庆&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ipAddress&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;192.168.0.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;fee&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1002&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>输出结果会根据匹配度 score 分数的高低降序输出。</p>
<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .match(m -&gt; m</span><br><span class="line">                                    .field(<span class="string">&quot;smsContent&quot;</span>)</span><br><span class="line">                                    .query(<span class="string">&quot;打车优惠券&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="Boolean-match"><a href="#Boolean-match" class="headerlink" title="Boolean match"></a>Boolean match</h3><blockquote>
<p>基于 field 及其 value 匹配内容，采用 and 或 or 方式连接</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;滴滴打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;and&quot;</span>							<span class="comment">// 同时包含‘滴滴打车’</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;滴滴打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;operator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;or&quot;</span>								<span class="comment">// 包含‘滴滴打车’中任意分词内容</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBooleanMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .match(m -&gt; m</span><br><span class="line">                                    .field(<span class="string">&quot;smsContent&quot;</span>)</span><br><span class="line">                                    .query(<span class="string">&quot;滴滴打车&quot;</span>)</span><br><span class="line">                                    .operator(Operator.Or))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Operator</code> 枚举类中有 <code>And</code> 和 <code>Or</code> 两个值，可以按需选择。</p>
<br>

<h3 id="multi-match"><a href="#multi-match" class="headerlink" title="multi_match"></a>multi_match</h3><blockquote>
<p>针对多个 field 及其 value 进行检索</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打车&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;corpName&quot;</span><span class="punctuation">,</span> <span class="string">&quot;smsContent&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>该请求会从 <code>corpName</code> 和 <code>smsContent</code> 中检索包含 <code>打车</code> 的数据。</p>
<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMultiMatchQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .multiMatch(m -&gt; m</span><br><span class="line">                                    .fields(<span class="string">&quot;corpName&quot;</span>, <span class="string">&quot;smsContent&quot;</span>)</span><br><span class="line">                                    .query(<span class="string">&quot;打车&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="id-amp-ids-查询"><a href="#id-amp-ids-查询" class="headerlink" title="id &amp; ids 查询"></a>id &amp; ids 查询</h2><h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><blockquote>
<p>根据 id 查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /sms/_doc/<span class="number">1001</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIdQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    GetResponse&lt;SmsLogs&gt; getResponse = client.get(g -&gt; g.index(<span class="string">&quot;sms&quot;</span>).id(<span class="string">&quot;1001&quot;</span>), SmsLogs.class);</span><br><span class="line">    System.out.println(getResponse.source());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ids"><a href="#ids" class="headerlink" title="ids"></a>ids</h3><blockquote>
<p>根据多个 id 查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1002&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java  实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIdsQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .ids(i -&gt; i</span><br><span class="line">                                    .values(<span class="string">&quot;1001&quot;</span>, <span class="string">&quot;1002&quot;</span>, <span class="string">&quot;1003&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="prefix-查询"><a href="#prefix-查询" class="headerlink" title="prefix 查询"></a>prefix 查询</h2><blockquote>
<p>可以通过关键字来查询指定的 field 中前缀与之匹配的文档</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;美&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrefixQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .prefix(p -&gt; p</span><br><span class="line">                                    .field(<span class="string">&quot;corpName.keyword&quot;</span>)</span><br><span class="line">                                    .value(<span class="string">&quot;美团&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="fuzzy-查询"><a href="#fuzzy-查询" class="headerlink" title="fuzzy 查询"></a>fuzzy 查询</h2><blockquote>
<p>模糊查询，与 MySQL 中的 <code>like</code> 不同，ES 中的 <code>fuzzy</code> 可以根据指定的关键字大概匹配结果，对于错别字及顺序不敏感</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fuzzy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;盒马先生&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>当数据量很大时，我们可以指定前缀至少匹配几个字符或允许错误个数范围才能查询出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fuzzy&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;盒马先生&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;prefix_length&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fuzziness&quot;</span><span class="punctuation">:</span> <span class="number">1</span>            <span class="comment">// &quot;auto&quot; || 0 || 1 || 2</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFuzzyQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .fuzzy(f -&gt; f</span><br><span class="line">                                    .field(<span class="string">&quot;corpName.keyword&quot;</span>)</span><br><span class="line">                                    .value(<span class="string">&quot;盒马先生&quot;</span>)</span><br><span class="line">                                    .prefixLength(<span class="number">2</span>)</span><br><span class="line">                                    .fuzziness(<span class="string">&quot;auto&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="wildcard-查询"><a href="#wildcard-查询" class="headerlink" title="wildcard 查询"></a>wildcard 查询</h2><blockquote>
<p>通配查询，与 MySQL 中的 <code>like</code> 相似，可以指定通配符和占位符</p>
</blockquote>
<p>匹配所有以“车”结尾的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;*车&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>匹配所有以“滴滴”开头且后面只有两个字的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;wildcard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;滴滴??&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWildCardQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .wildcard(w -&gt; w</span><br><span class="line">                                    .field(<span class="string">&quot;corpName.keyword&quot;</span>)</span><br><span class="line">                                    .value(<span class="string">&quot;*车&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="range-查询"><a href="#range-查询" class="headerlink" title="range 查询"></a>range 查询</h2><blockquote>
<p>范围查询，只支持对数值类型的 field 指定范围</p>
</blockquote>
<p>查询 <code>fee</code> 属于 (0,2] 区间的文档</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;gt&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRangeQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">            .query(q -&gt; q</span><br><span class="line">                    .range(r -&gt; r</span><br><span class="line">                            .field(<span class="string">&quot;fee&quot;</span>)</span><br><span class="line">                            .gt(JsonData.of(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                            .lte(JsonData.of(<span class="string">&quot;2&quot;</span>)))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="regexp-查询"><a href="#regexp-查询" class="headerlink" title="regexp 查询"></a>regexp 查询</h2><blockquote>
<p>正则查询</p>
<p><strong>注意：prefix、fuzzy、wildcard、regexp 查询的效率比较低，在对效率的要求比较高时应该尽量避免使用</strong></p>
</blockquote>
<p>匹配 <code>mobile</code> 以 0000 结尾的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;mobile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[0-9]&#123;7&#125;0000&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRegexpQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s.index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .regexp(r -&gt; r</span><br><span class="line">                                    .field(<span class="string">&quot;mobile&quot;</span>)</span><br><span class="line">                                    .value(<span class="string">&quot;[0-9]&#123;7&#125;0000&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="scroll-分页"><a href="#scroll-分页" class="headerlink" title="scroll 分页"></a>scroll 分页</h2><blockquote>
<p>scrool 可以避免 Deep paging(深分页) </p>
<blockquote>
<p>深分页：ES 默认最大的查询数据条数是 10000 条，超过 10000 条时候会出现深分页问题（查询失败或者查询超时）</p>
</blockquote>
<p>在之前我们所使用的 from + size 的分页方式会导致深分页问题，Scroll 分页方式步骤：</p>
<ol>
<li>对指定的关键字进行分词处理</li>
<li>从分词库中检索，获得若干文档 id</li>
<li>将获得的文档 id 保存在 ES 上下文中</li>
<li>根据指定的 size 数从 ES 中检索相应个数的数据（获取完 id 会移除该 id）</li>
<li>获取下一页数据时直接从 ES 上下文中获取</li>
</ol>
</blockquote>
<p><strong>scroll 方式不适合做实时数据的查询</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search?scroll=<span class="number">5</span>m</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;fee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">POST /_search/scroll</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scroll_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoAxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWYWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWUWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWQWWWUtOElfSXdTSVdPanRYMnZJSFd6dw==&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scroll&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5m&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">DELETE /_search/scroll/FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoAxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWYWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWUWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAAAWQWWWUtOElfSXdTSVdPanRYMnZJSFd6dw==</span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetScrollQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client</span><br><span class="line">            .search(s -&gt; s</span><br><span class="line">                            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                            .scroll(t -&gt; t</span><br><span class="line">                                    .time(<span class="string">&quot;5m&quot;</span>))</span><br><span class="line">                            .query(q -&gt; q</span><br><span class="line">                                    .matchAll(m -&gt; m))</span><br><span class="line">                            .size(<span class="number">2</span>)</span><br><span class="line">                            .sort(o -&gt; o.field(f -&gt; f</span><br><span class="line">                                    .field(<span class="string">&quot;fee&quot;</span>)</span><br><span class="line">                                    .order(SortOrder.Desc))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">    System.out.println(searchResponse.scrollId());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNextScrollQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client</span><br><span class="line">            .scroll(s -&gt; s</span><br><span class="line">            .scrollId(<span class="string">&quot;FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoAxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhgWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhcWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhYWWWUtOElfSXdTSVdPanRYMnZJSFd6dw&quot;</span>)</span><br><span class="line">                            .scroll(t -&gt; t.time(<span class="string">&quot;5m&quot;</span>)),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testClearScrollQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ClearScrollResponse</span> <span class="variable">clearScrollRequest</span> <span class="operator">=</span> client</span><br><span class="line">            .clearScroll(c -&gt; c</span><br><span class="line">                    .scrollId(<span class="string">&quot;FGluY2x1ZGVfY29udGV4dF91dWlkDnF1ZXJ5VGhlbkZldGNoAxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhgWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhcWWWUtOElfSXdTSVdPanRYMnZJSFd6dxZXWEtNVEE3WFNjLWJHdFZ3MHVIY3B3AAAAAAAADhYWWWUtOElfSXdTSVdPanRYMnZJSFd6dw&quot;</span>));</span><br><span class="line">    System.out.println(clearScrollRequest.succeeded());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="delete-by-query-删除"><a href="#delete-by-query-删除" class="headerlink" title="delete_by_query 删除"></a>delete_by_query 删除</h2><blockquote>
<p>根据 term、match 等查询方式删除文档，可以一次性删除大量文档</p>
<p><strong>注意：如果需要删除的文档是 index 中的大部分数据，则尽量再创建一个 index 将需要保留的数据添加进该 index</strong></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_delete_by_query</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;corpName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Github&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteByQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">DeleteByQueryResponse</span> <span class="variable">deleteByQueryResponse</span> <span class="operator">=</span> client</span><br><span class="line">            .deleteByQuery(d -&gt; d</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .match(m -&gt; m</span><br><span class="line">                                    .field(<span class="string">&quot;corpName.keyword&quot;</span>)</span><br><span class="line">                                    .query(<span class="string">&quot;Github&quot;</span>))));</span><br><span class="line">    System.out.println(deleteByQueryResponse.deleted());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="复合查询"><a href="#复合查询" class="headerlink" title="复合查询"></a>复合查询</h2><h3 id="bool-查询"><a href="#bool-查询" class="headerlink" title="bool 查询"></a>bool 查询</h3><blockquote>
<p>复合过滤器，会将指定的多个条件按一定的逻辑组合</p>
<ul>
<li>must：表示 and</li>
<li>must_not：表示 not</li>
<li>should：表示 or</li>
</ul>
</blockquote>
<p>查询 province 为四川或重庆且 state 不为 1 的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;province.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;四川&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;province.keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;重庆&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：must 与 should 不能并列使用，否则 should 会失效</strong></p>
<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBoolQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client</span><br><span class="line">            .search(s -&gt; s</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                            .query(q -&gt; q</span><br><span class="line">                                    .bool(b -&gt; b</span><br><span class="line">                                            .should(h -&gt; h.term(t -&gt; t.field(<span class="string">&quot;province.keyword&quot;</span>).value(<span class="string">&quot;四川&quot;</span>)))</span><br><span class="line">                                            .should(h -&gt; h.term(t -&gt; t.field(<span class="string">&quot;province.keyword&quot;</span>).value(<span class="string">&quot;重庆&quot;</span>)))</span><br><span class="line">                                            .mustNot(m -&gt; m.match(a -&gt; a.field(<span class="string">&quot;state&quot;</span>).query(<span class="string">&quot;1&quot;</span>)))</span><br><span class="line">                                    )),</span><br><span class="line">                    SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="boosting-查询"><a href="#boosting-查询" class="headerlink" title="boosting 查询"></a>boosting 查询</h3><blockquote>
<p>boosting 查询可以影响查询后的 score</p>
<ul>
<li>positive：只有查询后匹配 positive 的内容才会返回</li>
<li>negative：如果同时匹配 positive 和 negative，那么 score 就会降低</li>
<li>negative_boost：指定计算 score 时需要乘的系数，小于 1.0</li>
</ul>
</blockquote>
<p>降低 smsContent 中包含 “打车” 和 “滴滴” 的结果的 score：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;boosting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;positive&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打车&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;negative&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;滴滴&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;negative_boost&quot;</span><span class="punctuation">:</span> <span class="number">0.2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBoostingQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client</span><br><span class="line">            .search(s -&gt; s</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q.boosting(b -&gt; b.positive(p -&gt; p.match(m -&gt; m.field(<span class="string">&quot;smsContent&quot;</span>).query(<span class="string">&quot;打车&quot;</span>)))</span><br><span class="line">                            .negative(n -&gt; n.match(m -&gt; m.field(<span class="string">&quot;smsContent&quot;</span>).query(<span class="string">&quot;滴滴&quot;</span>)))</span><br><span class="line">                            .negativeBoost(<span class="number">0.2</span>))),</span><br><span class="line">                    SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="filter-查询"><a href="#filter-查询" class="headerlink" title="filter 查询"></a>filter 查询</h2><blockquote>
<p>query：根据查询条件查询并根据文档匹配度计算 score，根据 score 降序排序，不会缓存。</p>
<p>filter：根据查询条件查询，不计算 score，会对经常被过滤的数据进行缓存。</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;corpName.keyword&quot;</span><span class="punctuation">:</span> <span class="string">&quot;盒马鲜生&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;fee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;gt&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">                    .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .bool(b -&gt; b</span><br><span class="line">                                    .filter(f -&gt; f.term(t -&gt; t.field(<span class="string">&quot;corpName.keyword&quot;</span>).value(<span class="string">&quot;盒马鲜生&quot;</span>)))</span><br><span class="line">                                    .filter(f -&gt; f.range(r -&gt; r.field(<span class="string">&quot;fee&quot;</span>).gt(JsonData.of(<span class="number">2</span>)).lte(JsonData.of(<span class="number">3</span>)))))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.source()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="highlight-查询"><a href="#highlight-查询" class="headerlink" title="highlight 查询"></a>highlight 查询</h2><blockquote>
<p>高亮查询：将返回的查询结果中查询关键字以高亮形式显示</p>
<p>属性：</p>
<ul>
<li>fields：指定以高亮形式返回的 field</li>
<li>fragment_size：返回的高亮数据展示的字符数</li>
<li>pre_tags：前缀标签</li>
<li>post_tags：后缀标签</li>
</ul>
<p>可以通过指定前后缀标签来设置高亮形式：”pre_tags”: “&lt;font color&#x3D;’red’”&gt;    “post_tags”: “&lt;font&gt;”</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;打车&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;smsContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;font color=&#x27;red&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/font&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fragment_size&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHighlightQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .query(q -&gt; q</span><br><span class="line">                            .match(m -&gt; m</span><br><span class="line">                                    .field(<span class="string">&quot;smsContent&quot;</span>)</span><br><span class="line">                                    .query(<span class="string">&quot;打车&quot;</span>)))</span><br><span class="line">                    .highlight(h -&gt; h</span><br><span class="line">                            .fields(<span class="string">&quot;smsContent&quot;</span>, f -&gt; f.preTags(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&quot;</span>).postTags(<span class="string">&quot;&lt;/font&gt;&quot;</span>).fragmentSize(<span class="number">10</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.hits().hits().forEach(h -&gt; System.out.println(h.highlight()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><blockquote>
<p>ES 的聚合查询与 MySQL 的聚合查询相似，但 ES 的聚合查询提供了多种统计数据的方法，比 MySQL 更强大</p>
</blockquote>
<p>聚合查询的 RESTful 语法：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /index/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;NAME&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;AGG_TYPE&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;property&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="cardinality-查询"><a href="#cardinality-查询" class="headerlink" title="cardinality 查询"></a>cardinality 查询</h3><blockquote>
<p>去重计数查询</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST /sms/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;agg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;cardinality&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;province.keyword&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>Java 实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCardinalityQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    SearchResponse&lt;SmsLogs&gt; searchResponse = client.search(s -&gt; s</span><br><span class="line">            .index(<span class="string">&quot;sms&quot;</span>)</span><br><span class="line">                    .aggregations(<span class="string">&quot;agg&quot;</span>, a -&gt; a.cardinality(c -&gt; c.field(<span class="string">&quot;province.keyword&quot;</span>))),</span><br><span class="line">            SmsLogs.class);</span><br><span class="line">    searchResponse.aggregations().forEach((key, value) -&gt; System.out.println(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h1 id="SpringBoot-集成-ES"><a href="#SpringBoot-集成-ES" class="headerlink" title="SpringBoot 集成 ES"></a>SpringBoot 集成 ES</h1><p>由于版本问题，还未找到 SpringBoot 集成 ES 8.x 的资料，这部分留在以后学习或待更换旧版本 7.x 后再集成。</p>
<p>ElasticSearch 配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchClientConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">restHighLevelClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootEsApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMatchAllQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;sms&quot;</span>);</span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">searchSourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">        <span class="type">MatchAllQueryBuilder</span> <span class="variable">matchAllQueryBuilder</span> <span class="operator">=</span> QueryBuilders.matchAllQuery();</span><br><span class="line">        searchSourceBuilder.query(matchAllQueryBuilder);</span><br><span class="line">        searchRequest.source(searchSourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ssssv11 WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag"># 中间件</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/29/Nginx/" rel="prev" title="Nginx">
                  <i class="fa fa-chevron-left"></i> Nginx
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/29/Zookeeper/" rel="next" title="ZooKeeper">
                  ZooKeeper <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ssssv11</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
