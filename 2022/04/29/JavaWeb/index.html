<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.lug.ustc.edu.cn/css?family=Helvetica:300,300italic,400,400italic,700,700italic%7CMenlo:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ssssv11.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="JavaWeb">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb">
<meta property="og:url" content="https://ssssv11.github.io/2022/04/29/JavaWeb/index.html">
<meta property="og:site_name" content="Ssssv">
<meta property="og:description" content="JavaWeb">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191831.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191908.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191923.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192022.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192016.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192110.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192125.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192230.png">
<meta property="og:image" content="https://gitee.com/Ssssv11/typora/raw/master/image-20220323212107115.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192313.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192328.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192352.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192419.png">
<meta property="og:image" content="https://gitee.com/Ssssv11/typora/raw/master/image-20220325103800512.png">
<meta property="og:image" content="c:/Users/Hxd/AppData/Roaming/Typora/typora-user-images/image-20220325104056591.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325220302.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325221037.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/27/QQ20220327202517.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/27/1135580-20180224103013334-227020801.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/27/32211c0d654a3a2cd0d0c6a00fe2ebf8.png">
<meta property="og:image" content="https://s1.imagehub.cc/images/2022/03/27/f6a715e576e334b524fbc08eca5a8a32.jpg">
<meta property="article:published_time" content="2022-04-29T13:43:56.873Z">
<meta property="article:modified_time" content="2022-04-29T13:44:18.267Z">
<meta property="article:author" content="Ssssv11">
<meta property="article:tag" content="JavaWeb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191831.png">


<link rel="canonical" href="https://ssssv11.github.io/2022/04/29/JavaWeb/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>JavaWeb | Ssssv</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Ssssv</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">24</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">41</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81Web%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%AE%B5"><span class="nav-number">1.2.</span> <span class="nav-text">动态Web应用的实现手段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.3.</span> <span class="nav-text">Web服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.3.1.</span> <span class="nav-text">常用Web服务器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%AD%E5%BB%BAWeb%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.</span> <span class="nav-text">搭建Web环境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#HTTP"><span class="nav-number">2.</span> <span class="nav-text">HTTP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B"><span class="nav-number">2.2.</span> <span class="nav-text">传输过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JUtil%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">JUtil单元测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95JUtil"><span class="nav-number">3.1.</span> <span class="nav-text">尝试JUtil</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAWeb%E9%A1%B9%E7%9B%AE"><span class="nav-number">4.</span> <span class="nav-text">创建Web项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet"><span class="nav-number">5.</span> <span class="nav-text">Servlet</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAServlet"><span class="nav-number">5.1.</span> <span class="nav-text">创建Servlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">5.2.</span> <span class="nav-text">Servlet的生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E8%AF%BBServlet"><span class="nav-number">5.3.</span> <span class="nav-text">解读Servlet</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#get%E4%B8%8Epost"><span class="nav-number">5.3.1.</span> <span class="nav-text">get与post</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebServlet%E6%B3%A8%E8%A7%A3"><span class="nav-number">5.3.2.</span> <span class="nav-text">@WebServlet注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ServletContext"><span class="nav-number">5.4.</span> <span class="nav-text">ServletContext</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="nav-number">5.4.1.</span> <span class="nav-text">数据传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0"><span class="nav-number">5.4.2.</span> <span class="nav-text">初始化参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91"><span class="nav-number">5.4.3.</span> <span class="nav-text">请求转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E8%B5%84%E6%BA%90"><span class="nav-number">5.4.4.</span> <span class="nav-text">读取资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpServletResponse"><span class="nav-number">5.5.</span> <span class="nav-text">HttpServletResponse</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#response%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="nav-number">5.5.1.</span> <span class="nav-text">response主要方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%8B%E8%BD%BD%E4%B8%8E%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-number">5.5.2.</span> <span class="nav-text">实现下载与上传文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="nav-number">5.5.2.1.</span> <span class="nav-text">下载文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-number">5.5.2.2.</span> <span class="nav-text">上传文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="nav-number">5.5.2.3.</span> <span class="nav-text">验证码功能</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">5.5.3.</span> <span class="nav-text">实现重定向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E4%B8%8E%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">5.5.4.</span> <span class="nav-text">重定向与请求转发的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpServletRequest"><span class="nav-number">5.6.</span> <span class="nav-text">HttpServletRequest</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#request%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="nav-number">5.6.1.</span> <span class="nav-text">request主要方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%89%8D%E7%AB%AF%E5%8F%82%E6%95%B0%E5%B9%B6%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91"><span class="nav-number">5.6.2.</span> <span class="nav-text">获取前端参数并请求转发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="nav-number">5.7.</span> <span class="nav-text">Servlet线程安全问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">5.7.1.</span> <span class="nav-text">保证线程安全</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet-JDBC"><span class="nav-number">6.</span> <span class="nav-text">Servlet + JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">6.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#properties%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.</span> <span class="nav-text">properties配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DbUtils%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">6.3.</span> <span class="nav-text">DbUtils工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BBAdmin"><span class="nav-number">6.4.</span> <span class="nav-text">创建实体类Admin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dao"><span class="nav-number">6.5.</span> <span class="nav-text">Dao</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DaoImpl"><span class="nav-number">6.5.1.</span> <span class="nav-text">DaoImpl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Service"><span class="nav-number">6.6.</span> <span class="nav-text">Service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ServiceImpl"><span class="nav-number">6.6.1.</span> <span class="nav-text">ServiceImpl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet-1"><span class="nav-number">6.7.</span> <span class="nav-text">Servlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">6.8.</span> <span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ShowAllController"><span class="nav-number">6.8.1.</span> <span class="nav-text">ShowAllController</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ShowAllJSP"><span class="nav-number">6.8.2.</span> <span class="nav-text">ShowAllJSP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">状态管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">7.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E5%88%86%E7%B1%BB"><span class="nav-number">7.2.</span> <span class="nav-text">技术分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie"><span class="nav-number">7.3.</span> <span class="nav-text">Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5"><span class="nav-number">7.3.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">7.3.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BACookie"><span class="nav-number">7.3.3.</span> <span class="nav-text">创建Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Cookie"><span class="nav-number">7.3.4.</span> <span class="nav-text">获取Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Cookie"><span class="nav-number">7.3.5.</span> <span class="nav-text">修改Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81"><span class="nav-number">7.3.6.</span> <span class="nav-text">Cookie编码与解码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A6%E4%B8%AD%E6%96%87%E7%9A%84Cookie"><span class="nav-number">7.3.6.1.</span> <span class="nav-text">创建带中文的Cookie</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">7.3.7.</span> <span class="nav-text">Cookie的优缺点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session"><span class="nav-number">7.4.</span> <span class="nav-text">Session</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="nav-number">7.4.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-1"><span class="nav-number">7.4.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">7.4.3.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Session"><span class="nav-number">7.4.3.1.</span> <span class="nav-text">获取Session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AESession%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.3.2.</span> <span class="nav-text">设置Session数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Session%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.3.3.</span> <span class="nav-text">获取Session数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4Session%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.3.4.</span> <span class="nav-text">删除Session数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session%E4%B8%8ERequest"><span class="nav-number">7.4.4.</span> <span class="nav-text">Session与Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">7.4.5.</span> <span class="nav-text">Session生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%A6%81%E7%94%A8Cookie%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">7.4.6.</span> <span class="nav-text">浏览器禁用Cookie的解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#URL%E9%87%8D%E5%86%99"><span class="nav-number">7.4.6.1.</span> <span class="nav-text">URL重写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81"><span class="nav-number">7.5.</span> <span class="nav-text">Session权限验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">7.5.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BBManager"><span class="nav-number">7.5.2.</span> <span class="nav-text">创建实体类Manager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAManagerDao"><span class="nav-number">7.5.3.</span> <span class="nav-text">创建ManagerDao</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E7%8E%B0%E7%B1%BBManagerDaoImpl"><span class="nav-number">7.5.4.</span> <span class="nav-text">创建实现类ManagerDaoImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAManagerService%E6%8E%A5%E5%8F%A3"><span class="nav-number">7.5.5.</span> <span class="nav-text">创建ManagerService接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E7%8E%B0%E7%B1%BBManagerServiceImpl"><span class="nav-number">7.5.6.</span> <span class="nav-text">创建实现类ManagerServiceImpl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAmgrLogin%E9%A1%B5%E9%9D%A2"><span class="nav-number">7.5.7.</span> <span class="nav-text">创建mgrLogin页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BALoginMgrControllerServlet"><span class="nav-number">7.5.8.</span> <span class="nav-text">创建LoginMgrControllerServlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9ShowAllServlet"><span class="nav-number">7.5.9.</span> <span class="nav-text">修改ShowAllServlet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session%E4%BF%9D%E5%AD%98%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="nav-number">7.6.</span> <span class="nav-text">Session保存验证码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Filter"><span class="nav-number">8.</span> <span class="nav-text">Filter</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="nav-number">8.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8"><span class="nav-number">8.2.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAFilter"><span class="nav-number">8.3.</span> <span class="nav-text">创建Filter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">8.3.1.</span> <span class="nav-text">过滤器配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAServlet-1"><span class="nav-number">8.3.2.</span> <span class="nav-text">创建Servlet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%A6%E6%88%AA%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE"><span class="nav-number">8.3.3.</span> <span class="nav-text">拦截路径配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">8.4.</span> <span class="nav-text">过滤器链与优先级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE"><span class="nav-number">8.5.</span> <span class="nav-text">过滤器链</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-number">8.5.1.</span> <span class="nav-text">过滤器优先级</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%BA%94%E7%94%A8"><span class="nav-number">8.6.</span> <span class="nav-text">过滤器应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E8%A7%A3%E5%86%B3%E7%BC%96%E7%A0%81"><span class="nav-number">8.6.1.</span> <span class="nav-text">过滤器解决编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81"><span class="nav-number">8.6.2.</span> <span class="nav-text">过滤器权限验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Listener"><span class="nav-number">9.</span> <span class="nav-text">Listener</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EMS%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">10.</span> <span class="nav-text">EMS员工管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">10.1.</span> <span class="nav-text">数据库环境搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5Maven%E4%BE%9D%E8%B5%96"><span class="nav-number">10.2.</span> <span class="nav-text">导入Maven依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.3.</span> <span class="nav-text">编写数据库配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B7%A5%E5%85%B7%E7%B1%BBDbUtils"><span class="nav-number">10.4.</span> <span class="nav-text">创建数据库工具类DbUtils</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">10.5.</span> <span class="nav-text">创建实体类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1Dao"><span class="nav-number">10.6.</span> <span class="nav-text">创建数据库访问对象Dao</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BADao%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">10.7.</span> <span class="nav-text">创建Dao实现类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91Service%E7%B1%BB"><span class="nav-number">10.8.</span> <span class="nav-text">创建业务逻辑Service类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAService%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">10.9.</span> <span class="nav-text">创建Service实现类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">10.10.</span> <span class="nav-text">创建过滤器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAhtml%E9%A1%B5%E9%9D%A2"><span class="nav-number">10.11.</span> <span class="nav-text">创建html页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAServletController%E4%B8%8EJSP"><span class="nav-number">10.12.</span> <span class="nav-text">创建ServletController与JSP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JSP"><span class="nav-number">11.</span> <span class="nav-text">JSP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="nav-number">11.1.</span> <span class="nav-text">作用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JSP%E5%BC%80%E5%8F%91"><span class="nav-number">12.</span> <span class="nav-text">JSP开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAJSP"><span class="nav-number">12.1.</span> <span class="nav-text">创建JSP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSP%E4%B8%8EServlet"><span class="nav-number">12.2.</span> <span class="nav-text">JSP与Servlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">12.3.</span> <span class="nav-text">JSP实现原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP-java%E6%BA%90%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E7%9B%AE%E5%BD%95"><span class="nav-number">12.3.1.</span> <span class="nav-text">JSP.java源文件存放目录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JSP%E4%B8%8EHTML%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91"><span class="nav-number">13.</span> <span class="nav-text">JSP与HTML集成开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">13.1.</span> <span class="nav-text">脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%99%AE%E9%80%9A%E8%84%9A%E6%9C%AC"><span class="nav-number">13.1.1.</span> <span class="nav-text">普通脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A3%B0%E6%98%8E%E8%84%9A%E6%9C%AC"><span class="nav-number">13.1.2.</span> <span class="nav-text">声明脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E8%84%9A%E6%9C%AC"><span class="nav-number">13.1.3.</span> <span class="nav-text">输出脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">13.2.</span> <span class="nav-text">注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JSP%E6%8C%87%E4%BB%A4"><span class="nav-number">13.3.</span> <span class="nav-text">JSP指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#page%E6%8C%87%E4%BB%A4"><span class="nav-number">13.3.1.</span> <span class="nav-text">page指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#include%E6%8C%87%E4%BB%A4"><span class="nav-number">13.3.2.</span> <span class="nav-text">include指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#taglib%E6%8C%87%E4%BB%A4"><span class="nav-number">13.3.3.</span> <span class="nav-text">taglib指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E4%BD%9C%E6%A0%87%E7%AD%BE"><span class="nav-number">13.4.</span> <span class="nav-text">动作标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#include"><span class="nav-number">13.4.1.</span> <span class="nav-text">include</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useBean"><span class="nav-number">13.4.2.</span> <span class="nav-text">useBean</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setProperty"><span class="nav-number">13.4.3.</span> <span class="nav-text">setProperty</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getProperty"><span class="nav-number">13.4.4.</span> <span class="nav-text">getProperty</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forward"><span class="nav-number">13.4.5.</span> <span class="nav-text">forward</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#param"><span class="nav-number">13.4.6.</span> <span class="nav-text">param</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="nav-number">13.5.</span> <span class="nav-text">内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E5%A4%A7%E5%9F%9F%E5%AF%B9%E8%B1%A1"><span class="nav-number">13.5.1.</span> <span class="nav-text">四大域对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pageContext%E5%AF%B9%E8%B1%A1"><span class="nav-number">13.5.2.</span> <span class="nav-text">pageContext对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pageContext%E6%93%8D%E4%BD%9C%E5%85%B6%E4%BB%96%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">13.5.2.1.</span> <span class="nav-text">pageContext操作其他内置对象的作用域</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%B9%E8%BF%9BEMS%E7%B3%BB%E7%BB%9F1"><span class="nav-number">14.</span> <span class="nav-text">改进EMS系统1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#EL%E8%A1%A8%E8%BE%BE%E5%BC%8F-Expression-Language"><span class="nav-number">15.</span> <span class="nav-text">EL表达式(Expression Language)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="nav-number">15.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EL%E8%8E%B7%E5%8F%96%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">15.2.</span> <span class="nav-text">EL获取基本类型、字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EL%E4%B8%8EJSP%E8%84%9A%E6%9C%AC%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">15.3.</span> <span class="nav-text">EL与JSP脚本的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EL%E8%8E%B7%E5%8F%96%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="nav-number">15.4.</span> <span class="nav-text">EL获取引用类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EL%E8%8E%B7%E5%8F%96%E6%95%B0%E7%BB%84%E3%80%81%E9%9B%86%E5%90%88%E7%9A%84%E5%85%83%E7%B4%A0"><span class="nav-number">15.5.</span> <span class="nav-text">EL获取数组、集合的元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EL%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">15.6.</span> <span class="nav-text">EL运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1-1"><span class="nav-number">15.7.</span> <span class="nav-text">内置对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">15.7.1.</span> <span class="nav-text">获取应用上下文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Cookie%E5%AF%B9%E8%B1%A1"><span class="nav-number">15.7.2.</span> <span class="nav-text">获取Cookie对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JSTL%E6%A0%87%E5%87%86%E6%A0%87%E7%AD%BE%E5%BA%93"><span class="nav-number">16.</span> <span class="nav-text">JSTL标准标签库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="nav-number">16.1.</span> <span class="nav-text">作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="nav-number">16.2.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A0%87%E7%AD%BE"><span class="nav-number">16.3.</span> <span class="nav-text">核心标签</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSTL%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-number">16.3.1.</span> <span class="nav-text">JSTL条件判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6choose%E5%88%A4%E6%96%AD"><span class="nav-number">16.3.2.</span> <span class="nav-text">多条件choose判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3forEach%E6%A0%87%E7%AD%BE"><span class="nav-number">16.3.3.</span> <span class="nav-text">迭代forEach标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url%E6%A0%87%E7%AD%BE"><span class="nav-number">16.3.4.</span> <span class="nav-text">url标签</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%B9%E8%BF%9BEMS%E7%B3%BB%E7%BB%9F2"><span class="nav-number">17.</span> <span class="nav-text">改进EMS系统2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="nav-number">17.1.</span> <span class="nav-text">导入依赖配置环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9JSP%E9%A1%B5%E9%9D%A2"><span class="nav-number">17.2.</span> <span class="nav-text">修改JSP页面</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MVC"><span class="nav-number">18.</span> <span class="nav-text">MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5-2"><span class="nav-number">18.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3"><span class="nav-number">18.2.</span> <span class="nav-text">MVC模式详解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">18.3.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC%E5%9C%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%BA%94%E7%94%A8"><span class="nav-number">18.4.</span> <span class="nav-text">MVC在框架中应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E4%B8%8EMVC"><span class="nav-number">18.5.</span> <span class="nav-text">三层架构与MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="nav-number">18.5.1.</span> <span class="nav-text">三层架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC%E4%B8%8E%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">18.5.2.</span> <span class="nav-text">MVC与三层架构的区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%B9%E8%BF%9BEMS%E7%B3%BB%E7%BB%9F3"><span class="nav-number">19.</span> <span class="nav-text">改进EMS系统3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5"><span class="nav-number">19.1.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="nav-number">19.2.</span> <span class="nav-text">分页实现思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">19.3.</span> <span class="nav-text">分页代码实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ThymeLeaf"><span class="nav-number">20.</span> <span class="nav-text">ThymeLeaf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0-3"><span class="nav-number">20.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="nav-number">20.2.</span> <span class="nav-text">开发流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-number">20.2.1.</span> <span class="nav-text">创建项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">20.3.</span> <span class="nav-text">导入依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2"><span class="nav-number">20.4.</span> <span class="nav-text">创建前端页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAServlet-2"><span class="nav-number">20.5.</span> <span class="nav-text">创建Servlet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thymeleaf%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="nav-number">20.6.</span> <span class="nav-text">Thymeleaf语法基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86"><span class="nav-number">20.6.1.</span> <span class="nav-text">后端部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E9%83%A8%E5%88%86"><span class="nav-number">20.6.2.</span> <span class="nav-text">前端部分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAHTML"><span class="nav-number">20.6.2.1.</span> <span class="nav-text">创建HTML</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">20.6.2.2.</span> <span class="nav-text">表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE"><span class="nav-number">20.6.2.3.</span> <span class="nav-text">常用标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thymeleaf%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E6%B3%95"><span class="nav-number">20.6.3.</span> <span class="nav-text">Thymeleaf流程控制语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#th-if"><span class="nav-number">20.6.3.1.</span> <span class="nav-text">th:if</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#th-switch"><span class="nav-number">20.6.3.2.</span> <span class="nav-text">th:switch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#th-each"><span class="nav-number">20.6.3.3.</span> <span class="nav-text">th:each</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thymeleaf%E6%A8%A1%E6%9D%BF%E5%B8%83%E5%B1%80"><span class="nav-number">20.6.4.</span> <span class="nav-text">Thymeleaf模板布局</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tomcat%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="nav-number">21.</span> <span class="nav-text">Tomcat类加载机制</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ssssv11"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">Ssssv11</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Ssssv11" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Ssssv11" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ssssv11.github.io/2022/04/29/JavaWeb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="Ssssv11">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ssssv">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JavaWeb
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-04-29 21:43:56 / Modified: 21:44:18" itemprop="dateCreated datePublished" datetime="2022-04-29T21:43:56+08:00">2022-04-29</time>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <center>JavaWeb</center>



<span id="more"></span>

<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><hr>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>WEB，即表示网页的意思，它用于表示Internet主机上供外界访问的资源。</p>
<p>Internet上供外界访问的Web资源分为：</p>
<ol>
<li><p><strong>静态web资源（如html页面）：指web页面中供人们浏览的数据始终是不变。</strong></p>
</li>
<li><p><strong>动态web资源：指web页面中供人们浏览的数据是由程序产生的，不同时间点访问web页面看到的内容各不相同</strong>。</p>
</li>
</ol>
<p>静态web资源开发技术：Html<br>　　常用动态web资源开发技术：JSP&#x2F;Servlet、ASP、PHP等<br>　　在Java中，动态web资源开发技术统称为JavaWeb</p>
<br/>

<h2 id="动态Web应用的实现手段"><a href="#动态Web应用的实现手段" class="headerlink" title="动态Web应用的实现手段"></a>动态Web应用的实现手段</h2><p><strong>ASP:</strong></p>
<ul>
<li>微软公司，国内最早流行的就是ASP；</li>
<li>在HTML中嵌入了VB的脚本，ASP + COM；</li>
<li>在ASP开发中，基本一个页面都有几干行的业务代码，页面极其换乱且维护成本高。</li>
</ul>
<p><strong>PHP:</strong></p>
<ul>
<li>PHP开发速度很快，功能很强大，跨平台，代码很简单（70%，WP）</li>
<li>无法承载大访问量的情况（局限性）</li>
</ul>
<p><strong>JSP&#x2F;Servlet:</strong></p>
<ul>
<li>基于Java语言</li>
<li>可以承载三高问题带来的影响</li>
<li>语法类似ASP</li>
</ul>
<br/>

<h2 id="Web服务器"><a href="#Web服务器" class="headerlink" title="Web服务器"></a>Web服务器</h2><p>Web服务器是指驻留于因特网上某种类型计算机的程序，是可以向发出请求的浏览器提供文档的<strong>程序</strong>。当Web浏览器（客户端）连到服务器上并请求文件时，服务器将处理该请求并将文件反馈到该浏览器上，附带的信息会告诉浏览器如何查看该文件（即文件类型）。服务器是一种被动程序：只有当Internet上运行在其他计算机中的浏览器发出请求时，服务器才会响应。</p>
<br/>

<h3 id="常用Web服务器"><a href="#常用Web服务器" class="headerlink" title="常用Web服务器"></a>常用Web服务器</h3><ul>
<li><p>WebLogic</p>
</li>
<li><p>WebSphere</p>
</li>
<li><p>IIS</p>
</li>
<li><p>Tomcat</p>
<p>Tomcat是一个实现了Java EE标准的最小的WEB服务器。因为Tomcat技术先进、性能稳定，而且开源免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为目前比较流行的Web应用服务器。学习JavaWeb开发一般都使用Tomcat服务器，该服务器支持全部JSP以及Servlet规范。</p>
</li>
</ul>
<br/>

<h2 id="搭建Web环境"><a href="#搭建Web环境" class="headerlink" title="搭建Web环境"></a>搭建Web环境</h2><ol>
<li><strong>下载Tomcat</strong>：<a target="_blank" rel="noopener" href="https://tomcat.apache.org/">https://tomcat.apache.org/</a></li>
<li><strong>启动Tomcat服务器</strong>：双击 bin 目录下的 startup.bat 文件启动Tomcat服务器</li>
<li><strong>测试Tomcat服务器</strong>：打开浏览器，输入<a target="_blank" rel="noopener" href="http://localhost:8080/%EF%BC%8C%E8%83%BD%E6%98%BE%E7%A4%BATomcat%E7%95%8C%E9%9D%A2%E4%BB%A3%E8%A1%A8%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F">http://localhost:8080/，能显示Tomcat界面代表安装成功</a></li>
</ol>
<br/>

<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><hr>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>HTTP是面向事务的应用层协议，它是万维网上能够可靠交换文件的重要基础。HTTP不仅传送完成超文本跳转所需的必须信息，而且也传送任何可从互联网上得到的信息，如文本、超文本、声音和图像。</p>
<p>HTTP使用了面向连接的TCP作为运输层协议，<strong>保证了数据的可靠传输</strong>。HTTP不必考虑数据在传输过程中被丢弃后又怎样被重传。但是<strong>HTTP协议本身是无连接的</strong>。也就是说，HTTP虽然使用了TCP连接，但是通信的双方在交换HTTP报文之前不需要先建立HTTP连接。1997年以前使用的是HTTP&#x2F;1.0协议，之后使用HTTP&#x2F;1.1协议。</p>
<img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191831.png" alt="QQ20220325191831.png" style="zoom: 67%;" />

<p>TCP协议经历了三次握手再进行通信，也就是说保证整个通信是稳定的，才可以进行数据交换，并且在连接已经建立的过程中，双方随时可以互相发送数据，直到有一方主动关闭连接，这时在进行四次挥手，完成整个TCP通信。</p>
<p>而HTTP和TCP并不是一个层次的通信协议，TCP是传输层协议，而HTTP是应用层协议，因此，HTTP的内容会作为TCP协议的报文被封装，并继续向下一层进行传递，而传输到客户端时，会依次进行解包，还原为最开始的HTTP数据。</p>
<h2 id="传输过程"><a href="#传输过程" class="headerlink" title="传输过程"></a>传输过程</h2><p>用户在点击鼠标链接某个万维网文档时，HTTP协议首先要和服务器建立TCP连接。这需要使用三报文握手。当建立TCP连接的三报文握手的前两部分完成后（即经过了一个RTT时间后），万维网客户就把HTTP请求报文作为建立TCP连接的三报文握手中的第三个报文的数据，发送给万维网服务器。服务器收到HTTP请求报文后，就把所请求的文档作为响应报文返回给客户。</p>
<p>因此，我们的浏览器请求一个页面，需要两倍的往返时间。</p>
<br/>

<h1 id="JUtil单元测试"><a href="#JUtil单元测试" class="headerlink" title="JUtil单元测试"></a>JUtil单元测试</h1><hr>
<p>随着项目逐渐变大，边写边使用运行main方法进行测试会明显降低我们开发效率。在很多情况下，我们的项目可能会很庞大，不可能每次都去完整地启动一个项目来测试某一个功能。因此，我们需要使用单元测试来针对于某个功能或是某个模块单独运行代码进行测试，而不是启动整个项目。</p>
<br/>

<h2 id="尝试JUtil"><a href="#尝试JUtil" class="headerlink" title="尝试JUtil"></a>尝试JUtil</h2><p>首先需要导入JUnit依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在我们创建一个新的类，来编写我们的单元测试用例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MavenTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;A&quot;</span>, <span class="number">20</span>, <span class="string">&quot;male&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;A&quot;</span>, <span class="number">20</span>, <span class="string">&quot;male&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以点击类前面的测试按钮，或是单个方法前的测试按钮，如果点击类前面的测试按钮，会执行所有的测试用例。</p>
<p>运行测试后，我们发现控制台得到了一个测试结果，显示为绿色表示测试通过。</p>
<p>只需要通过打上**@Test**注解，即可将一个方法标记为测试案例，我们可以直接运行此测试案例，但是我们编写的测试方法有以下要求：</p>
<ul>
<li>方法必须是public的</li>
<li>不能是静态方法</li>
<li>返回值必须是void</li>
<li>必须是没有任何参数的方法</li>
</ul>
<p>对于一个测试案例来说，我们肯定希望测试的结果是我们所期望的一个值，因此，如果测试的结果并不是我们所期望的结果，那么这个测试就应该没有成功通过。</p>
<p>我们可以通过断言工具类来进行判定：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">8</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line">                    arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line"><span class="comment">//                    arr[j+1] = temp;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.assertArrayEquals(<span class="string">&quot;Wrong&quot;</span>, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">8</span>&#125;, arr);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>通过测试，发现得到的结果并不是我们想要的结果，因此现在我们需要去修改为正确的冒泡排序，修改后，测试就能正确通过了。</p>
<p>如果需要在进行所有的测试之前需要做一些前置操作，我们可以通过**@Before**注解来添加测试用例开始之前的前置操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Set up...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set up...</span><br><span class="line">Student(name=A, age=<span class="number">20</span>, gender=male, score=<span class="number">100</span>)</span><br><span class="line">Set up...</span><br><span class="line">Student(name=A, age=<span class="number">20</span>, gender=male, score=<span class="number">100</span>)</span><br><span class="line">Set up...</span><br></pre></td></tr></table></figure>

<p>可以看到在每个单元测试开始前都先执行了**@Before**注解中的代码，该端代码可以加在任意地方。</p>
<p>同理，可以使用**@After**注解来在测试最后添加结束动作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Closing...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="创建Web项目"><a href="#创建Web项目" class="headerlink" title="创建Web项目"></a>创建Web项目</h1><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191908.png" alt="QQ20220325191908.png" style="zoom:50%;" />

<p>更改依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><hr>
<p>Servlet是Java EE的一个标准，大部分的Web服务器都支持此标准，包括Tomcat。由官方定义了一系列接口，而具体实现由自己来实现，最后交给Web服务器（如Tomcat）来运行编写的Servlet。</p>
<p>可以通过实现Servlet来进行动态网页响应，使用Servlet，不再是直接由Tomcat服务器发送编写好的静态网页内容（HTML文件），而是由我们通过Java代码进行动态拼接的结果，它能够很好地实现动态网页的返回。</p>
<p>当然，Servlet并不是专用于HTTP协议通信，也可以用于其他的通信，但是一般都是用于HTTP。、</p>
<br/>

<h2 id="创建Servlet"><a href="#创建Servlet" class="headerlink" title="创建Servlet"></a>创建Servlet</h2><p>只需要创建一个类并实现Servlet接口，并添加注解**@WebServlet**来进行注册。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">		...实现接口方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="Servlet的生命周期"><a href="#Servlet的生命周期" class="headerlink" title="Servlet的生命周期"></a>Servlet的生命周期</h2><p>首先需要了解Servlet中的方法各自是在什么时候被调用的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServlet</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是构造方法！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是getServletConfig&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是getServletInfo&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动一次服务器，然后访问定义的页面，然后刷新一次再关闭服务器，得到如下的顺序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我是构造方法！</span><br><span class="line">我是init</span><br><span class="line">我是service</span><br><span class="line">我是service（刷新）</span><br><span class="line">我是destroy</span><br></pre></td></tr></table></figure>

<p>我们多次尝试访问此页面，发现init和构造方法只会执行一次，而每次访问都会执行的是service方法。因此一个Servlet的生命周期为：</p>
<ul>
<li>执行构造方法完成Servlet实例化</li>
<li>Servlet初始化后调用init()方法。</li>
<li>Servlet调用service()方法来处理客户端的请求。</li>
<li>Servlet销毁前调用destroy()方法。由JVM的垃圾回收器进行垃圾回收。</li>
</ul>
<p>实际上在Web应用程序运行时，每当浏览器向服务器发起一个请求时，都会创建一个线程执行一次service方法，来让我们处理用户的请求，并将结果响应给用户。</p>
<p><code>service</code>方法中，有<code>ServletRequest</code>和<code>ServletResponse</code>两个参数。</p>
<p>用户发起的HTTP请求被Tomcat服务器封装为了一个<code>ServletRequest</code>对象，我们得到是其实是Tomcat服务器帮助我们创建的一个实现类，HTTP请求报文中的所有内容，都可以从<code>ServletRequest</code>对象中获取。</p>
<p>同理，<code>ServletResponse</code>就是需要返回给浏览器的HTTP响应报文实体类封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先将其转换为HttpServletRequest（继承自ServletRequest，一般是此接口实现）</span></span><br><span class="line"><span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line"></span><br><span class="line">System.out.println(request.getProtocol());  <span class="comment">//获取协议版本</span></span><br><span class="line">System.out.println(request.getRemoteAddr());  <span class="comment">//获取访问者的IP地址</span></span><br><span class="line">System.out.println(request.getMethod());   <span class="comment">//获取请求方法</span></span><br><span class="line"><span class="comment">//获取头部信息</span></span><br><span class="line">Enumeration&lt;String&gt; enumeration = request.getHeaderNames();</span><br><span class="line"><span class="keyword">while</span> (enumeration.hasMoreElements())&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> enumeration.nextElement();</span><br><span class="line">    System.out.println(name + <span class="string">&quot;: &quot;</span> + request.getHeader(name));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整个HTTP请求报文中的所有内容，都可以通过<code>HttpServletRequest</code>对象来获取。</p>
<p><code>ServletResponse</code>是服务端的响应内容，可以填写我们想要发送给浏览器显示的内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"><span class="comment">//设定内容类型以及编码格式（普通HTML文本使用text/html，之后会讲解文件传输）</span></span><br><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"><span class="comment">//获取Writer直接写入内容</span></span><br><span class="line">response.getWriter().write(<span class="string">&quot;我是响应内容！&quot;</span>);</span><br><span class="line"><span class="comment">//所有内容写入完成之后，再发送给浏览器</span></span><br></pre></td></tr></table></figure>

<p>在浏览器中打开此页面，就能够收到服务器发来的响应内容。其中，响应头部分，是由Tomcat生成的一个默认响应头。</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325191923.png" alt="QQ20220325191923.png"></p>
<br/>

<h2 id="解读Servlet"><a href="#解读Servlet" class="headerlink" title="解读Servlet"></a>解读Servlet</h2><p>首先<code>Servlet</code>有一个直接实现抽象类<code>GenericServlet</code>，这个类完善了配置文件读取和<code>Servlet</code>信息相关的的操作，但是没有去实现<code>Service</code>方法，因此该类仅仅是用于完善一个Servlet的基本操作。</p>
<p><code>HttpServlet</code>是一种遵循HTTP协议的<code>Servlet</code>，继承自<code>GenericServlet</code>，它根据HTTP协议的规则，完善了<code>Service</code>方法，因此在我们需要创建<code>Servlet</code>时，只需要继承<code>HttpServlet</code>类并实现对应的请求方式就可以(doGet&#x2F;doPost)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;&lt;h1&gt;helloServlet&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="get与post"><a href="#get与post" class="headerlink" title="get与post"></a>get与post</h3><p>get请求</p>
<ul>
<li>get提交的数据会放在URL之后，以?分割URL和传输数据，参数之间以&amp;相连</li>
<li>get方式明文传递，数据量小，不安全</li>
<li>效率高，浏览器默认请求方式为get请求。对应的Servlet的方法是doGet</li>
</ul>
<p>post请求</p>
<ul>
<li>post方法是把提交的数据放在HTTP包的Body中。密文传递数据，数据量大，安全</li>
<li>效率相对没有get高</li>
<li>对应的Servlet的方法是doPost</li>
</ul>
<br/>

<h3 id="WebServlet注解"><a href="#WebServlet注解" class="headerlink" title="@WebServlet注解"></a>@WebServlet注解</h3><p><span id="@WebServlet"></span></p>
<p>通过注解可以快速注册一个Servlet，对应注解中的属性：</p>
<p><code>name</code>属性:</p>
<p>Servlet名称，而<code>urlPatterns</code>和<code>value</code>实际上是同样功能，就是代表当前Servlet的访问路径，它不仅仅可以是一个固定值，还可以进行通配符匹配：所有<code>/test/xxx</code>都可以访问此Servlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/test/*&quot;)</span></span><br></pre></td></tr></table></figure>

<p>进行某个扩展名进行匹配：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.js&quot;)</span></span><br></pre></td></tr></table></figure>

<p>为一个Servlet配置多个访问路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/test1&quot;, &quot;/test2&quot;)</span></span><br></pre></td></tr></table></figure>

<p><code>loadOnStartup</code>属性:</p>
<p>此属性决定了是否在Tomcat启动时就加载此Servlet，默认情况下，Servlet只有在被访问时才会加载，它的默认值为-1，表示不在启动时加载，我们可以将其修改为大于等于0的数，来开启启动时加载。并且数字的大小决定了此Servlet的启动优先级。</p>
<p><strong>优先级问题：指定了固定的路径优先级最高，若找不到就加载默认处理请求。</strong>(同时指定了固定路径’&#x2F;hello’与’&#x2F;*’，则会先匹配’&#x2F;hello’)</p>
<br/>

<h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><p>Web容器在启动的时候，它会为每个Web程序都创建一个对应的ServletContext对象，它代表了当前的Web应用。</p>
<p>ServletContext全局唯一，它是属于整个Web应用程序的，我们可以通过<code>getServletContext()</code>来获取到此对象。</p>
<br/>

<h3 id="数据传递"><a href="#数据传递" class="headerlink" title="数据传递"></a>数据传递</h3><p>由于ServletContext全局唯一且架构在Servlet之上，因此我们可以通过ServletContext去获取其他Servlet中的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        context.setAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;名字&quot;</span>);</span><br><span class="line"></span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;&lt;h1&gt;helloServlet&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>因为无论在哪里，无论什么时间，获取到的ServletContext始终是同一个对象，因此可以随时随地获取添加的属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/get&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ServletContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext();</span><br><span class="line"></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;&lt;h1&gt;Your name is &quot;</span> + context.getAttribute(<span class="string">&quot;name&quot;</span>) + <span class="string">&quot;&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="初始化参数"><a href="#初始化参数" class="headerlink" title="初始化参数"></a>初始化参数</h3><p>初始化参数类似于初始化配置需要的一些值，比如数据库连接相关信息，就可以通过初始化参数来给予Servlet，或是一些其他的配置项，也可以使用初始化参数来实现。</p>
<p>给一个Servlet添加一些初始化参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(value = &quot;/get&quot;, initParams = &#123;</span></span><br><span class="line"><span class="meta">        @WebInitParam(name = &quot;url&quot;, value = &quot;jdbc:mysql://localhost:3306/school&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>

<p>它也是以键值对形式保存的，可以直接通过Servlet的<code>getInitParameter</code>方法获取：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(context.getInitParameter(<span class="string">&quot;url&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>但是这里的初始化参数仅仅是针对于本Servlet。可以在web.xml中定义全局初始化参数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>url<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>jdbc:mysql://localhost:3306/school<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用ServletContext来读取全局初始化参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp.getWriter().write(<span class="string">&quot;&lt;p&gt;Init url is &quot;</span> + <span class="built_in">this</span>.getServletContext().getInitParameter(<span class="string">&quot;url&quot;</span>) + <span class="string">&quot;&lt;/p&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.getServletContext().getRequestDispatcher(<span class="string">&quot;/error&quot;</span>).forward(req, resp);</span><br></pre></td></tr></table></figure>

<p>getRequestDispatcher()中为转发的路径。</p>
<br/>

<h3 id="读取资源"><a href="#读取资源" class="headerlink" title="读取资源"></a>读取资源</h3><p>还可以获取根目录下的资源文件:</p>
<ul>
<li>在java目录下</li>
<li>在resource目录下</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/prop&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContext().getResourceAsStream(<span class="string">&quot;/WEB-INF/classes/r.properties&quot;</span>);</span><br><span class="line">        properties.load(in);</span><br><span class="line">        resp.getWriter().write(properties.getProperty(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="HttpServletResponse"><a href="#HttpServletResponse" class="headerlink" title="HttpServletResponse"></a>HttpServletResponse</h2><hr>
<p>Web服务器收到客户端的http请求，会针对每一次请求分别创建一个用于代表请求的request对象、和代表响应的response对象。</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192022.png" alt="QQ20220325192022.png"></p>
<p>要向客户机输出数据，则需要使用response对象。</p>
<p>HttpServletResponse对象代表服务器的响应。这个对象中封装了向客户端<strong>发送数据、发送响应头，发送响应状态码</strong>的方法。</p>
<br/>

<h3 id="response主要方法"><a href="#response主要方法" class="headerlink" title="response主要方法"></a>response主要方法</h3><table>
<thead>
<tr>
<th align="center">方法名称</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">setHeader(name,value)</td>
<td align="center">设置响应头</td>
</tr>
<tr>
<td align="center">setContentType(String)</td>
<td align="center">设置响应文件类型、响应格式及编码</td>
</tr>
<tr>
<td align="center">setCharacterEncoding(String)</td>
<td align="center">设置服务端响应内容编码格式</td>
</tr>
<tr>
<td align="center">getWriter()</td>
<td align="center">获取字符输出流</td>
</tr>
</tbody></table>
<br/>

<p><strong>响应状态码</strong></p>
<ul>
<li>200: 请求响应成功200</li>
<li>3xx: 请求重定向</li>
<li>4xx: 找不到资源404</li>
<li>5xx: 服务器代码错误</li>
</ul>
<br/>

<h3 id="实现下载与上传文件"><a href="#实现下载与上传文件" class="headerlink" title="实现下载与上传文件"></a>实现下载与上传文件</h3><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><p>需要引入一个工具库来帮我们在输入输出流中传数据:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在resource文件夹中放入1.png文件，编写servlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownLoadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 设置格式</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取文件路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> <span class="string">&quot;F:\\Study\\JavaWeb\\FileServlet\\src\\main\\resources\\1.png&quot;</span>;</span><br><span class="line">        <span class="comment">// 获取文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> realPath.substring(realPath.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 获取输入流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fileName);</span><br><span class="line">        <span class="comment">// 从输入流传入输出流</span></span><br><span class="line">        IOUtils.copy(fis, resp.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在index.html文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Download<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;<span class="attribute">width</span>: <span class="number">500px</span>; <span class="attribute">height</span>: <span class="number">500px</span>; <span class="attribute">margin</span>: <span class="number">0</span> auto;&#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">a</span>&#123;<span class="attribute">position</span>:relative; <span class="attribute">top</span>: <span class="number">250px</span>; <span class="attribute">left</span>:<span class="number">170px</span>; <span class="attribute">text-decoration</span>: none;&#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;file&quot;</span> <span class="attr">download</span>=<span class="string">&quot;1.png&quot;</span>&gt;</span>Click here to Download<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h4 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h4><p>在index.html中添加一个表单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;file&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Upload File&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>Upload<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意: 必须添加<code>enctype=&quot;multipart/form-data&quot;</code>，来表示此表单用于文件传输。</strong></p>
<p>修改servlet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;F:\\Study\\JavaWeb\\FileServlet\\src\\main\\resources\\1.png&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">Part</span> <span class="variable">part</span> <span class="operator">=</span> req.getPart(<span class="string">&quot;Upload File&quot;</span>);</span><br><span class="line">        IOUtils.copy(part.getInputStream(), fos);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;Upload Successfully&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意: 必须添加<code>@MultipartConfig</code>注解来表示此Servlet用于处理文件上传请求。</strong></p>
<br/>

<h4 id="验证码功能"><a href="#验证码功能" class="headerlink" title="验证码功能"></a>验证码功能</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/ image&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 设置浏览器刷新</span></span><br><span class="line">        resp.setHeader(<span class="string">&quot;refresh&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        <span class="comment">// 在内存中创建图片</span></span><br><span class="line">        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedImage</span>(<span class="number">80</span>, <span class="number">20</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="comment">// 获取图片</span></span><br><span class="line">        <span class="type">Graphics2D</span> <span class="variable">g</span> <span class="operator">=</span> (Graphics2D) image.getGraphics();</span><br><span class="line">        <span class="comment">// 设置图片背景颜色</span></span><br><span class="line">        g.setColor(Color.GRAY);</span><br><span class="line">        g.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">// 给图片写入数据</span></span><br><span class="line">        g.setColor(Color.BLACK);</span><br><span class="line">        g.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="literal">null</span>, Font.BOLD, <span class="number">20</span>));</span><br><span class="line">        g.drawString(captcha(), <span class="number">0</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="comment">// 设置浏览器用图片形式打开</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;image/jpg&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置浏览器不缓存</span></span><br><span class="line">        resp.setDateHeader(<span class="string">&quot;Expires&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        resp.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        <span class="comment">// 将图片写给浏览器</span></span><br><span class="line">        ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, resp.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">captcha</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> rand.nextInt(<span class="number">999999</span>)+<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span> - s.length(); i++) &#123;</span><br><span class="line">            buf.append(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (buf + s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="实现重定向"><a href="#实现重定向" class="headerlink" title="实现重定向"></a>实现重定向</h3><p>当我们希望做完某个操作之后，直接跳转到另一个页面，可以使用重定向来完成。</p>
<p>当浏览器收到一个重定向的响应时，会按照重定向响应给出的地址，再次向此地址发出请求。</p>
<p>编写Servlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resp.sendRedirect(<span class="string">&quot;/image&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>编写index.html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost:8080//redirect&quot;</span> &gt;</span>Click here to redirect<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以发现，&lt;a&gt;标签跳转到的是redirect页面，但地址栏直接变成了image页面。</p>
<p>调用后响应的状态码会被设置为302，并且响应头中添加了一个Location属性，此属性表示，需要重定向到哪一个网址。</p>
<br/>

<h3 id="重定向与请求转发的区别"><a href="#重定向与请求转发的区别" class="headerlink" title="重定向与请求转发的区别"></a>重定向与请求转发的区别</h3><p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192016.png" alt="QQ20220325192016.png"></p>
<ul>
<li>请求转发是一次请求，重定向是两次请求</li>
<li>请求转发地址栏不会发生改变， 重定向地址栏会发生改变</li>
<li>请求转发可以共享请求参数 ，重定向之后，就获取不了共享参数了</li>
<li>请求转发只能转发给内部的Servlet</li>
</ul>
<br/>

<h2 id="HttpServletRequest"><a href="#HttpServletRequest" class="headerlink" title="HttpServletRequest"></a>HttpServletRequest</h2><hr>
<p>代表Http的请求。要获取客户机提交过来的数据，需要使用request对象。</p>
<br/>

<h3 id="request主要方法"><a href="#request主要方法" class="headerlink" title="request主要方法"></a>request主要方法</h3><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">String getParameter(String name)</td>
<td align="center">根据名字获取提交的数据</td>
</tr>
<tr>
<td align="center">viod setCharacterEncoding(String charset)</td>
<td align="center">指定请求的编码格式</td>
</tr>
</tbody></table>
<br/>

<h3 id="获取前端参数并请求转发"><a href="#获取前端参数并请求转发" class="headerlink" title="获取前端参数并请求转发"></a>获取前端参数并请求转发</h3><p>index.jsp:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;text-align:center&quot;</span>&gt;</span><br><span class="line">        &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/login&quot;</span>&gt;</span><br><span class="line">                用户名:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">                密码 :&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">            科目:</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;subject&quot;</span> value=<span class="string">&quot;Java&quot;</span>&gt;Java</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;subject&quot;</span> value=<span class="string">&quot;C/C++&quot;</span>&gt;C/C++</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;subject&quot;</span> value=<span class="string">&quot;Python&quot;</span>&gt;Python</span><br><span class="line">                &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;subject&quot;</span> value=<span class="string">&quot;JavaScript&quot;</span>&gt;JavaScript&lt;br&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>Servlet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(request.getParameter(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">        System.out.println(request.getParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">        System.out.println(Arrays.toString(request.getParameterValues(<span class="string">&quot;subject&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;Info.jsp&quot;</span>).forward(request, response);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Info.jsp:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Success&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="Servlet线程安全问题"><a href="#Servlet线程安全问题" class="headerlink" title="Servlet线程安全问题"></a>Servlet线程安全问题</h2><p>Servlet在访问之后，会执行实例化操作，创建一个Servlet对象。而我们Tomcat容器可以同时多个线程并发访问同一个Servlet，如果在方法中对成员变量做修改操作，就会有线程安全的问题。</p>
<br/>

<h3 id="保证线程安全"><a href="#保证线程安全" class="headerlink" title="保证线程安全"></a>保证线程安全</h3><ul>
<li><p>synchronized</p>
<ul>
<li>将存在线程安全问题的代码放到同步代码块中。</li>
</ul>
</li>
<li><p>实现singleThreadModel接口</p>
<ul>
<li>servlet实现singleThreadModel接口后，每个线程都会创建servlet实例，这样每个客户端请求就不存在共享资源的问题，但是servlet响应客户端请求的效率太低，所以已经淘汰。</li>
</ul>
</li>
<li><p><strong>尽可能使用局部变量</strong></p>
</li>
</ul>
<br/>

<h1 id="Servlet-JDBC"><a href="#Servlet-JDBC" class="headerlink" title="Servlet + JDBC"></a>Servlet + JDBC</h1><hr>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE admin(</span><br><span class="line">	`username` VARCHAR(20) PRIMARY KEY NOT NULL,</span><br><span class="line">	`password` VARCHAR(20) NOT NULL,</span><br><span class="line">	`phone` VARCHAR(11) NOT NULL,</span><br><span class="line">	`address` VARCHAR(20) NOT NULL</span><br><span class="line">)CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO admin(username, `password`, phone, address)</span><br><span class="line">VALUES(&#x27;xiaoA&#x27;, &#x27;123456&#x27;, &#x27;12345678901&#x27;, &#x27;北京&#x27;)</span><br><span class="line">INSERT INTO admin(username, `password`, phone, address)</span><br><span class="line">VALUES(&#x27;xiaoB&#x27;, &#x27;123456&#x27;, &#x27;12345178901&#x27;, &#x27;北京&#x27;)</span><br><span class="line">INSERT INTO admin(username, `password`, phone, address)</span><br><span class="line">VALUES(&#x27;xiaoC&#x27;, &#x27;123456&#x27;, &#x27;13213678901&#x27;, &#x27;北京&#x27;)</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="properties配置文件"><a href="#properties配置文件" class="headerlink" title="properties配置文件"></a>properties配置文件</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span> = <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">jdbc:mysql://localhost:3306/school</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">123456</span></span><br><span class="line"><span class="attr">initialSize</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">maxActive</span> = <span class="string">20</span></span><br><span class="line"><span class="attr">minIdle</span> = <span class="string">5</span></span><br><span class="line"><span class="attr">maxWait</span> = <span class="string">3000</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="DbUtils工具类"><a href="#DbUtils工具类" class="headerlink" title="DbUtils工具类"></a>DbUtils工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DruidDataSource ds;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; THREAD_LOCAL = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> DbUtils.class.getResourceAsStream(<span class="string">&quot;/db.properties&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(in);</span><br><span class="line">            ds = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> THREAD_LOCAL.get();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(conn == <span class="literal">null</span>)&#123;</span><br><span class="line">                conn = ds.getConnection();</span><br><span class="line">                THREAD_LOCAL.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            closeAll(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.rollback();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            closeAll(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection conn, Statement statement, ResultSet rs)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs != <span class="literal">null</span>)&#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>)&#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">                THREAD_LOCAL.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：properties配置文件要放在该模块src目录下的resource中，否则可能不能找到</strong></p>
<br/>

<h2 id="创建实体类Admin"><a href="#创建实体类Admin" class="headerlink" title="创建实体类Admin"></a>创建实体类Admin</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Admin</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdminDao</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Admin admin)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Admin admin)</span>;</span><br><span class="line">    Admin <span class="title function_">select</span><span class="params">(String username)</span>;</span><br><span class="line">    List&lt;Admin&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="DaoImpl"><a href="#DaoImpl" class="headerlink" title="DaoImpl"></a>DaoImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Admin admin)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Admin admin)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Admin <span class="title function_">select</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM admin WHERE username=?;&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;Admin&gt;(Admin.class), username);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Admin&gt; <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM admin;&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;Admin&gt;(Admin.class));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们这里只需要实现登录与查询功能，因此其他方法暂不实现。</p>
<br/>

<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line">    Admin <span class="title function_">login</span><span class="params">(String username, String password)</span>;</span><br><span class="line">    List&lt;Admin&gt; <span class="title function_">showAllAdmin</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="ServiceImpl"><a href="#ServiceImpl" class="headerlink" title="ServiceImpl"></a>ServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">AdminDao</span> <span class="variable">adminDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Admin <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">Admin</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> adminDao.select(username);</span><br><span class="line">            <span class="keyword">if</span> (admin != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (admin.getPassword().equals(password))&#123;</span><br><span class="line">                    result = admin;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Admin&gt; <span class="title function_">showAllAdmin</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Admin&gt; admins = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            admins = adminDao.selectAll();</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> admins;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="Servlet-1"><a href="#Servlet-1" class="headerlink" title="Servlet"></a>Servlet</h2><p>loginServlet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 设置字符集</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="comment">// 调用service</span></span><br><span class="line">        <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> adminService.login(username, password);</span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span>(admin != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 响应给客户端</span></span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;结果页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h1&gt;登录成功&lt;/h1&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;结果页面&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h1&gt;登录失败&lt;/h1&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ShowAllServlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/show&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">        List&lt;Admin&gt; list = adminService.showAllAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;table border=&#x27;1&#x27; solid=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;username&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;password&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;phone&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;address&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Admin admin : list) &#123;</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getUsername() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getPassword() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getPhone() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getAddress() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/table&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h2&gt;没有数据&lt;/h2&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>在我们上面写的案例中，调用业务逻辑和显示结果都编写在同一个Servlet中：</p>
<ul>
<li>不符合单一职能原则</li>
<li>不利于后续修改</li>
</ul>
<p>因此我们考虑将ShowAllServlet分离为ShowAllController和ShowAllJSP两个Servlet，分别控制业务逻辑与显示页面功能。</p>
<p>但是我们发现，直接分离代码会造成ShowAllJSP无法获得到ShowAllController中调用业务逻辑得到的数据；同时ShowAllController也无法跳转到ShowAllJSP显示的页面。</p>
<p>对于<strong>页面跳转</strong>，我们可以考虑<strong>请求转发</strong>或<strong>重定向</strong>来实现。</p>
<p>对于业务逻辑中获取到的数据，可以考虑通过<strong>同一次request作用域中的数据</strong>做存储，实现数据的传递。</p>
<br/>

<h3 id="ShowAllController"><a href="#ShowAllController" class="headerlink" title="ShowAllController"></a>ShowAllController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/showCtrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">        List&lt;Admin&gt; list = adminService.showAllAdmin();</span><br><span class="line">        req.setAttribute(<span class="string">&quot;admins&quot;</span>, list);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/showJSP&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="ShowAllJSP"><a href="#ShowAllJSP" class="headerlink" title="ShowAllJSP"></a>ShowAllJSP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/showJSP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllJSP</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        List&lt;Admin&gt; list = (List) req.getAttribute(<span class="string">&quot;admins&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;table border=&#x27;1&#x27; solid=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;username&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;password&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;phone&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;address&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Admin admin : list) &#123;</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getUsername() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getPassword() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getPhone() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + admin.getAddress() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/table&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h2&gt;没有数据&lt;/h2&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>由于HTTP协议是<strong>无状态</strong>的，不能保存每次提交的信息。即：如果用户发来一个新的请求，服务器无法知道它是否与上次的请求有联系。</p>
<p>对于那些需要多次提交数据才能完成的web操作就会出问题，如登录。</p>
<p>因此就需要将浏览器与web服务器之间多次交互当作一个整体来处理，并且将多次交互所涉及的数据(即状态)保存下来。</p>
<br/>

<h2 id="技术分类"><a href="#技术分类" class="headerlink" title="技术分类"></a>技术分类</h2><ul>
<li>客户端状态管理技术：将状态保存在客户端。代表性的是<strong>Cookie</strong>技术。</li>
<li>服务器状态管理技术：将状态保存在服务器端。代表性的是<strong>session</strong>技术（服务器传递sessionID时需要使用cookie的方式)和application。</li>
</ul>
<br/>

<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>Cookie是在浏览器访问web服务器的某个资源时，由Web服务器在HTTP响应消息头中附带传送给浏览器的一小段数据。</p>
<p>一旦web浏览器保存了某个cookie，那么它在以后每次访问该web服务器时，都应在HTTP请求头中将这个Cookie回传给Web服务器。</p>
<p>一个cookie主要由标识该信息的名称(name)和值(value)组成。</p>
<br/>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192110.png" alt="QQ20220325192110.png"></p>
<br/>

<h3 id="创建Cookie"><a href="#创建Cookie" class="headerlink" title="创建Cookie"></a>创建Cookie</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Cookie对象</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoA&quot;</span>);</span><br><span class="line"><span class="comment">// 设置访问路径</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/get&quot;</span>);</span><br><span class="line"><span class="comment">// 设置生命周期</span></span><br><span class="line">cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);    <span class="comment">// 取值有三种: &gt;0 有效期为秒;  =0 浏览器关闭; &lt;0 内存存储; 默认为-1.</span></span><br><span class="line"><span class="comment">// 将Cookie响应给客户端</span></span><br><span class="line">resp.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>Chrome浏览器查看Cookie信息：chrome:&#x2F;&#x2F;settings&#x2F;cookies</p>
<br/>

<h3 id="获取Cookie"><a href="#获取Cookie" class="headerlink" title="获取Cookie"></a>获取Cookie</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过request对象获取所有的Cookie</span></span><br><span class="line">Cookie[] cookies = req.getCookies();</span><br><span class="line"><span class="comment">// 遍历cookie数组</span></span><br><span class="line"><span class="keyword">if</span>(cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">        System.out.println(cookie.getName() + <span class="string">&quot; : &quot;</span> + cookie.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="修改Cookie"><a href="#修改Cookie" class="headerlink" title="修改Cookie"></a>修改Cookie</h3><p><strong>只需要保证cookie的名和路径一致即可修改</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cookie名相同</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoB&quot;</span>);</span><br><span class="line"><span class="comment">// 访问路径相同</span></span><br><span class="line">cookie.setPath(<span class="string">&quot;/get&quot;</span>);</span><br><span class="line">cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>);</span><br><span class="line">resp.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>在依次访问 &#x2F;cookie, &#x2F;get, &#x2F;cookie2, &#x2F;get后，我们发现控制台打印的cookie的name值已经变为了xiaoB。</p>
<p>**注意: **</p>
<ul>
<li><p><strong>改变cookie的键、有效路径会新建cookie</strong></p>
</li>
<li><p><strong>改变cookie的值、有效期会覆盖原有cookie</strong></p>
</li>
</ul>
<br/>

<h3 id="Cookie编码与解码"><a href="#Cookie编码与解码" class="headerlink" title="Cookie编码与解码"></a>Cookie编码与解码</h3><p>Cookie默认不支持中文，只能包含ASCII字符，所以cookie需要对Unicode字符进行编码，否则会出现乱码。</p>
<ul>
<li>编码使用java.net.URLEncoder类的encode(String str, String encoding)方法</li>
<li>解码使用java.net.URLDecoder类的decode(String str, String encoding)方法</li>
</ul>
<br/>

<h4 id="创建带中文的Cookie"><a href="#创建带中文的Cookie" class="headerlink" title="创建带中文的Cookie"></a>创建带中文的Cookie</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建时使用UTF-8进行编码</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(</span><br><span class="line">        URLEncoder.encode(<span class="string">&quot;姓名&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>),</span><br><span class="line">        URLEncoder.encode(<span class="string">&quot;小C&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">cookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">resp.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies = req.getCookies();</span><br><span class="line"><span class="comment">// 遍历cookie数组</span></span><br><span class="line"><span class="keyword">if</span> (cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">        <span class="comment">// 读取时使用UTF-8进行解码</span></span><br><span class="line">        System.out.println(URLDecoder.decode(cookie.getName(), <span class="string">&quot;utf-8&quot;</span>) + <span class="string">&quot; : &quot;</span> + URLDecoder.decode(cookie.getValue(), <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="Cookie的优缺点"><a href="#Cookie的优缺点" class="headerlink" title="Cookie的优缺点"></a>Cookie的优缺点</h3><p><strong>优点</strong></p>
<ol>
<li>可配置到期规则。</li>
<li>简单性: Cookie是一种基于文本的轻量结构，包含简单的键值对。</li>
<li>数据持久性: Cookie默认在过期之前是可以一直存在客户端浏览器上的。</li>
</ol>
<p><strong>缺点</strong></p>
<ol>
<li>大小受到限制: 大多数浏览器对cookie的大小有4K、8K字节的限制。</li>
<li>用户配置为禁用: 有些用户禁用了浏览器或客户端设备接收Cookie的能力，因此限制了这一功能。</li>
<li>潜在的安全风险: Cookie可能会被篡改。会对安全性造成潜在风险或者导致依赖于Cookie的应用程序失败。</li>
</ol>
<br/>

<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>Session用于记录用户的状态。Session指的是<strong>在一段时间内</strong>，单个客户端与Web服务器的<strong>一连串相关的交互过程</strong>。<br>在一个Session中，客户可能会多次请求访问同一个资源，也有可能请求访问各种不同的服务器资源。</p>
<br/>

<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>服务器会为每一次会话分配一个Session对象。同一个浏览器发起的多次请求，同属于一次会话(Session)。</p>
<p><strong>首次使用到Session时</strong>，服务器会自动创建Session，并创建Cookie存储SessionId发送回客户端。</p>
<p><strong>注意：session是有服务端创建的。</strong></p>
<br/>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><strong>Session作用域：拥有存储数据的空间，作用范围是一次会话内有效。</strong></p>
<ul>
<li>一次会话是使用同一浏览器发送的多次请求。一旦浏览器关闭，则结束会话</li>
<li>可以将数据存入Session中，在一次会话的任意位置进行获取</li>
<li>可传递任何数据(基本数据类型、对象、集合、数组)</li>
</ul>
<br/>

<h4 id="获取Session"><a href="#获取Session" class="headerlink" title="获取Session"></a>获取Session</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">// 通过request对象获取Session</span></span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">    System.out.println(<span class="string">&quot;SessionId: &quot;</span> + session.getId());	<span class="comment">// 唯一标记</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们启动服务器并访问页面时，控制台打印出一条消息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SessionId: <span class="number">551</span>FE9DBFF3A57F291BE459AC7AEF875</span><br></pre></td></tr></table></figure>

<p>当我们关闭浏览器但不关闭服务器，再次访问页面：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SessionId: B410C2660B254CDD1227B517E8E61D6C</span><br></pre></td></tr></table></figure>

<p>这次我们添加新标签页并关闭上一个页面，再次访问：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SessionId: B410C2660B254CDD1227B517E8E61D6C</span><br></pre></td></tr></table></figure>

<p>因此：</p>
<ul>
<li><strong>服务器会为每一次会话创建一个Session</strong></li>
<li><strong>Session的作用域为一次会话内，浏览器关闭时Session也会清除</strong></li>
<li><strong>Session是自动创建的</strong></li>
</ul>
<p>我们关闭服务器后重新开启，观察当进入localhost:8080页面时的Response Header：</p>
<img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192125.png" alt="QQ20220325192125.png" style="zoom:67%;" />

<p>发现在响应标头的Set-Cookie中出现了我们的JSESSIONID，还有设置的路径与HttpOnly。</p>
<p>因此：</p>
<ul>
<li><strong>Session是借助Cookie发送给客户端的</strong></li>
</ul>
<p>我们进入SessionServlet页面，观察其Request Header：</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192230.png" alt="QQ20220325192230.png"></p>
<p>发现在请求标头中的Cookie里包含着上面出现过的SessionID。而在请求标头中的数据是请求时客户端发送给服务端的数据。</p>
<p><strong>总结：</strong></p>
<ul>
<li><strong>第一次访问时没有Session则触发创建，服务端发送给客户端一个以Cookie形式存储的SessionID。</strong></li>
<li><strong>第二次访问时，已经创建了Session且处于同一会话，客户端将Session回传给服务端，指明本次与上一次请求时同一次会话</strong></li>
</ul>
<br/>

<h4 id="设置Session数据"><a href="#设置Session数据" class="headerlink" title="设置Session数据"></a>设置Session数据</h4><blockquote>
<p>setAttribute(属性名，Object) 设置Session中的数据以保存在Session中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.setAttribute(<span class="string">&quot;key&quot;</span>, value);	<span class="comment">// 以键值对形式存储在Session作用域中</span></span><br></pre></td></tr></table></figure>

<br/>

<h4 id="获取Session数据"><a href="#获取Session数据" class="headerlink" title="获取Session数据"></a>获取Session数据</h4><blockquote>
<p>getAttribute(属性名) 获取Session中保存的值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.getAttribute(<span class="string">&quot;key&quot;</span>);  <span class="comment">// 通过String类型的key访问Object类型的value</span></span><br></pre></td></tr></table></figure>

<br/>

<h4 id="删除Session数据"><a href="#删除Session数据" class="headerlink" title="删除Session数据"></a>删除Session数据</h4><blockquote>
<p>removeAttribute(属性名) 从Session中删除数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.removeAttribute(<span class="string">&quot;key&quot;</span>);  <span class="comment">// 通过键移除Session作用域中的值</span></span><br></pre></td></tr></table></figure>

<br/>

<p>我们创建三个Servlet，分别用来设置Session、获取Session、删除Session：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetServlet</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoA&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetServlet</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        System.out.println(<span class="string">&quot;session&quot;</span> + (String)session.getAttribute(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RemoveServelt</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        session.removeAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启服务器，依次访问Set页面、Get页面、Remove页面、Get页面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoA</span><br><span class="line"><span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>我们看到，GetServlet能获取到SetServlet设置的Session中的数据，而RemoveServlet也能删除Session中的数据。</p>
<p><strong>总结：</strong></p>
<ul>
<li><strong>同属于一个会话的Servlet共享一个Session。在该会话内，他们都可以在任何位置、任何时间做设置保存、获取、删除Session中的值的操作。</strong></li>
</ul>
<br/>

<h3 id="Session与Request"><a href="#Session与Request" class="headerlink" title="Session与Request"></a>Session与Request</h3><p>Request是一次请求有效，请求改变则Request也改变。</p>
<p>Session是一次会话有效，浏览器改变则Session改变。</p>
<p>考虑以下情况，使用request和session来获取数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SetServlet</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">    session.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoA&quot;</span>);</span><br><span class="line">    req.setAttribute(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    resp.sendRedirect(<span class="string">&quot;/get&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetServlet</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        System.out.println(<span class="string">&quot;session: &quot;</span> + (String)session.getAttribute(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    	System.out.println(<span class="string">&quot;request: &quot;</span> + (String)req.getAttribute(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">session: xiaoA</span><br><span class="line">request: <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p><strong>在重定向中，客户端发送了两次请求。而Request作用域是一次请求有效，所以获取不到值。而这两次请求仍是一次会话，因此Session可以获取到值。</strong></p>
<br/>

<h3 id="Session生命周期"><a href="#Session生命周期" class="headerlink" title="Session生命周期"></a>Session生命周期</h3><ul>
<li><p>开始: 第一次使用到Session的请求产生，则创建Session</p>
</li>
<li><p>结束:</p>
<ul>
<li><p>浏览器关闭，则失效</p>
</li>
<li><p>Session超时，则失效</p>
<ul>
<li>session.setMaxInactiveInterval(seconds);&#x2F;&#x2F;设置最大有效时间</li>
</ul>
</li>
<li><p>手工销毁，则失效</p>
<ul>
<li>session.invalidate();&#x2F;&#x2F;登录退出、注销</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>

<h3 id="浏览器禁用Cookie的解决方案"><a href="#浏览器禁用Cookie的解决方案" class="headerlink" title="浏览器禁用Cookie的解决方案"></a>浏览器禁用Cookie的解决方案</h3><p>服务器在默认情况下，会使用Cookie的方式将SessionID发送给浏览器。</p>
<p>如果用户禁止Cookie，则SessionID不会被浏览器保存。此时服务器可以使用如URL重写这样的方式来发送SessionID。</p>
<br/>

<h4 id="URL重写"><a href="#URL重写" class="headerlink" title="URL重写"></a>URL重写</h4><p>浏览器在访问服务器上的某个地址时，不再使用原来的那个地址，而是使用经过改写的地址(即在原来的地址后面加上了SessionID)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line"><span class="comment">// 重写URL 追加SessionID</span></span><br><span class="line"><span class="type">String</span> <span class="variable">newURL</span> <span class="operator">=</span> resp.encodeRedirectURL(<span class="string">&quot;/get&quot;</span>);</span><br><span class="line">System.out.println(newURL);</span><br><span class="line"></span><br><span class="line">resp.sendRedirect(newURL);</span><br></pre></td></tr></table></figure>

<p>我们发现：</p>
<p><img src="https://gitee.com/Ssssv11/typora/raw/master/image-20220323212107115.png" alt="image-20220323212107115"></p>
<p>即使客户端禁用了Cookie，我们也可以通过重写URL来保证多次请求仍属于同一个会话。</p>
<br/>

<h2 id="Session权限验证"><a href="#Session权限验证" class="headerlink" title="Session权限验证"></a>Session权限验证</h2><p>在之前创建的显示数据库内容的项目中，每个用户登录都能看到所有的数据库数据，这显然很不合理。因此我们可以利用Session来实现用户权限的验证。</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192313.png" alt="QQ20220325192313.png"></p>
<h3 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE manager(</span><br><span class="line">	`name` VARCHAR(20) PRIMARY KEY,</span><br><span class="line">	`password` VARCHAR(20) NOT NULL</span><br><span class="line">)charset=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO manager(`name`, `password`)</span><br><span class="line">VALUES(&#x27;Arron&#x27;, &#x27;123456&#x27;)</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建实体类Manager"><a href="#创建实体类Manager" class="headerlink" title="创建实体类Manager"></a>创建实体类Manager</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Manager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建ManagerDao"><a href="#创建ManagerDao" class="headerlink" title="创建ManagerDao"></a>创建ManagerDao</h3><p>由于manager登录只需要查询一条，因此使用函数式接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ManagerDao</span> &#123;</span><br><span class="line">    Manager <span class="title function_">select</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建实现类ManagerDaoImpl"><a href="#创建实现类ManagerDaoImpl" class="headerlink" title="创建实现类ManagerDaoImpl"></a>创建实现类ManagerDaoImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">ManagerDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Manager <span class="title function_">select</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM manager WHERE name=?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(Manager.class), name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建ManagerService接口"><a href="#创建ManagerService接口" class="headerlink" title="创建ManagerService接口"></a>创建ManagerService接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ManagerService</span> &#123;</span><br><span class="line">    Manager <span class="title function_">login</span><span class="params">(String name, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建实现类ManagerServiceImpl"><a href="#创建实现类ManagerServiceImpl" class="headerlink" title="创建实现类ManagerServiceImpl"></a>创建实现类ManagerServiceImpl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ManagerService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ManagerDao</span> <span class="variable">managerDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Manager <span class="title function_">login</span><span class="params">(String name, String password)</span> &#123;</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            <span class="type">Manager</span> <span class="variable">test</span> <span class="operator">=</span> managerDao.select(name);</span><br><span class="line">            <span class="keyword">if</span> (test != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (test.getPassword().equals(password))&#123;</span><br><span class="line">                    manager = test;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建mgrLogin页面"><a href="#创建mgrLogin页面" class="headerlink" title="创建mgrLogin页面"></a>创建mgrLogin页面</h3><p>提交后跳转到验证的Servlet中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>管理员登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/mgr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            用户名:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            密码:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h3 id="创建LoginMgrControllerServlet"><a href="#创建LoginMgrControllerServlet" class="headerlink" title="创建LoginMgrControllerServlet"></a>创建LoginMgrControllerServlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/mgr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginMgrController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 处理中文乱码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用业务方法</span></span><br><span class="line">        <span class="type">ManagerServiceImpl</span> <span class="variable">managerServiceImpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ManagerServiceImpl</span>();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> managerServiceImpl.login(name, pwd);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理结果</span></span><br><span class="line">        <span class="keyword">if</span> (manager != <span class="literal">null</span>)&#123;   <span class="comment">// 登录成功</span></span><br><span class="line">            <span class="comment">// 将manager信息存储在Session中</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;mgr&quot;</span>, manager);</span><br><span class="line">            <span class="comment">// 跳转: 重定向</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/showCtrl&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123; <span class="comment">// 失败跳转到登录界面</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/mgrLogin.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在该Servlet中，调用业务方法。若登录成功则将manager信息存储在Session中，使用重定向跳转方式跳转到ShowAllServlet；否则跳转到登录页面。</p>
<h3 id="修改ShowAllServlet"><a href="#修改ShowAllServlet" class="headerlink" title="修改ShowAllServlet"></a>修改ShowAllServlet</h3><p><span id="showAllServlet"></span></p>
<p>对于ShowAllServlet中我们需要修改逻辑：</p>
<ul>
<li>首先获取Session中的数据验证权限</li>
<li>若Session中有数据，则是在本次会话中登录成功过的，则跳转到数据页面；否则跳转到登录页面。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/showCtrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 利用Session进行权限验证</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> (Manager) session.getAttribute(<span class="string">&quot;mgr&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (manager != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">            List&lt;Admin&gt; list = adminService.showAllAdmin();</span><br><span class="line">            req.setAttribute(<span class="string">&quot;admins&quot;</span>, list);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/showJSP&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/mgrLogin.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就利用Session实现了权限验证的操作。</p>
<br/>

<h2 id="Session保存验证码"><a href="#Session保存验证码" class="headerlink" title="Session保存验证码"></a>Session保存验证码</h2><p>首先导入依赖:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建生成验证码的Servlet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(value = &quot;/createCode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateCodeController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 创建验证码图片</span></span><br><span class="line">        <span class="type">ValidateCode</span> <span class="variable">code</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValidateCode</span>(<span class="number">200</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将验证码图片响应给客户端</span></span><br><span class="line">        code.write(resp.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再在mgrLogin.html页面中添加输入验证码与显示验证码的标签:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">    验证码:</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;ValidateCode&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/createCode&quot;</span> \&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>就可以实现验证码功能。但是现在的验证码还未实现验证的功能，因为我们只是显示出来了验证码，还没有去判断它是否输入正确，因此首先需要在创建验证码时将验证码信息存入Session：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">session.setAttribute(<span class="string">&quot;codes&quot;</span>, code.getCode());</span><br></pre></td></tr></table></figure>

<p>然后在控制登录的Servlet中去判断输入的验证码是否与Session中验证码相同：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!kaptcha.isEmpty() &amp;&amp; kaptcha.equalsIgnoreCase((String) req.getSession().getAttribute(<span class="string">&quot;codes&quot;</span>)))&#123;</span><br><span class="line">    <span class="comment">// 判断登录部分</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resp.sendRedirect(<span class="string">&quot;/mgrLogin.html&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><hr>
<h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>过滤器（Filter)是处于客户端与服务器目标资源之间的一道过滤技术。</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192328.png" alt="QQ20220325192328.png"></p>
<br/>

<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ul>
<li><strong>Filter执行顺序在Servlet之前</strong>，客户端发送请求时，会先经过Filter，再到达目标Servlet中。响应时，会根据执行流程再次反向执行Filter</li>
<li>可以解决多个Servlet代码冗余的问题（例如: 乱码处理、登录验证)</li>
</ul>
<p>过滤器相当于在所有访问前加了一堵墙，来自浏览器的所有访问请求都会首先经过过滤器，只有过滤器允许通过的请求，才可以顺利地到达对应的Servlet，而过滤器不允许的通过的请求，我们可以自由地进行控制是否进行重定向或是请求转发。并且过滤器可以添加多个，就相当于添加了很多堵墙，我们的请求只有穿过层层阻碍，才能进入Servlet。</p>
<br/>

<h2 id="创建Filter"><a href="#创建Filter" class="headerlink" title="创建Filter"></a>创建Filter</h2><p>Servlet API中提供了一个Filter接口，编写一个Java类实现这个接口即可，这个Java类称之为过滤器(Filter)</p>
<h3 id="过滤器配置"><a href="#过滤器配置" class="headerlink" title="过滤器配置"></a>过滤器配置</h3><p>在自定义的Filter类上使用注解@WebFilter(value&#x3D;”&#x2F;过滤目标资源”)，创建过滤器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/MyServlet&quot;)</span>  <span class="comment">// 拦截路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123; <span class="comment">// 实现Filter接口</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Start of MyFilter&quot;</span>);	 <span class="comment">// 编写拦截逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建Servlet-1"><a href="#创建Servlet-1" class="headerlink" title="创建Servlet"></a>创建Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/MyServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Start of MyServlet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们运行访问MyServlet发现：控制台打印了”Start of MyFilter”而没有打印”Start of MyServlet”，这是我们的Filer生效了。说明在我们访问MyServlet时先经过了MyFilter过滤器，在Filter中进行拦截。</p>
<p>在MyFilter的doFilter()方法后添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 让请求继续</span></span><br><span class="line">filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">System.out.println(<span class="string">&quot;End of MyFilter&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>我们再次访问：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Start of MyFilter</span><br><span class="line">Start of MyServlet   </span><br><span class="line">End of MyFilter</span><br></pre></td></tr></table></figure>

<p>这说明了Filter的流程：</p>
<p><strong>拦截请求执行Filter过滤 -&gt; 将请求传递 -&gt; Servlet响应 -&gt; 回到Filter执行Filter后续。</strong></p>
<br/>

<h3 id="拦截路径配置"><a href="#拦截路径配置" class="headerlink" title="拦截路径配置"></a>拦截路径配置</h3><p>过滤器的拦截路径与之前的@WebServlet注解路径的规则一致。</p>
<p><a href="#@WebServlet">@WebServlet</a></p>
<br/>

<h2 id="过滤器链与优先级"><a href="#过滤器链与优先级" class="headerlink" title="过滤器链与优先级"></a>过滤器链与优先级</h2><h2 id="过滤器链"><a href="#过滤器链" class="headerlink" title="过滤器链"></a>过滤器链</h2><p>客户端对服务器请求之后，服务器调用Servlet之前会执行一组过滤器(多个过滤器)，这组过滤器就称为一条过滤器链。</p>
<p>每个过滤器实现某个特定的功能，当第一个Filter的doFilter方法被调用时，Web服务器会创建一个代表Filter链的FilterChain对象传递给该方法。在doFilter方法中如果调用了FilterChain对象的doFilter方法，Web服务器则会检查FilterChain对象中是否还有Filter。<strong>如果有则调用下一个filter，如果没有则调用目标资源。</strong></p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192352.png" alt="QQ20220325192352.png"></p>
<br/>

<h3 id="过滤器优先级"><a href="#过滤器优先级" class="headerlink" title="过滤器优先级"></a>过滤器优先级</h3><p>在一个Web应用中，可以编写多个Filter。这些Filter组合起来称之为一个Filter链。</p>
<p><strong>优先级:</strong></p>
<ul>
<li>注解配置：按照类全名称的字符串顺序来决定执行顺序</li>
<li>xml配置：按照filter-mapping注册顺序从上往下执行</li>
</ul>
<p><strong>注意：</strong></p>
<ul>
<li><strong>xml配置优先级高于注解方式</strong></li>
<li><strong>如果xml和注解同时配置，则会创建多个过滤器对象，造成过滤多次</strong></li>
</ul>
<p>因此，我们一般只需要配置注解。</p>
<br/>

<h2 id="过滤器应用"><a href="#过滤器应用" class="headerlink" title="过滤器应用"></a>过滤器应用</h2><h3 id="过滤器解决编码"><a href="#过滤器解决编码" class="headerlink" title="过滤器解决编码"></a>过滤器解决编码</h3><p><strong>首先创建Servlet</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/login2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 直接接收参数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Username: &quot;</span> + req.getParameter(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;Password: &quot;</span> + req.getParameter(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里我们直接接收客户端的输入，不对编码进行修改。</p>
<p><strong>创建HTML页面</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/login2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            用户名:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">            密码:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建过滤器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/login2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 同一处理请求和响应的编码</span></span><br><span class="line">        servletRequest.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 让请求继续</span></span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在过滤器中我们对Servlet进行过滤，设置其字符编码后继续请求。</p>
<p>启动服务器后，在页面输入中文，发现控制台没有出现乱码情况。</p>
<p>在今后有多个Servlet需要设置字符编码时，可以将注解中的路径改为：<code>@WebFilter(&quot;/*&quot;)</code>。</p>
<br/>

<h3 id="过滤器权限验证"><a href="#过滤器权限验证" class="headerlink" title="过滤器权限验证"></a>过滤器权限验证</h3><p>在<a href="#showAllServlet">Session小节</a>中，我们所编写的权限验证放在了用来控制展示所有信息的Servlet中。现在我们就可以将权限验证业务放入到Filter中，让Servlet只关系业务调用就行。</p>
<p>首先创建Filter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/showCtrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 拆箱</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        <span class="comment">// 利用Session进行权限验证</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Manager</span> <span class="variable">manager</span> <span class="operator">=</span> (Manager) session.getAttribute(<span class="string">&quot;mgr&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (manager != <span class="literal">null</span>) &#123;</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/mgrLogin.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：doFilter()方法中的ServletRequest与ServletResponse是HttpRequest与HttpResponse的父类，这里不能直接使用servletRequest去获取Session，必须先进行拆箱操作。</strong></p>
<p>修改Servlet，让其只负责调用业务逻辑功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/showCtrl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">            <span class="comment">// 只负责调用业务逻辑功能</span></span><br><span class="line">            <span class="type">AdminService</span> <span class="variable">adminService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminServiceImpl</span>();</span><br><span class="line">            List&lt;Admin&gt; list = adminService.showAllAdmin();</span><br><span class="line">            req.setAttribute(<span class="string">&quot;admins&quot;</span>, list);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/showJSP&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h1><p>在GUI中已经有过监听器的学习，默认为我们提供了很多类型的监听器，我们这里就演示一下监听Session的创建即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">HttpSessionListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;有一个Session被创建了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="EMS员工管理系统"><a href="#EMS员工管理系统" class="headerlink" title="EMS员工管理系统"></a>EMS员工管理系统</h1><h2 id="数据库环境搭建"><a href="#数据库环境搭建" class="headerlink" title="数据库环境搭建"></a>数据库环境搭建</h2><p>该案例是EMS员工管理系统。使用了两张表：</p>
<ul>
<li>EMP员工信息表</li>
<li>EmpManager管理员表</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE EMP;</span><br><span class="line"></span><br><span class="line">USE EMP;</span><br><span class="line"></span><br><span class="line">CREATE TABLE EMP(</span><br><span class="line">	`id` INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	`name` VARCHAR(20) NOT NULL,</span><br><span class="line">	`salary` DOUBLE NOT NULL,</span><br><span class="line">	`age` INT NOT NULL</span><br><span class="line">)CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE EmpManager(</span><br><span class="line">	`username` VARCHAR(20) NOT NULL,</span><br><span class="line">	`password` VARCHAR(20) NOT NULL</span><br><span class="line">)CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO EMP(`name`, `salary`, `age`)</span><br><span class="line">VALUES(&#x27;xiaoA&#x27;, 2000, 20),(&#x27;xiaoB&#x27;, 4000, 22),(&#x27;xiaoC&#x27;, 3000, 21)</span><br><span class="line"></span><br><span class="line">INSERT INTO EmpManager(`username`, `password`)</span><br><span class="line">VALUES(&#x27;admin&#x27;, &#x27;123456&#x27;)</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="导入Maven依赖"><a href="#导入Maven依赖" class="headerlink" title="导入Maven依赖"></a>导入Maven依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-dbutils/commons-dbutils --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="编写数据库配置文件"><a href="#编写数据库配置文件" class="headerlink" title="编写数据库配置文件"></a>编写数据库配置文件</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span> = <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">jdbc:mysql://localhost:3306/EMP</span></span><br><span class="line"><span class="attr">username</span> = <span class="string">root</span></span><br><span class="line"><span class="attr">password</span> = <span class="string">123456</span></span><br><span class="line"><span class="attr">initialSize</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">maxActive</span> = <span class="string">20</span></span><br><span class="line"><span class="attr">minIdle</span> = <span class="string">5</span></span><br><span class="line"><span class="attr">maxWait</span> = <span class="string">3000</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建数据库工具类DbUtils"><a href="#创建数据库工具类DbUtils" class="headerlink" title="创建数据库工具类DbUtils"></a>创建数据库工具类DbUtils</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DruidDataSource ds;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; THREAD_LOCAL = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> DbUtils.class.getResourceAsStream(<span class="string">&quot;/db.properties&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(in);</span><br><span class="line">            ds = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> THREAD_LOCAL.get();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(conn == <span class="literal">null</span>)&#123;</span><br><span class="line">                conn = ds.getConnection();</span><br><span class="line">                THREAD_LOCAL.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            closeAll(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = getConnection();</span><br><span class="line">            conn.rollback();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            closeAll(conn, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection conn, Statement statement, ResultSet rs)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(rs != <span class="literal">null</span>)&#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(statement != <span class="literal">null</span>)&#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(conn != <span class="literal">null</span>)&#123;</span><br><span class="line">                conn.close();</span><br><span class="line">                THREAD_LOCAL.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> salary;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建数据库访问对象Dao"><a href="#创建数据库访问对象Dao" class="headerlink" title="创建数据库访问对象Dao"></a>创建数据库访问对象Dao</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpManagerDao</span> &#123;</span><br><span class="line">    EmpManager <span class="title function_">select</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br><span class="line">    Emp <span class="title function_">select</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建Dao实现类"><a href="#创建Dao实现类" class="headerlink" title="创建Dao实现类"></a>创建Dao实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManagerDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpManagerDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EmpManager <span class="title function_">select</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM empManager WHERE username=?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(EmpManager.class), username);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM emp;&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(Emp.class));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.update(DbUtils.getConnection(), <span class="string">&quot;DELETE FROM emp WHERE id=?&quot;</span>, id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.update(DbUtils.getConnection(), <span class="string">&quot;UPDATE emp SET name=?, salary=?, age=? WHERE id=?&quot;</span>, emp.getName(), emp.getSalary(), emp.getAge(), emp.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Emp <span class="title function_">select</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM emp WHERE id=?;&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanHandler</span>&lt;&gt;(Emp.class), id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建业务逻辑Service类"><a href="#创建业务逻辑Service类" class="headerlink" title="创建业务逻辑Service类"></a>创建业务逻辑Service类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpManagerService</span> &#123;</span><br><span class="line">    EmpManager <span class="title function_">login</span><span class="params">(String username, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">showAllEmp</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">removeEmp</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span>;</span><br><span class="line">    Emp <span class="title function_">showEmp</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建Service实现类"><a href="#创建Service实现类" class="headerlink" title="创建Service实现类"></a>创建Service实现类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManagerServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpManagerService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">EmpManagerDao</span> <span class="variable">empManagerDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpManagerDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EmpManager <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="type">EmpManager</span> <span class="variable">testManager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        DbUtils.begin();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">EmpManager</span> <span class="variable">manager</span> <span class="operator">=</span> empManagerDao.select(username);</span><br><span class="line">            <span class="keyword">if</span> (manager != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (manager.getPassword().equals(password))&#123;</span><br><span class="line">                    testManager = manager;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> testManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">EmpDao</span> <span class="variable">empDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">showAllEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            List&lt;Emp&gt; temp = empDao.selectAll();</span><br><span class="line">            <span class="keyword">if</span> (temp != <span class="literal">null</span>)&#123;</span><br><span class="line">                list = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeEmp</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            result = empDao.delete(id);</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEmp</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            result = empDao.update(emp);</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Emp <span class="title function_">showEmp</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            emp = empDao.select(id);</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> emp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建过滤器"><a href="#创建过滤器" class="headerlink" title="创建过滤器"></a>创建过滤器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/m/safe/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">EmpManager</span> <span class="variable">empManager</span> <span class="operator">=</span> (EmpManager) session.getAttribute(<span class="string">&quot;empManager&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (empManager != <span class="literal">null</span>)&#123;</span><br><span class="line">            filterChain.doFilter(req, resp);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;/login.html&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/m/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncodingFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        servletRequest.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        servletResponse.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建html页面"><a href="#创建html页面" class="headerlink" title="创建html页面"></a>创建html页面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/m/EmpManagerLoginController&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        用户名:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        密码:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        验证码:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;code&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/createCode&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建ServletController与JSP"><a href="#创建ServletController与JSP" class="headerlink" title="创建ServletController与JSP"></a>创建ServletController与JSP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/createCode&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateCodeController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">ValidateCode</span> <span class="variable">code</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ValidateCode</span>(<span class="number">200</span>, <span class="number">30</span>, <span class="number">4</span>, <span class="number">20</span>);</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;SetCode&quot;</span>, code.getCode());</span><br><span class="line">        code.write(resp.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/EmpManagerLoginController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpManagerLoginController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">inputCode</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">realCode</span> <span class="operator">=</span> (String)req.getSession().getAttribute(<span class="string">&quot;SetCode&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (inputCode != <span class="literal">null</span> &amp;&amp; inputCode.equalsIgnoreCase(realCode))&#123;</span><br><span class="line">            <span class="comment">// 输入正确则登录</span></span><br><span class="line">            <span class="type">EmpManagerService</span> <span class="variable">empManagerService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpManagerServiceImpl</span>();</span><br><span class="line">            <span class="type">EmpManager</span> <span class="variable">empManager</span> <span class="operator">=</span> empManagerService.login(username, password);</span><br><span class="line">            <span class="keyword">if</span> (empManager != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">// 账号验证成功 将账号信息存入Session</span></span><br><span class="line">                req.getSession().setAttribute(<span class="string">&quot;empManager&quot;</span>, empManager);</span><br><span class="line">                <span class="comment">// 跳转所有信息页面</span></span><br><span class="line">                resp.sendRedirect(<span class="string">&quot;/m/safe/showAllEmpController&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                resp.getWriter().write(<span class="string">&quot;&lt;script&gt;if(confirm(&#x27;Wrong password&#x27;))&#123;history.go(-1);window.location.reload();&#125;&lt;/script&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 输入错误则重新登录</span></span><br><span class="line">            resp.getWriter().write(<span class="string">&quot;&lt;script&gt;if(confirm(&#x27;Wrong Kaptcha&#x27;))&#123;history.go(-1);window.location.reload();&#125;&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="comment">//            resp.sendRedirect(&quot;/login.html&quot;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/showAllEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        List&lt;Emp&gt; list = empService.showAllEmp();</span><br><span class="line">        req.setAttribute(<span class="string">&quot;emps&quot;</span>, list);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/m/safe/showAllEmpJsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/showAllEmpJsp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllEmpJsp</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Emp&gt; list = (List&lt;Emp&gt;) req.getAttribute(<span class="string">&quot;emps&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="type">int</span>) session.getAttribute(<span class="string">&quot;delete&quot;</span>) &gt; <span class="number">0</span> &amp;&amp; session.getAttribute(<span class="string">&quot;delete&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">               writer.println(<span class="string">&quot;&lt;script&gt;alert(&#x27;删除成功&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">               session.removeAttribute(<span class="string">&quot;delete&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="type">int</span>) session.getAttribute(<span class="string">&quot;update&quot;</span>) &gt; <span class="number">0</span> &amp;&amp; session.getAttribute(<span class="string">&quot;update&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;script&gt;alert(&#x27;修改成功&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">                session.removeAttribute(<span class="string">&quot;update&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (list != <span class="literal">null</span>) &#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h1&gt;Welcome&lt;/h1&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;table border=&#x27;1&#x27; solid=&#x27;1&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;编号&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;姓名&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;工资&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td&gt;年龄&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;td colspan=&#x27;2&#x27;&gt;操作&lt;/td&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;tr&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + emp.getId() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + emp.getName() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + emp.getSalary() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&quot;</span> + emp.getAge() + <span class="string">&quot;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&lt;a href=&#x27;&quot;</span> + <span class="string">&quot;/m/safe/removeEmpController?id=&quot;</span> + emp.getId() + <span class="string">&quot;&#x27;&gt;删除&lt;/a&gt;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;td&gt;&lt;a href=&#x27;&quot;</span> + <span class="string">&quot;/m/safe/showEmpController?id=&quot;</span> + emp.getId() + <span class="string">&quot;&#x27;&gt;修改&lt;/a&gt;&lt;/td&gt;&quot;</span>);</span><br><span class="line">                writer.println(<span class="string">&quot;&lt;/tr&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;html&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;meta charset=&#x27;utf-8&#x27;&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;title&gt;显示所有&lt;/title&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/head&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;h2&gt;没有数据&lt;/h2&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/body&gt;&quot;</span>);</span><br><span class="line">            writer.println(<span class="string">&quot;&lt;/html&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/removeEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoveEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> empService.removeEmp(Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>)));</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;delete&quot;</span>, result);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/m/safe/showAllEmpController&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/showEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> empService.showEmp(id);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;emp&quot;</span>, emp);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/m/safe/showUpdateEmpInfoJsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/updateEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> Integer.parseInt(req.getParameter(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">double</span> <span class="variable">salary</span> <span class="operator">=</span> Double.parseDouble(req.getParameter(<span class="string">&quot;salary&quot;</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> Integer.parseInt(req.getParameter(<span class="string">&quot;age&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> req.getSession();</span><br><span class="line">        <span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> empService.updateEmp(<span class="keyword">new</span> <span class="title class_">Emp</span>(id, name, salary, age));</span><br><span class="line">        session.setAttribute(<span class="string">&quot;update&quot;</span>, update);</span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;/m/safe/showAllEmpController&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><p>在之前的Servlet中，服务器端通过Servlet响应客户端页面存在以下问题：</p>
<ul>
<li>开发方式麻烦：继承父类、覆盖方法、配置Web.xml或注解</li>
<li>代码修改麻烦：重新编译、部署、重启服务</li>
<li>显示方式麻烦：获取流、使用println()逐行打印</li>
<li>协同开发麻烦：UI负责美化页面，程序员负责编写代码。交接时麻烦。</li>
</ul>
<br/>

<p>概念</p>
<p>JSP(Java Server Pages)，简化的Servlet设计，在HTML标签中嵌套Java代码。用以高效的开发Web应用的动态网页。</p>
<br/>

<h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>替换显示页面部分的Servlet(使用xxx.jsp替换xxxJsp.java)。</p>
<br/>

<h1 id="JSP开发"><a href="#JSP开发" class="headerlink" title="JSP开发"></a>JSP开发</h1><h2 id="创建JSP"><a href="#创建JSP" class="headerlink" title="创建JSP"></a>创建JSP</h2><p>在Web目录下创建*.jsp文件(与WEB-INF同级)。</p>
<p><strong>JSP支持热部署，在配置中选择：</strong></p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325192419.png" alt="QQ20220325192419.png"></p>
<p><strong>导入依赖:</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>JSP编写Java代码：</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  Now:</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们发现与静态网页一样，JSP也能在网页中显示静态数据。我们修改代码：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  Now: &lt;%= <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>使用&lt;%&#x3D;%&gt;标签编写Java代码在页面中打印当前系统时间</strong></p>
<p>发现JSP被自动部署了，同时浏览器的页面也发生了变化。</p>
<br/>

<h2 id="JSP与Servlet"><a href="#JSP与Servlet" class="headerlink" title="JSP与Servlet"></a>JSP与Servlet</h2><ul>
<li><strong>关系</strong><ul>
<li>JSP文件在容器中会转换成Servlet执行</li>
<li>JSP是对Servlet的一种高级封装，本质还是Servlet</li>
</ul>
</li>
<li><strong>区别</strong><ul>
<li>JSP可以很方便地编写或者修改HTML页面而不用使用大量的println语句</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/Ssssv11/typora/raw/master/image-20220325103800512.png" alt="image-20220325103800512"></p>
<br/>

<h2 id="JSP实现原理"><a href="#JSP实现原理" class="headerlink" title="JSP实现原理"></a>JSP实现原理</h2><p>Tomcat会将xxx.jsp转换成Java代码，进而编译成.class文件运行，最终将运行结果通过response响应给客户端。</p>
<p><img src="C:\Users\Hxd\AppData\Roaming\Typora\typora-user-images\image-20220325104056591.png" alt="image-20220325104056591"></p>
<br/>

<h3 id="JSP-java源文件存放目录"><a href="#JSP-java源文件存放目录" class="headerlink" title="JSP.java源文件存放目录"></a>JSP.java源文件存放目录</h3><p>使用IDEA开发工具，Tomcat编译后的JSP文件存放目录：</p>
<p><code>C:\Users\Username\AppData\Local\JetBrains\IntelliJIdea2021.2\tomcat</code></p>
<p>我们找到编译后的文件打开：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">first_jsp</span> <span class="keyword">extends</span> <span class="title class_">org</span>.apache.jasper.runtime.HttpJspBase <span class="keyword">implements</span> <span class="title class_">org</span>.apache.jasper.runtime.JspSourceDependent,org.apache.jasper.runtime.JspSourceImports &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">_jspService</span><span class="params">(<span class="keyword">final</span> jakarta.servlet.http.HttpServletRequest request, <span class="keyword">final</span> jakarta.servlet.http.HttpServletResponse response)</span></span><br><span class="line">      <span class="keyword">throws</span> java.io.IOException, jakarta.servlet.ServletException &#123;&#125;</span><br><span class="line">    ...</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">      response.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">    </span><br><span class="line">      out = pageContext.getOut();</span><br><span class="line">      _jspx_out = out;</span><br><span class="line">		</span><br><span class="line">      out.write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;html&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;head&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;    &lt;title&gt;Title&lt;/title&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/head&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;body&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;  Now: &quot;</span>);</span><br><span class="line">      out.print( <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() );</span><br><span class="line">      out.write(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/body&gt;\r\n&quot;</span>);</span><br><span class="line">      out.write(<span class="string">&quot;&lt;/html&gt;\r\n&quot;</span>);</span><br><span class="line">      ...</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现，我们编写的first.jsp文件被转换成了一个first_jsp.java文件，而且它继承自HttpJspBase类(该类继承自HttpServlet)，同时也存在一个_jspService()方法。它帮助我们使用流将jsp文件中的标签进行了输出。</p>
<p><strong>因此，JSP的本质还是Servlet</strong></p>
<br/>

<h1 id="JSP与HTML集成开发"><a href="#JSP与HTML集成开发" class="headerlink" title="JSP与HTML集成开发"></a>JSP与HTML集成开发</h1><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>使用脚本可以编写Java语句、变量、方法或表达式</p>
<br/>

<h3 id="普通脚本"><a href="#普通脚本" class="headerlink" title="普通脚本"></a>普通脚本</h3><p><strong>语法: &lt;% Java代码 %&gt;</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%-- JSP中使用小脚本嵌入Java代码 --%&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(a);  <span class="comment">// 打印在控制台</span></span><br><span class="line">        out.println(a);        <span class="comment">// 打印在客户端页面</span></span><br><span class="line">    <span class="comment">// 在普通脚本中定义的变量为局部变量</span></span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<ul>
<li><strong>普通脚本中定义的变量是局部变量</strong></li>
<li><strong>普通脚本可以使用Java所有语法，除了定义方法(因为普通脚本本质上是一个Service方法)</strong></li>
<li><strong>脚本与脚本之间不可以嵌套，脚本与HTML标签不可以嵌套</strong></li>
</ul>
<br/>

<h3 id="声明脚本"><a href="#声明脚本" class="headerlink" title="声明脚本"></a>声明脚本</h3><p><strong>语法：&lt;%! 定义变量、方法 %&gt;</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>; %&gt;</span><br><span class="line">&lt;%! <span class="type">int</span> b, c, d; %&gt;</span><br><span class="line">&lt;%! <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); %&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;playing...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong></p>
<ul>
<li><strong>声明脚本中定义的变量是全局变量</strong></li>
<li><strong>声明脚本中的内容必须在普通脚本中进行调用</strong></li>
<li><strong>若声明脚本中方法有返回值，必须使用输出脚本调用</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;playing...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">m1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">101</span>;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    out.println(i);     <span class="comment">// 页面显示全局变量i</span></span><br><span class="line">    play();             <span class="comment">// 控制台打印</span></span><br><span class="line">    out.println(m1());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%= m1() %&gt;</span><br></pre></td></tr></table></figure>

<p>我们通过编译后的文件可以看到，<code>&lt;%= m1() %&gt;</code>其实被转换成了<code>out.print(m1());</code></p>
<br/>

<h3 id="输出脚本"><a href="#输出脚本" class="headerlink" title="输出脚本"></a>输出脚本</h3><p><strong>语法：&lt;%&#x3D; Java表达式 %&gt;</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= m1() %&gt;</span><br><span class="line">Today is: &lt;%= <span class="keyword">new</span> <span class="title class_">java</span>.util.Date() %&gt;</span><br><span class="line">&lt;%= <span class="string">&quot;What a Good Day&quot;</span> %&gt;</span><br><span class="line">&lt;%= <span class="number">100</span> %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><strong>输出脚本中不加分号(输出脚本中的内容在编译后被放入了<code>out.print</code>方法中)</strong></li>
<li><strong>输出脚本可以输出带有返回值的方法</strong></li>
</ul>
<br/>

<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>JSP中的注释主要有两个作用：脚本代码注释、HTML内容注释</p>
<table>
<thead>
<tr>
<th align="center">语法</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;%– 注释 –%&gt;</td>
<td align="center">JSP注释，不会被发送至浏览器不会被编译</td>
</tr>
<tr>
<td align="center">&lt;!– 注释 –&gt;</td>
<td align="center">HTML注释，可以通过浏览器查看到HTML注释</td>
</tr>
</tbody></table>
<br/>

<h2 id="JSP指令"><a href="#JSP指令" class="headerlink" title="JSP指令"></a>JSP指令</h2><p>JSP指令用来设置与整个JSP页面相关的属性。</p>
<table>
<thead>
<tr>
<th align="center">指令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&lt;%@ page… %&gt;</td>
<td align="center">定义页面的依赖属性，如脚本语言、error页面、缓存需求等</td>
</tr>
<tr>
<td align="center">&lt;%@ include… %&gt;</td>
<td align="center">包含其他文件</td>
</tr>
<tr>
<td align="center">&lt;%@ taglib… %&gt;</td>
<td align="center">引入标签库定义，可以是自定义标签</td>
</tr>
</tbody></table>
<br/>

<h3 id="page指令"><a href="#page指令" class="headerlink" title="page指令"></a>page指令</h3><p><strong>语法：&lt;%@ page attribute1&#x3D;”value1” attribute2&#x3D;”value2” %&gt;</strong></p>
<p>page指令为容器提供当前页面的使用说明。一个JSP页面可以包含多个page指令。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">contentType</td>
<td align="center">指定当前JSP页面的MIME类型和字符编码格式</td>
</tr>
<tr>
<td align="center">errorPage</td>
<td align="center">指定当JSP页面发送异常时需要跳转的错误处理页面</td>
</tr>
<tr>
<td align="center">isErrorPage</td>
<td align="center">指定当前页面是否可以作为另一个JSP页面的错误处理页面</td>
</tr>
<tr>
<td align="center">import</td>
<td align="center">导入要使用的Java类</td>
</tr>
<tr>
<td align="center">language</td>
<td align="center">定义JSP页面所使用的脚本语言，默认为Java</td>
</tr>
<tr>
<td align="center">session</td>
<td align="center">指定JSP页面是否使用Session。默认为true，立即创建；false为使用时创建。</td>
</tr>
<tr>
<td align="center">pageEncoding</td>
<td align="center">指定JSP页面的解码格式</td>
</tr>
</tbody></table>
<br/>

<h3 id="include指令"><a href="#include指令" class="headerlink" title="include指令"></a>include指令</h3><p><strong>语法：&lt;@ include file&#x3D;”被包含的JSP路径” %&gt;</strong></p>
<p>include指令为当前JSP页面指定包含的其他文件，被包含的文件可以是：</p>
<ul>
<li>JSP文件</li>
<li>HTML文件</li>
<li>文本文件</li>
</ul>
<p>被包含的文件就好像是当前JSP文件的一部分，会被同时编译执行(静态包含)。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ include file=<span class="string">&quot;header.jsp&quot;</span> %&gt;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&lt;%@ include file=<span class="string">&quot;footer.jsp&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：可以会有重名冲突问题，不建议使用。</strong></p>
<br/>

<h3 id="taglib指令"><a href="#taglib指令" class="headerlink" title="taglib指令"></a>taglib指令</h3><p><strong>语法：&lt;%@ taglib uri&#x3D;”外部标签库路径” prefix&#x3D;”前缀” %&gt;</strong></p>
<p>taglib指令可以引入JSP的标准标签库。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="动作标签"><a href="#动作标签" class="headerlink" title="动作标签"></a>动作标签</h2><p><strong>语法：&lt; jsp:action_name attribute&#x3D;”value” &#x2F;&gt;</strong></p>
<br/>

<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><p><strong>语法：&lt; jsp:include page&#x3D;”相对URL地址” &#x2F;&gt;</strong></p>
<p><code>&lt;jsp:include&gt;</code>动作元素会将外部文件输出结果包含在JSP中(动态包含)。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">page</td>
<td align="center">包含在页面中的相对URL地址</td>
</tr>
</tbody></table>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">&quot;index.jsp&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<ul>
<li><strong>JSP指令中的include指令是将外部文件的<u>输出代码</u>复制到了当前JSP文件中</strong></li>
<li><strong>jsp:include动作标签是将外部文件的<u>输出结果</u>引入到了当前JSP文件中</strong></li>
</ul>
<p>因此，使用<code>jsp:include</code>动作标签可以避免之前include指令中的重名问题。</p>
<br/>

<h3 id="useBean"><a href="#useBean" class="headerlink" title="useBean"></a>useBean</h3><p><strong>语法：&lt; jsp:useBean id&#x3D;”name” class&#x3D;”package.className” &#x2F;&gt;</strong></p>
<p><code>&lt;jsp:useBean&gt;</code>动作用来加载一个将在JSP页面中使用的JavaBean。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;per.hjc.entity.User&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p><strong>在类加载后，我们可以通过jsp:setProperty和jsp:getproperty动作来修改和获取bean的属性</strong></p>
<br/>

<h3 id="setProperty"><a href="#setProperty" class="headerlink" title="setProperty"></a>setProperty</h3><p>可以在<code>&lt;jsp:useBean&gt;</code>元素之后使用<code>&lt;jsp:setProperty&gt;</code>进行属性的赋值。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td align="center">name属性是必须的。它表示要设置哪个Bean的属性</td>
</tr>
<tr>
<td align="center">property</td>
<td align="center">property属性是必须的。它表示要设置Bean的哪个属性</td>
</tr>
<tr>
<td align="center">value</td>
<td align="center">value属性是可选的。它表示设置的属性的值</td>
</tr>
</tbody></table>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;per.hjc.entity.User&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;jsp:setProperty name=<span class="string">&quot;user&quot;</span> property=<span class="string">&quot;userName&quot;</span> value=<span class="string">&quot;xiaoA&quot;</span>/&gt;</span><br><span class="line">&lt;jsp:setProperty name=<span class="string">&quot;user&quot;</span> property=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="getProperty"><a href="#getProperty" class="headerlink" title="getProperty"></a>getProperty</h3><p>可以在<code>&lt;jsp:useBean&gt;</code>元素之后使用<code>&lt;jsp:getProperty&gt;</code>获取属性的值，转换成字符串输出。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">name</td>
<td align="center">name属性是必须的。它表示要获取哪个Bean的属性的值。Bean必须已定义</td>
</tr>
<tr>
<td align="center">property</td>
<td align="center">property属性是必须的。它表示要获取Bean的哪个属性的值</td>
</tr>
</tbody></table>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:useBean id=<span class="string">&quot;user&quot;</span> class=<span class="string">&quot;per.hjc.entity.User&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;jsp:getProperty name=<span class="string">&quot;user&quot;</span> property=<span class="string">&quot;userName&quot;</span>/&gt;</span><br><span class="line">&lt;jsp:getProperty name=<span class="string">&quot;user&quot;</span> property=<span class="string">&quot;password&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h3><p><strong>语法：&lt; jsp:forward page&#x3D;”相对URL地址” &#x2F;&gt;</strong></p>
<p><code>&lt;jsp:forward&gt;</code>动作把请求转到另外的页面。</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">page</td>
<td align="center">跳转到的相对URL地址</td>
</tr>
</tbody></table>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:forward page=<span class="string">&quot;pageB.jsp&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="param"><a href="#param" class="headerlink" title="param"></a>param</h3><p><strong>语法：&lt; jsp:param name&#x3D;”” value&#x3D;”” &#x2F;&gt;</strong></p>
<p><code>&lt;jsp:param&gt;</code>动作在转发的内部使用，做参数传递。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- pageA --&gt;</span><br><span class="line">&lt;jsp:forward page=<span class="string">&quot;pageB.jsp&quot;</span>&gt;</span><br><span class="line">	&lt;!-- 以Http请求方式做参数传递 --&gt;</span><br><span class="line">    &lt;jsp:param name=<span class="string">&quot;gender&quot;</span> value=<span class="string">&quot;male&quot;</span>/&gt;</span><br><span class="line">&lt;/jsp:forward&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- pageB --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%= gender %&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：需要使用<code>request.getParameter()</code>来获取传递的参数。</strong></p>
<br/>

<h2 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h2><p>内置对象指JSP中自动创建好的对象，可以直接使用。如上小节中的<code>request</code>。</p>
<table>
<thead>
<tr>
<th align="center">对象名</th>
<th align="center">类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>request</strong></td>
<td align="center">jakarta.servlet.http.HttpServletRequest</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>response</strong></td>
<td align="center">jakarta.servlet.http.HttpServletResponse</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>session</strong></td>
<td align="center">jakarta.servlet.http.HttpSession</td>
<td align="center">由session&#x3D;true开关</td>
</tr>
<tr>
<td align="center"><strong>application</strong></td>
<td align="center">jakarta.servlet.ServletContext</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">config</td>
<td align="center">jakarta.servlet.ServletConfig</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">exception</td>
<td align="center">java.lang.Throwable</td>
<td align="center">由isErrorPage&#x3D;false开关</td>
</tr>
<tr>
<td align="center">out</td>
<td align="center">jakarta.servlet.jsp.JspWriter</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>pageContext</strong></td>
<td align="center">jakarta.servlet.jsp.PageContext</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">java.lang.Object</td>
<td align="center">当前Servlet实例</td>
</tr>
</tbody></table>
<br/>

<h3 id="四大域对象"><a href="#四大域对象" class="headerlink" title="四大域对象"></a>四大域对象</h3><p>JSP有四大域对象，存储数据和获取数据的方式一样，不同的是取值范围。</p>
<ul>
<li>pageContext：当前JSP页面范围</li>
<li>request：一次请求有效</li>
<li>session：一次会话有效(关闭浏览器失效)</li>
<li>application：整个web应用有效(服务器重启或关闭失效)</li>
</ul>
<br/>

<h3 id="pageContext对象"><a href="#pageContext对象" class="headerlink" title="pageContext对象"></a>pageContext对象</h3><p>pageCgntext对象是jakarta.servlet.jsp.PageContext类的实例，拥有作用域，用来代表整个JSP页面。</p>
<ul>
<li>当前页面的作用域对象，一旦跳转则失效</li>
<li>通过setAttribute(“name”, value)存储值</li>
<li>通过getAttribute(“name”)获取值</li>
<li><strong>用于获取其他8个内置对象或者操作其他对象的作用域</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取其他内置对象 --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	pageContext.getRequest();			<span class="comment">// 返回request内置对象</span></span><br><span class="line">	pageContext.getResponse();			<span class="comment">// 返回response内置对象</span></span><br><span class="line">	pageContext.getServletConfig();		<span class="comment">// 返回config内置对象</span></span><br><span class="line">	pageContext.getException();			<span class="comment">// 返回exception内置对象</span></span><br><span class="line">	pageContext.getPage();				<span class="comment">// 返回page内置对象</span></span><br><span class="line">	pageContext.getOut();				<span class="comment">// 返回out内置对象</span></span><br><span class="line">	pageContext.getServletContext();	<span class="comment">// 返回application内置对象</span></span><br><span class="line">	pageContext.getSession();			<span class="comment">// 返回session内置对象</span></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>当无法直接获取这八个内置对象时，可以通过pageContext来获取。</p>
<br/>

<h4 id="pageContext操作其他内置对象的作用域"><a href="#pageContext操作其他内置对象的作用域" class="headerlink" title="pageContext操作其他内置对象的作用域"></a>pageContext操作其他内置对象的作用域</h4><p>通过pageContext的重载方法</p>
<ul>
<li><p><code>setAttribute(String s, Object o, int i)</code></p>
</li>
<li><p><code>getAttribute(String s, int i)</code></p>
</li>
</ul>
<p>可以对其他内置对象的作用域进行操作：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 操作其他内置对象的作用域--&gt;</span><br><span class="line">&lt;!-- 存值 --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	pageContext.setAttribute(<span class="string">&quot;page&quot;</span>, <span class="string">&quot;123&quot;</span>);	<span class="comment">// 当前JSP有效</span></span><br><span class="line">	pageContext.setAttribute(<span class="string">&quot;req&quot;</span>, <span class="string">&quot;aaa&quot;</span>, PageContext.REQUEST_SCOPE);	<span class="comment">// 一次请求有效</span></span><br><span class="line">	pageContext.setAttribute(<span class="string">&quot;sess&quot;</span>, <span class="string">&quot;ccc&quot;</span>, PageContext.SESSION_SCOPE);	<span class="comment">// 一次会话有效</span></span><br><span class="line">	pageContext.setAttribute(<span class="string">&quot;app&quot;</span>, <span class="string">&quot;ddd&quot;</span>, PageContext.APPLICATION_SCOPE);<span class="comment">// 整个web应用有效</span></span><br><span class="line">%&gt;</span><br><span class="line">&lt;!-- 取值 --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="type">String</span> <span class="variable">req</span> <span class="operator">=</span> (String) pageContext.getAttribute(<span class="string">&quot;req&quot;</span>, PageContext.REQUEST_SCOPE);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sess</span> <span class="operator">=</span> (String) pageContext.getAttribute(<span class="string">&quot;sess&quot;</span>, PageContext.SESSION_SCOPE);</span><br><span class="line">    <span class="type">String</span> <span class="variable">app</span> <span class="operator">=</span> (String) pageContext.getAttribute(<span class="string">&quot;app&quot;</span>, PageContext.APPLICATION_SCOPE);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;!-- 找值 --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) pageContext.findAttribute(<span class="string">&quot;app&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;!-- 逐个作用域遍历寻找值 顺序为: page - requst - session - application --&gt;</span><br></pre></td></tr></table></figure>

 <br/>

<h1 id="改进EMS系统1"><a href="#改进EMS系统1" class="headerlink" title="改进EMS系统1"></a>改进EMS系统1</h1><p>将EMS系统项目中所有显示页面JSP的Servlet替换成JSP页面，使用脚本进行显示。</p>
<p>显示所有员工的页面showAllEmp.jsp:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.List&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;per.hjc.entity.Emp&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;查询所有员工&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="type">int</span>)session.getAttribute(<span class="string">&quot;delete&quot;</span>) &gt; <span class="number">0</span> &amp;&amp; session.getAttribute(<span class="string">&quot;delete&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">    %&gt;</span><br><span class="line">        &lt;%=<span class="string">&quot;&lt;script&gt;alert(&#x27;删除成功&#x27;)&lt;/script&gt;&quot;</span>%&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">                session.removeAttribute(<span class="string">&quot;delete&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="type">int</span>)session.getAttribute(<span class="string">&quot;update&quot;</span>) &gt; <span class="number">0</span> &amp;&amp; session.getAttribute(<span class="string">&quot;update&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">    %&gt;</span><br><span class="line">        &lt;%=<span class="string">&quot;&lt;script&gt;alert(&#x27;更新成功&#x27;)&lt;/script&gt;&quot;</span>%&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">                session.removeAttribute(<span class="string">&quot;update&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;&#125;</span><br><span class="line">    %&gt;</span><br><span class="line"></span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;姓名&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;工资&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;年龄&lt;/td&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;操作&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            List&lt;Emp&gt; emps = (List&lt;Emp&gt;) request.getAttribute(<span class="string">&quot;emps&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Emp emp : emps) &#123;</span><br><span class="line">        %&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;&lt;%=emp.getId()%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;%=emp.getName()%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;%=emp.getSalary()%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;%=emp.getAge()%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href=<span class="string">&quot;&lt;%=request.getContextPath() + &quot;</span>/m/safe/removeEmpController?id=<span class="string">&quot; + emp.getId()%&gt;&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href=<span class="string">&quot;&lt;%=request.getContextPath() + &quot;</span>/m/safe/showEmpController?id=<span class="string">&quot; + emp.getId()%&gt;&quot;</span>&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">            &#125;</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>修改员工界面showUpdateEmpInfo.jsp:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;per.hjc.entity.Emp&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;修改员工&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> (Emp) request.getAttribute(<span class="string">&quot;emp&quot;</span>);</span><br><span class="line">    %&gt;</span><br><span class="line">    &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;/m/safe/updateEmpController&quot;</span>&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            编号:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;&lt;%=emp.getId()%&gt;&quot;</span> readonly&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            用户名:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;&lt;%=emp.getName()%&gt;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            工资:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;salary&quot;</span> value=<span class="string">&quot;&lt;%=emp.getSalary()%&gt;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            年龄:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;&lt;%=emp.getAge()%&gt;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>同时需要将ShowEmpController和ShowAllEmpController中转发的位置改变为新的jsp文件。</p>
<br/>

<h1 id="EL表达式-Expression-Language"><a href="#EL表达式-Expression-Language" class="headerlink" title="EL表达式(Expression Language)"></a>EL表达式(Expression Language)</h1><h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><p>EL表达式是为了使JSP写起来更加简单。它提供了在JSP中简化表达式的方法，让JSP的代码更加简化。主要同于获取作用域中的数据。</p>
<p>用于替换作用域对象.getAttribute(“name”);</p>
<p><strong>注意：Servlet2.3默认是不支持EL表达式的，可以修改web.xml中的web-app标签下的version属性为2.4以上：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="string"><span class="tag">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">metadata-complete</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="EL获取基本类型、字符串"><a href="#EL获取基本类型、字符串" class="headerlink" title="EL获取基本类型、字符串"></a>EL获取基本类型、字符串</h2><p><strong>语法：</strong></p>
<ul>
<li><strong>${scope.name} 获取具体某个作用域中的数据</strong></li>
<li><strong>&amp;{name} 获取作用域中的数据，逐级查找(pageContext-request-session-application)</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">  &lt;%</span><br><span class="line">      pageContext.setAttribute(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">      request.setAttribute(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>);</span><br><span class="line">      session.setAttribute(<span class="string">&quot;key3&quot;</span>, <span class="string">&quot;value3&quot;</span>);</span><br><span class="line">      application.setAttribute(<span class="string">&quot;key4&quot;</span>, <span class="string">&quot;value4&quot;</span>);</span><br><span class="line">  %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--通过作用域对象获取数据 --%&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%=pageContext.getAttribute(<span class="string">&quot;key1&quot;</span>)%&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%=request.getAttribute(<span class="string">&quot;key2&quot;</span>)%&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%=session.getAttribute(<span class="string">&quot;key3&quot;</span>)%&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%=application.getAttribute(<span class="string">&quot;key4&quot;</span>)%&gt;&lt;/h1&gt;</span><br><span class="line">  &lt;hr/&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- 通过EL表达式获取数据  --%&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;pageScope.key1&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;requestScope.key2&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;sessionScope.key3&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;applicationScope.key4&#125;&lt;/h1&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;key1&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;key2&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;key3&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;key4&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意：虽然使用${name}方式来获取数据非常简洁，但是当在不同作用域存在多个同名属性时，通过这个方式来找到的值永远是查找顺序更优先的作用域中的值。</strong></p>
<br/>

<h2 id="EL与JSP脚本的区别"><a href="#EL与JSP脚本的区别" class="headerlink" title="EL与JSP脚本的区别"></a>EL与JSP脚本的区别</h2><p><code>&lt;%=request.getAttribute(&quot;name&quot;)%&gt;</code> - 未找到返回null</p>
<p><code>$&#123;requestScope.name&#125;</code> - 未找到返回””</p>
<br/>

<h2 id="EL获取引用类型"><a href="#EL获取引用类型" class="headerlink" title="EL获取引用类型"></a>EL获取引用类型</h2><p>使用EL获取作用域中的对象调用属性时，<strong>只能访问对象的get方法</strong>，必须遵守命名规范定义。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;xiaoA&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">	request.setAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> request.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">	out.println(u.getUsername());</span><br><span class="line">	out.println(u.getPassword());</span><br><span class="line">%&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">	$&#123;u&#125;&lt;br/&gt;				&lt;%-- 返回u的地址 --%&gt;</span><br><span class="line">	$&#123;u.username&#125;&lt;br/&gt;		&lt;%-- 调用u的getUsername() --%&gt;</span><br><span class="line">	$&#123;u.password&#125;&lt;br/&gt;		&lt;%-- 返回u的getPassword() --%&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="EL获取数组、集合的元素"><a href="#EL获取数组、集合的元素" class="headerlink" title="EL获取数组、集合的元素"></a>EL获取数组、集合的元素</h2><p>EL可以获取Array、List、Map中的元素，Set由于没下标，无法直接访问元素，后续可遍历。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;arr&quot;</span>, arr);</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; nums = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    nums.add(<span class="string">&quot;A&quot;</span>); nums.add(<span class="string">&quot;B&quot;</span>); nums.add(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;nums&quot;</span>, nums);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, String&gt; maps = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    maps.put(<span class="string">&quot;CN&quot;</span>,<span class="string">&quot;中国&quot;</span>); maps.put(<span class="string">&quot;US&quot;</span>,<span class="string">&quot;美国&quot;</span>); maps.put(<span class="string">&quot;RU&quot;</span>,<span class="string">&quot;俄国&quot;</span>);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;maps&quot;</span>, maps);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">  &lt;%--  通过EL表达式访问数组--%&gt;</span><br><span class="line">    $&#123;arr[<span class="number">0</span>]&#125;&lt;br/&gt;          &lt;%-- <span class="number">1</span> --%&gt;</span><br><span class="line">    $&#123;arr[<span class="number">1</span>]&#125;&lt;br/&gt;          &lt;%-- <span class="number">2</span> --%&gt;</span><br><span class="line">    $&#123;arr[<span class="number">2</span>]&#125;&lt;br/&gt;          &lt;%-- <span class="number">3</span> --%&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">  &lt;%--  通过EL表达式访问List集合--%&gt;</span><br><span class="line">    $&#123;nums[<span class="number">0</span>]&#125;&lt;br/&gt;         &lt;%-- A --%&gt;</span><br><span class="line">    $&#123;nums[<span class="number">1</span>]&#125;&lt;br/&gt;         &lt;%-- B --%&gt;</span><br><span class="line">    $&#123;nums.get(<span class="number">2</span>)&#125;&lt;br/&gt;     &lt;%-- C --%&gt;</span><br><span class="line">    &lt;hr/&gt;</span><br><span class="line">  &lt;%--  通过EL表达式访问Map集合--%&gt;</span><br><span class="line">    $&#123;maps[<span class="number">0</span>]&#125;&lt;br/&gt;        &lt;%-- <span class="string">&quot;&quot;</span> --%&gt;</span><br><span class="line">    $&#123;maps[<span class="string">&quot;CN&quot;</span>]&#125;&lt;br/&gt;     &lt;%-- 中国 --%&gt;</span><br><span class="line">    $&#123;maps[<span class="string">&quot;US&quot;</span>]&#125;&lt;br/&gt;     &lt;%-- 美国 --%&gt;</span><br><span class="line">    $&#123;maps.RU&#125;&lt;br/&gt;        &lt;%-- 俄国 --%&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="EL运算符"><a href="#EL运算符" class="headerlink" title="EL运算符"></a>EL运算符</h2><p>EL表达式中的运算符与之前学习过的运算符相同，只是EL运算符有代替的关键字：</p>
<ul>
<li><p><code>+</code></p>
</li>
<li><p><code>-</code></p>
</li>
<li><p><code>*</code></p>
</li>
<li><p><code>/</code> - <code>div</code></p>
</li>
<li><p><code>%</code> - <code>mod</code></p>
</li>
<li><p><code>==</code> - <code>eq</code></p>
</li>
<li><p><code>!=</code> - <code>ne</code></p>
</li>
<li><p><code>&lt;</code> - <code>lt</code></p>
</li>
<li><p><code>&gt;</code> - <code>gt</code></p>
</li>
<li><p><code>&lt;=</code> - <code>le</code></p>
</li>
<li><p><code>&gt;</code> - <code>ge</code></p>
</li>
<li><p><code>&amp;&amp;</code> - <code>and</code></p>
</li>
<li><p><code>||</code> - <code>or</code></p>
</li>
<li><p><code>!</code> - <code>not</code></p>
</li>
<li><p><code>empty </code></p>
</li>
</ul>
<br/>

<h2 id="内置对象-1"><a href="#内置对象-1" class="headerlink" title="内置对象"></a>内置对象</h2><p>EL表达式语言定义了11个隐式对象。</p>
<table>
<thead>
<tr>
<th align="center">隐含对象</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">pageScope</td>
<td align="center">page作用域</td>
</tr>
<tr>
<td align="center">requestScope</td>
<td align="center">request作用域</td>
</tr>
<tr>
<td align="center">sessionScope</td>
<td align="center">session作用域</td>
</tr>
<tr>
<td align="center">applicationScope</td>
<td align="center">application作用域</td>
</tr>
<tr>
<td align="center">param</td>
<td align="center">Request对象的参数，字符串</td>
</tr>
<tr>
<td align="center">paramValues</td>
<td align="center">Request对象的参数，字符串集合</td>
</tr>
<tr>
<td align="center">header</td>
<td align="center">HTTP消息头，字符串</td>
</tr>
<tr>
<td align="center">headerValues</td>
<td align="center">HTTP消息头，字符串集合</td>
</tr>
<tr>
<td align="center">initParam</td>
<td align="center">上下文初始化参数</td>
</tr>
<tr>
<td align="center"><strong>cookie</strong></td>
<td align="center">Cookie值</td>
</tr>
<tr>
<td align="center"><strong>pageContext</strong></td>
<td align="center">当前页面的pageContext</td>
</tr>
</tbody></table>
<h3 id="获取应用上下文"><a href="#获取应用上下文" class="headerlink" title="获取应用上下文"></a>获取应用上下文</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%=request.getContextPath()%&gt;</span><br><span class="line"></span><br><span class="line">$&#123;pageContext.request.contextPath&#125;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="获取Cookie对象"><a href="#获取Cookie对象" class="headerlink" title="获取Cookie对象"></a>获取Cookie对象</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;%-- CookieServlet --%&gt;</span><br><span class="line">	<span class="type">Cookie</span> <span class="variable">cookie1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoA&quot;</span>);</span><br><span class="line">	<span class="type">Cookie</span> <span class="variable">cookie2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">	response.addCookie(cookie1);</span><br><span class="line">	response.addCookie(cookie1);</span><br><span class="line"></span><br><span class="line">&lt;%-- 获取Cookie --%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	Cookie[] cookies = request.getCookies();</span><br><span class="line">	String username, password;</span><br><span class="line">	<span class="keyword">if</span>(cookies != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(Cookie cookie : cookies)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName(),equals(<span class="string">&quot;username&quot;</span>))&#123;</span><br><span class="line">                username = cookie.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(<span class="string">&quot;password&quot;</span>))&#123;</span><br><span class="line">                password = cookie.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- EL获取Cookie --%&gt;</span><br><span class="line">	$&#123;cookie.username&#125;			&lt;%-- 获取名为username的cookie对象 --%&gt;</span><br><span class="line">	$&#123;cookie.username.value&#125;	&lt;%-- 获取名为username的cookie对象的值 --%&gt;</span><br><span class="line">	$&#123;cookie.password.value&#125;	&lt;%-- 获取名为password的cookie对象的值 --%&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="JSTL标准标签库"><a href="#JSTL标准标签库" class="headerlink" title="JSTL标准标签库"></a>JSTL标准标签库</h1><p>对于EL表达式:</p>
<ul>
<li>EL主要是用于作用域获取数据，虽然可以做运算判断，但是得到的都是一个结果做展示。</li>
<li>EL不存在流程控制。比如判断。</li>
<li>EL对于集合只能做单点访问，不能实现遍历操作。比如循环。</li>
</ul>
<p>因此，我们引入JSTL(Java Server Pages Standard Tag Library)</p>
<p>JSTL标准标签库是一个JSP标签集合。</p>
<br/>

<h2 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h2><p>可以对EL获取到的数据进行逻辑操作，与EL合作完成数据的展示。	</p>
<br/>

<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在JSP页面引入标签库:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="meta">@taglib</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h2 id="核心标签"><a href="#核心标签" class="headerlink" title="核心标签"></a>核心标签</h2><h3 id="JSTL条件判断"><a href="#JSTL条件判断" class="headerlink" title="JSTL条件判断"></a>JSTL条件判断</h3><p><strong>语法: &lt;c: if test&#x3D;”条件”&gt; &lt;&#x2F;c: if&gt;</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  	&lt;%-- test属性中为条件, 条件需要使用EL表达式书写 --%&gt; </span><br><span class="line">&lt;%</span><br><span class="line">       request.setAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;xiaoA&quot;</span>);</span><br><span class="line">   %&gt;</span><br><span class="line">   &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;username eq &#x27;xiaoA&#x27;&#125;&quot;</span>&gt;</span><br><span class="line">       &lt;h1&gt;Welcome, $&#123;username&#125;&lt;/h1&gt;</span><br><span class="line">   &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;%-- JSTL条件语句中没有<span class="keyword">else</span> --%&gt;</span><br><span class="line">   &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;username ne &#x27;xiaoA&#x27;&#125;&quot;</span>&gt;</span><br><span class="line">       &lt;h1&gt;Please Login Again&lt;/h1&gt;</span><br><span class="line">   &lt;/c:<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="多条件choose判断"><a href="#多条件choose判断" class="headerlink" title="多条件choose判断"></a>多条件choose判断</h3><p><strong>语法:</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">	&lt;c:when test=<span class="string">&quot;条件1&quot;</span>&gt;结果<span class="number">1</span>&lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;条件2&quot;</span>&gt;结果<span class="number">2</span>&lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;条件3&quot;</span>&gt;结果<span class="number">3</span>&lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;结果<span class="number">4</span>&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    request.setAttribute(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;18&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:choose&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;age lt 18&#125;&quot;</span>&gt;teenager&lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;age ge 18 and age le 40&#125;&quot;</span>&gt;adult&lt;/c:when&gt;</span><br><span class="line">    &lt;c:when test=<span class="string">&quot;$&#123;age gt 40&#125;&quot;</span>&gt;old&lt;/c:when&gt;</span><br><span class="line">    &lt;c:otherwise&gt;don know&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<p>可以利用choose判断实现if-else</p>
<br/>

<h3 id="迭代forEach标签"><a href="#迭代forEach标签" class="headerlink" title="迭代forEach标签"></a>迭代forEach标签</h3><p>**语法:  **</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">&quot;变量名&quot;</span> items=<span class="string">&quot;集合&quot;</span> begin=<span class="string">&quot;起始下标&quot;</span> </span><br><span class="line">           end=<span class="string">&quot;结束下标&quot;</span> step=<span class="string">&quot;间隔长度&quot;</span> varstatus=<span class="string">&quot;遍历状态&quot;</span>&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;A&quot;</span>); list.add(<span class="string">&quot;B&quot;</span>); list.add(<span class="string">&quot;C&quot;</span>); list.add(<span class="string">&quot;D&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;E&quot;</span>); list.add(<span class="string">&quot;F&quot;</span>); list.add(<span class="string">&quot;G&quot;</span>); list.add(<span class="string">&quot;H&quot;</span>);</span><br><span class="line">%&gt;    </span><br><span class="line">&lt;%-- varstatus: 变量状态,遍历出的每一行内容的状态 --%&gt;</span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">&quot;s&quot;</span> items=<span class="string">&quot;$&#123;list&#125;&quot;</span> varStatus=<span class="string">&quot;i&quot;</span>&gt;</span><br><span class="line">    &lt;h1&gt;$&#123;s&#125;&amp;nbsp;$&#123;i.first&#125;&amp;nbsp;$&#123;i.last&#125;&amp;nbsp;$&#123;i.count&#125;&amp;nbsp;$&#123;i.index&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<p>对于<code>varstatus</code>:</p>
<ul>
<li><p>first: 是否是第一行</p>
</li>
<li><p>last : 是否是最后一行</p>
</li>
<li><p>count: 当前个数</p>
</li>
<li><p>index: 当前元素在集合中的下标</p>
</li>
</ul>
<p><strong>遍历对象:</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    List&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayLsit</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;xiaoA&quot;</span>, <span class="string">&quot;123456&quot;</span>);list.add(<span class="string">&quot;xiaoB&quot;</span>, <span class="string">&quot;123456&quot;</span>);list.add(<span class="string">&quot;xiaoC&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">	list.add(<span class="string">&quot;xiaoD&quot;</span>, <span class="string">&quot;123456&quot;</span>);list.add(<span class="string">&quot;xiaoE&quot;</span>, <span class="string">&quot;123456&quot;</span>);list.add(<span class="string">&quot;xiaoF&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">	request.setAttribute(<span class="string">&quot;users&quot;</span>, list);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;c:forEach <span class="keyword">var</span>=<span class="string">&quot;user&quot;</span> item=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;h1&gt;[$&#123;user.username&#125;:$&#123;user.password&#125;]&lt;/h1&gt;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h3 id="url标签"><a href="#url标签" class="headerlink" title="url标签"></a>url标签</h3><p>在Cookie禁用的情况下，通过重写URL拼接JSESSIONID来传递ID值。便于下一次访问时仍可查找到上一次的Session对象。</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:url context=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;&quot;</span> value=<span class="string">&quot;/xxx&quot;</span>&gt;&lt;/c:url&gt;</span><br><span class="line"></span><br><span class="line">&lt;%-- 在form表单action中嵌套动态路径 --%&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;&lt;c:url context=&#x27;$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/xxx&#x27;&gt;&lt;/c:url&gt;&quot;</span>&gt;</span><br><span class="line">    ...</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意: 所有涉及到重定向与页面跳转的都应该使用URL重写.</strong></p>
<br/>

<h1 id="改进EMS系统2"><a href="#改进EMS系统2" class="headerlink" title="改进EMS系统2"></a>改进EMS系统2</h1><p>将EMS系统项目使用EL+JST替换脚体代码.</p>
<br/>

<h2 id="导入依赖配置环境"><a href="#导入依赖配置环境" class="headerlink" title="导入依赖配置环境"></a>导入依赖配置环境</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再在.jsp文件中加入taglib指令:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<h2 id="修改JSP页面"><a href="#修改JSP页面" class="headerlink" title="修改JSP页面"></a>修改JSP页面</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;查询所有员工&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;sessionScope.delete gt 0 and sessionScope.delete ne null&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;script&gt;alert(<span class="string">&#x27;删除成功&#x27;</span>)&lt;/script&gt;</span><br><span class="line">        &lt;%session.removeAttribute(<span class="string">&quot;update&quot;</span>);%&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;sessionScope.update gt 0 and sessionScope.update ne null&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;script&gt;alert(<span class="string">&#x27;更新成功&#x27;</span>)&lt;/script&gt;</span><br><span class="line">        &lt;%session.removeAttribute(<span class="string">&quot;update&quot;</span>);%&gt;</span><br><span class="line">    &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;编号&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;姓名&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;工资&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;年龄&lt;/td&gt;</span><br><span class="line">            &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;操作&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">        &lt;c:forEach <span class="keyword">var</span>=<span class="string">&quot;emp&quot;</span> items=<span class="string">&quot;$&#123;emps&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;$&#123;emp.id&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;emp.name&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;emp.salary&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;$&#123;emp.age&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/removeEmpController?id=$&#123;emp.id&#125;&#x27;&gt;&lt;/c:url&gt;&quot;</span>&gt;删除&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/showEmpController?id=$&#123;emp.id&#125;&#x27;&gt;&lt;/c:url&gt;&quot;</span>&gt;修改&lt;/a&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%@ taglib uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> prefix=<span class="string">&quot;c&quot;</span> %&gt;&lt;html&gt;</span><br><span class="line">&lt;%@ page isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;修改员工&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/updateEmpController&#x27;&gt;&lt;/c:url&gt;&quot;</span>&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            编号:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;$&#123;requestScope.emp.id&#125;&quot;</span> readonly&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            用户名:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;$&#123;requestScope.emp.name&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            工资:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;salary&quot;</span> value=<span class="string">&quot;$&#123;requestScope.emp.salary&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">            年龄:</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span> value=<span class="string">&quot;$&#123;requestScope.emp.age&#125;&quot;</span>&gt;</span><br><span class="line">        &lt;/label&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>在修改的过程中报出了异常:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jakarta.servlet.ServletException: </span><br><span class="line">	jakarta.servlet.jsp.JspTagException: </span><br><span class="line">		In URL tags, when the <span class="string">&quot;context&quot;</span> attribute is specified, values of both <span class="string">&quot;context&quot;</span> and <span class="string">&quot;url&quot;</span> must start with <span class="string">&quot;/&quot;</span>.</span><br></pre></td></tr></table></figure>

<p>需要在URL标签的context属性和value属性前都要加上”&#x2F;“，</p>
<p>如：<code>&lt;c:url context=&#39;/$&#123;pageContext.request.contextPath&#125;&#39;&gt;</code></p>
<p>另外注意要导入<code>&lt;%@ page isELIgnored=&quot;false&quot; %&gt;</code>。</p>
<br/>

<h1 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h1><h2 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h2><p>MVC(Model-View-Controller)编程模式是一种软件设计思想，将数据操作、页面展示、业务逻辑分为三个层级(模块)，独立完成，相互调用。</p>
<ul>
<li>模型层(Model)</li>
<li>视图(View)</li>
<li>控制器(Controller)</li>
</ul>
<br/>

<h2 id="MVC模式详解"><a href="#MVC模式详解" class="headerlink" title="MVC模式详解"></a>MVC模式详解</h2><p>MVC并不是Java独有的，现在几乎所有的B&#x2F;s的架构都采用了MC模式。</p>
<ul>
<li>视图View: 视图是用户看到并与之交互的界面，如HTML(静态资源)，JSP(动态资源)等。</li>
<li>控制器Controller: 控制器是控制请求的处理逻辑，对请求进行处理，负责流程跳转(转发和重定向)</li>
<li>模型Model: 对客观世界的一种代表和模拟(业务模拟、对象模拟)</li>
</ul>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325220302.png" alt="QQ20220325220302.png"></p>
<br/>

<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li>低耦合性: 模块与模块之间的关联性不强，不与某一种具体实现产生密不可分的关联性</li>
<li>高维护性: 基于低耦合性，可做到不同层级的功能模块灵活更换、插拔</li>
<li>高重用性: 相同的数据库操作，可以服务于不同的业务处理。将数据作为独立模块，提高重用性</li>
</ul>
<br/>

<h2 id="MVC在框架中应用"><a href="#MVC在框架中应用" class="headerlink" title="MVC在框架中应用"></a>MVC在框架中应用</h2><p>MVC模式被广泛用于Java的各种框架中，比如Struts2、SpringMVC等都用到了这种思想。</p>
<br/>

<h2 id="三层架构与MVC"><a href="#三层架构与MVC" class="headerlink" title="三层架构与MVC"></a>三层架构与MVC</h2><h3 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h3><p>View层(表示&#x2F;界面层)、Service层(业务逻辑层)、DAO层(数据访问层)</p>
<p><img src="https://s1.imagehub.cc/images/2022/03/25/QQ20220325221037.png" alt="QQ20220325221037.png"></p>
<br/>

<h3 id="MVC与三层架构的区别"><a href="#MVC与三层架构的区别" class="headerlink" title="MVC与三层架构的区别"></a>MVC与三层架构的区别</h3><p>MVC强调的是<strong>视图和业务代码的分离</strong>。严格的说MVC其实关注的是Web层。View就是单独的页面，如JSP、HTML等，不负责业务处理，只负责数据的展示。而数据封装到Model里，由Controller负责在V和M之间传递。MVC强调业务和视图分离。</p>
<p>三层架构是“数据访问层”、“业务逻辑层”、“表示层”，指的是代码之间的解耦，方便维护和复用。</p>
<br/>

<h1 id="改进EMS系统3"><a href="#改进EMS系统3" class="headerlink" title="改进EMS系统3"></a>改进EMS系统3</h1><h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p>分页是Web应用程序非常重要的一个技术。数据库中的数据可能是成千上万的，不可能把这么多的数据一次显示在浏览器上面。一般根据每行数据在页面上所占的空间设置每页显示若干行，比如一般20行是一个比较理想的显示状态。</p>
<br/>

<h2 id="分页实现思路"><a href="#分页实现思路" class="headerlink" title="分页实现思路"></a>分页实现思路</h2><p>对于海量的数据查询，需要多少就取多少，显然是最佳的解决方法，假如某个表中有200万条记录，第一页取前20条，第二页取21~40条记录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM 表名 LIMIT 0, 20;		# 第一页</span><br><span class="line">SELECT * FROM 表名 LIMIT 20, 20;		# 第二页</span><br><span class="line">SELECT * FROM 表名 LIMIT 40, 20;		# 第三页</span><br></pre></td></tr></table></figure>

<p>关于分页在MySQL笔记中有详细介绍。</p>
<br/>

<h2 id="分页代码实现"><a href="#分页代码实现" class="headerlink" title="分页代码实现"></a>分页代码实现</h2><p><strong>步骤：</strong></p>
<ol>
<li>确定每页显示的数据数量</li>
<li>确定分页显示所需总页数</li>
<li>编写SQL语句实现数据查询</li>
<li>在JSP页面中进行分页显示设置</li>
</ol>
<p>对于分页，我们需要考虑页码、页大小、数据总行数、总页数等属性，因此考虑将其封装为一个实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Page</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageIndex;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> totalCounts;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> totalPages;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> startRows;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认每页显示五条数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Page</span><span class="params">(<span class="type">int</span> pageIndex)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(pageIndex, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造时确定起始显示位置</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Page</span><span class="params">(<span class="type">int</span> pageIndex, <span class="type">int</span> pageSize)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pageSize = pageSize;</span><br><span class="line">        <span class="built_in">this</span>.pageIndex = pageIndex;	</span><br><span class="line">        <span class="built_in">this</span>.setStartRows((pageIndex - <span class="number">1</span>) * pageSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStartRows</span><span class="params">(<span class="type">int</span> startRows)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.startRows = startRows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确定总数据行数时确定总页数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalCounts</span><span class="params">(<span class="type">int</span> totalCounts)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.totalCounts = totalCounts;</span><br><span class="line">        <span class="built_in">this</span>.setTotalPages(totalCounts%pageSize == <span class="number">0</span> ? totalCounts/pageSize : totalCounts/pageSize+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<p><strong>Dao中增加：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">selectAll</span><span class="params">(Page page)</span>;</span><br><span class="line">    <span class="type">long</span> <span class="title function_">selectCount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Dao实现类实现方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">QueryRunner</span> <span class="variable">queryRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryRunner</span>();</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">selectAll</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT * FROM emp LIMIT ?,?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanListHandler</span>&lt;&gt;(Emp.class), page.getStartRows(), page.getPageSize());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">selectCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> queryRunner.query(DbUtils.getConnection(), <span class="string">&quot;SELECT count(*) FROM emp &quot;</span>, <span class="keyword">new</span> <span class="title class_">ScalarHandler</span>&lt;&gt;());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<p><strong>Service中增加：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    List&lt;Emp&gt; <span class="title function_">showAllEmp</span><span class="params">(Page page)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Service实现类实现方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">EmpDao</span> <span class="variable">empDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">showAllEmp</span><span class="params">(Page page)</span> &#123;</span><br><span class="line">        List&lt;Emp&gt; list = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            DbUtils.begin();</span><br><span class="line">            <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> empDao.selectCount();	<span class="comment">// 获取总数据行数</span></span><br><span class="line">            page.setTotalCounts((<span class="type">int</span>) count);</span><br><span class="line">            list = empDao.selectAll(page);</span><br><span class="line">            DbUtils.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            DbUtils.rollback();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<p><strong>controller：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/m/safe/showAllEmpController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShowAllEmpController</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 获取作用域中的页号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">pageIndex</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;pageIndex&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (pageIndex == <span class="literal">null</span>)&#123;	<span class="comment">// 第一次访问页面设置初始值</span></span><br><span class="line">            pageIndex = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Page</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(Integer.parseInt(pageIndex));<span class="comment">// 跳转到第pageIndex页</span></span><br><span class="line">        <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceImpl</span>();</span><br><span class="line">        List&lt;Emp&gt; list = empService.showAllEmp(page);</span><br><span class="line"></span><br><span class="line">        req.setAttribute(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">        req.setAttribute(<span class="string">&quot;emps&quot;</span>, list);</span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;/m/safe/showAllEmp.jsp&quot;</span>).forward(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br/>

<p><strong>在JSP中展示数据下方添加功能：</strong></p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td colspan=<span class="string">&quot;6&quot;</span>&gt;</span><br><span class="line">        &lt;%-- 点击跳转到第<span class="number">1</span>页 --%&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/showAllEmpController?pageIndex=1&#x27;/&gt;&quot;</span>&gt;首页&lt;/a&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;%-- 如果当前页&gt;<span class="number">1</span>，则可以跳转上一页 --%&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageIndex &gt; 1&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/showAllEmpController?pageIndex=$&#123;requestScope.page.pageIndex-1&#125;&#x27;/&gt;&quot;</span>&gt;上一页&lt;/a&gt;</span><br><span class="line">        &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;%-- 如果当前页==<span class="number">1</span>，则不能跳转 --%&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageIndex == 1&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;&quot;</span>&gt;上一页&lt;/a&gt;</span><br><span class="line">        &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;%-- 如果当前页&lt;总页数，则可以跳转下一页 --%&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageIndex &lt; requestScope.page.totalPages&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/showAllEmpController?pageIndex=$&#123;requestScope.page.pageIndex+1&#125;&#x27;/&gt;&quot;</span>&gt;下一页&lt;/a&gt;</span><br><span class="line">        &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;%-- 如果当前页==总页数，则不能跳转下一页 --%&gt;</span><br><span class="line">        &lt;c:<span class="keyword">if</span> test=<span class="string">&quot;$&#123;requestScope.page.pageIndex == requestScope.page.totalPages&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;a href=<span class="string">&quot;&quot;</span>&gt;下一页&lt;/a&gt;</span><br><span class="line">        &lt;/c:<span class="keyword">if</span>&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;%-- 跳转到最后一页 --%&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;&lt;c:url context=&#x27;/$&#123;pageContext.request.contextPath&#125;&#x27; value=&#x27;/m/safe/showAllEmpController?pageIndex=$&#123;requestScope.page.totalPages&#125;&#x27;/&gt;&quot;</span>&gt;尾页&lt;/a&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br></pre></td></tr></table></figure>

<br/>

<h1 id="ThymeLeaf"><a href="#ThymeLeaf" class="headerlink" title="ThymeLeaf"></a>ThymeLeaf</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>虽然JSP为我们带来了便捷，但是其缺点也是显而易见的，那么有没有一种既能实现模板，又能兼顾前后端分离的模板引擎呢？</p>
<p>Thymeleaf(百里香叶）是一个适用于Web和独立环境的现代化服务器端Java模板引擎，官方文档：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/index.html">https://www.thymeleaf.org/index.html</a></p>
<p>官网例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;msgs.headers.name&#125;&quot;</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">th:text</span>=<span class="string">&quot;#&#123;msgs.headers.price&#125;&quot;</span>&gt;</span>Price<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;prod: $&#123;allProducts&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;prod.name&#125;&quot;</span>&gt;</span>Oranges<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#numbers.formatDecimal(prod.price, 1, 2)&#125;&quot;</span>&gt;</span>0.99<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们可以在前端页面中填写占位符，而这些占位符的实际值则由后端进行提供，这样，我们就不用再像JSP那样前后端都写在一起了。</p>
<br/>

<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><img src="https://s1.imagehub.cc/images/2022/03/27/QQ20220327202517.png" alt="QQ20220327202517.png" style="zoom: 67%;" />

<br/>

<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建前端页面"><a href="#创建前端页面" class="headerlink" title="创建前端页面"></a>创建前端页面</h2><p>首先编写一个前端页面，名称为<code>test.html</code></p>
<p><strong>注意：</strong>要放在resource目录下，<strong>在html标签内部添加<code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code>引入Thymeleaf定义的标签属性</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h2 id="创建Servlet-2"><a href="#创建Servlet-2" class="headerlink" title="创建Servlet"></a>创建Servlet</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    TemplateEngine engine;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        engine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="type">ClassLoaderTemplateResolver</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoaderTemplateResolver</span>();</span><br><span class="line">        engine.setTemplateResolver(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        context.setVariable(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;我是标题&quot;</span>);</span><br><span class="line">        engine.process(<span class="string">&quot;test.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现，浏览器得到的页面，就是已经经过模板引擎解析好的页面，而我们的代码依然是后端处理数据，前端展示数据，因此使用Thymeleaf就能够使得当前Web应用程序的前后端划分更加清晰。</p>
<p>虽然Thymeleaf在一定程度上分离了前后端，但是其依然是在后台渲染HTML页面并发送给前端，并不是真正意义上的前后端分离。</p>
<br/>

<h2 id="Thymeleaf语法基础"><a href="#Thymeleaf语法基础" class="headerlink" title="Thymeleaf语法基础"></a>Thymeleaf语法基础</h2><h3 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h3><p>首先需要通过<code>TemplateEngine</code>对象来将模板文件渲染为最终的HTML页面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TemplateEngine engine;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    engine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">  	<span class="comment">//设定模板解析器决定了从哪里获取模板文件，这里直接使用ClassLoaderTemplateResolver表示加载内部资源文件</span></span><br><span class="line">    <span class="type">ClassLoaderTemplateResolver</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoaderTemplateResolver</span>();</span><br><span class="line">    engine.setTemplateResolver(r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此对象只需要创建一次之后可以一直使用。</p>
<p>然后使用模板引擎进行解析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">//创建上下文，上下文中包含了所有需要替换到模板中的内容</span></span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">    context.setVariable(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;我是标题&quot;</span>);</span><br><span class="line">    <span class="comment">//通过此方法可以直接解析模板并返回响应</span></span><br><span class="line">    engine.process(<span class="string">&quot;test.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们就可以在前端页面中通过上下文提供的内容，来将Java代码中的数据解析到前端页面。</p>
<br/>

<h3 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h3><h4 id="创建HTML"><a href="#创建HTML" class="headerlink" title="创建HTML"></a>创建HTML</h4><p>需要在html标签中添加：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样之后才能正确使用th:*形式的标签。</p>
<br/>

<h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><ol>
<li><strong>获取变量值 - ${…}</strong></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;Hello &#x27; + $&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.setVariable(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Thymeleaf&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>访问容器上下文环境中的变量</p>
<br/>

<ol start="2">
<li>*<em>选择表达式 - <em>{…}</em></em></li>
</ol>
<p>我们先创建一个User实体类，有id，name，gender三个属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;*&#123;gender&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.setVariable(<span class="string">&quot;user&quot;</span>, user);</span><br></pre></td></tr></table></figure>

<p>这里相当于是先使用th:object将user对象取出，然后在里面的th:text中获取user对象中的属性值。选择表达式计算的是选定的对象，而不是整个环境变量映射。</p>
<br/>

<ol start="3">
<li><strong>链接表达式 - @{…}</strong></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;../webapp/hello(id=$&#123;user.id&#125;)&#125;&quot;</span>&gt;</span>Single Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;../webapp/hello(id=$&#123;user.id&#125;, name=$&#123;user.name&#125;)&#125;&quot;</span>&gt;</span>Multiple Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;hello.html&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;../webapp/hello&#123;id&#125;/&#123;name&#125;(id=$&#123;user.id&#125;, name=$&#123;user.name&#125;)&#125;&quot;</span>&gt;</span>REST Style Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在浏览器查看源码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../webapp/hello?id=1&quot;</span>&gt;</span>Single Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../webapp/hello?id=1<span class="symbol">&amp;amp;</span>name=xiaoA&quot;</span>&gt;</span>Multiple Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../webapp/hello1/xiaoA&quot;</span>&gt;</span>REST Style Args<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h4 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h4><p><img src="https://s1.imagehub.cc/images/2022/03/27/1135580-20180224103013334-227020801.png" alt="1135580-20180224103013334-227020801.png"></p>
<br/>

<p><strong>th:text</strong></p>
<p>使用<code>th:text</code>来为当前标签指定内部文本</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong> 任何内容都会变成普通文本，即使传入了一个HTML代码。</p>
<br/>

<p><strong>th:utext</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:utext</span>=<span class="string">&quot;$&#123;title&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>th:utext</code>来为当前标签指定HTML文本</p>
<p>并且传入的title属性不仅仅只是一个字符串的值，而是一个字符串的引用。我们可以直接通过此引用调用相关的方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;title.toLowerCase()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样看来，Thymeleaf既能保持JSP为我们带来的便捷，也能兼顾前后端代码的界限划分。</p>
<br/>

<p><strong>th:url</strong></p>
<p>除了替换文本，它还支持替换一个元素的任意属性。</p>
<p><code>th:</code>能够拼接几乎所有的属性，只要使用了<code>th:属性名称</code>，属性的值就可以通过后端提供，如替换一张图片的链接：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">    context.setVariable(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;https://s1.imagehub.cc/images/2022/03/27/thymeleaf.png&quot;</span>);</span><br><span class="line">  	context.setVariable(<span class="string">&quot;alt&quot;</span>, <span class="string">&quot;加载失败&quot;</span>);</span><br><span class="line">    engine.process(<span class="string">&quot;test.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">width</span>=<span class="string">&quot;700&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span> <span class="attr">th:alt</span>=<span class="string">&quot;$&#123;alt&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<p>Thymeleaf还可以进行一些算术运算，几乎Java中的运算它都可以支持：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;value % 2&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同样的，它还支持三元运算：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;value % 2 == 0 ? &#x27;even&#x27; : &#x27;odd&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>多个属性也可以通过<code>+</code>进行拼接，就像Java中的字符串拼接一样:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;+&#x27; 我是文本 &#x27;+$&#123;value&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>**注意: **字符串不能直接写，要添加单引号。</p>
<br/>

<h3 id="Thymeleaf流程控制语法"><a href="#Thymeleaf流程控制语法" class="headerlink" title="Thymeleaf流程控制语法"></a>Thymeleaf流程控制语法</h3><p>除了一些基本的操作，还可以使用Thymeleaf来处理流程控制语句。</p>
<h4 id="th-if"><a href="#th-if" class="headerlink" title="th:if"></a>th:if</h4><p>如果if条件满足，则此标签留下，若if条件不满足，则此标签自动被移除：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">    context.setVariable(<span class="string">&quot;eval&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    engine.process(<span class="string">&quot;test.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;eval&#125;&quot;</span>&gt;</span>我是判断条件标签<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>th:if</code>会根据其中传入的值或是条件表达式的结果进行判断，只有满足的情况下，才会显示此标签，具体的判断规则如下：</p>
<ul>
<li><p>如果值不是空的：</p>
<ul>
<li>如果值是布尔值并且为true。</li>
<li>如果值是一个数字，并且是非零</li>
<li>如果值是一个字符，并且是非零</li>
<li>如果值是一个字符串，且不是”错误”、”关闭”或”否”</li>
<li>如果值不是布尔值、数字、字符或字符串。</li>
</ul>
</li>
<li><p>如果值为空，<code>th:if</code>将计算为false</p>
</li>
</ul>
<p><code>th:if</code>还有一个相反的属性<code>th:unless</code>，效果完全相反，这里就不演示了。</p>
<br/>

<h4 id="th-switch"><a href="#th-switch" class="headerlink" title="th:switch"></a>th:switch</h4><p>多分支条件判断:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:switch</span>=<span class="string">&quot;$&#123;eval&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:case</span>=<span class="string">&quot;1&quot;</span>&gt;</span>我是1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:case</span>=<span class="string">&quot;2&quot;</span>&gt;</span>我是2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:case</span>=<span class="string">&quot;3&quot;</span>&gt;</span>我是3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>没有Default属性，但是可以使用<code>th:case=&quot;*&quot;</code>来代替：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:case</span>=<span class="string">&quot;*&quot;</span>&gt;</span>我是Default<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<h4 id="th-each"><a href="#th-each" class="headerlink" title="th:each"></a>th:each</h4><p>实现遍历：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">    context.setVariable(<span class="string">&quot;list&quot;</span>, Arrays.asList(<span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C/C++&quot;</span>, <span class="string">&quot;Python&quot;</span>, <span class="string">&quot;JavaScript&quot;</span>));</span><br><span class="line">    engine.process(<span class="string">&quot;test.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;title : $&#123;list&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;&#x27;《&#x27;+$&#123;title&#125;+&#x27;》&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>th:each</code>中需要填写**”单个元素名称: ${列表}”**。这样所有的列表项都可以使用遍历的单个元素，只要使用了<code>th:each</code>，都会被循环添加。因此最后生成的结果为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们还可以获取当前循环的迭代状态，只需要在最后添加<code>iterStat</code>即可，从中可以获取很多信息，比如当前的顺序：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;title, iterStat : $&#123;list&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;iterStat.index&#125;+&#x27;.《&#x27;+$&#123;title&#125;+&#x27;》&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>状态变量在th:each属性中定义，并包含以下数据：</p>
<ul>
<li>当前迭代索引，以0开头。这是index属性。</li>
<li>当前迭代索引，以1开头。这是count属性。</li>
<li>迭代变量中的元素总量。这是size属性。</li>
<li>每个迭代的迭代变量。这是current属性。</li>
<li>当前迭代是偶数还是奇数。这些是even&#x2F;odd布尔属性。</li>
<li>当前迭代是否是第一个迭代。这是first布尔属性。</li>
<li>当前迭代是否是最后一个迭代。这是last布尔属性。</li>
</ul>
<br/>

<h3 id="Thymeleaf模板布局"><a href="#Thymeleaf模板布局" class="headerlink" title="Thymeleaf模板布局"></a>Thymeleaf模板布局</h3><p>在某些网页中，整个网站的页面除了中间部分的内容会随着我们的页面跳转而变化外，有些部分是一直保持一个状态的。</p>
<p>Thymeleaf就可以轻松实现这样的操作，我们只需要将不会改变的地方设定为模板布局，并在不同的页面中插入这些模板布局，就无需每个页面都去编写同样的内容了。现在我们来创建两个页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题内容，每个页面都有<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;title, iterStat : $&#123;list&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;iterStat.index+1&#125;+&#x27;.《&#x27;+$&#123;title&#125;+&#x27;》&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题内容，每个页面都有<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>这个页面的样子是这样的<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>将模板引擎写成工具类的形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> TemplateEngine engine;</span><br><span class="line">    <span class="keyword">static</span>  &#123;</span><br><span class="line">        engine = <span class="keyword">new</span> <span class="title class_">TemplateEngine</span>();</span><br><span class="line">        <span class="type">ClassLoaderTemplateResolver</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoaderTemplateResolver</span>();</span><br><span class="line">        r.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        engine.setTemplateResolver(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TemplateEngine <span class="title function_">getEngine</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageServlet1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        context.setVariable(<span class="string">&quot;list&quot;</span>, Arrays.asList(<span class="string">&quot;Java&quot;</span>, <span class="string">&quot;C/C++&quot;</span>, <span class="string">&quot;Python&quot;</span>, <span class="string">&quot;JavaScript&quot;</span>));</span><br><span class="line">        ThymeleafUtil.getEngine().process(<span class="string">&quot;page1.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">pageServlet2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        ThymeleafUtil.getEngine().process(<span class="string">&quot;page2.html&quot;</span>, context, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在就有两个Servlet分别对应两个页面了，但是这两个页面实际上是存在重复内容的，我们要做的就是将这些重复内容提取出来。</p>
<p>我们单独编写一个<code>head.html</code>来存放重复部分：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;head-title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题内容，每个页面都有<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在就可以直接将页面中的内容快速替换：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;head.html::head-title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;title, iterStat : $&#123;list&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;iterStat.index+1&#125;+&#x27;.《&#x27;+$&#123;title&#125;+&#x27;》&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以使用<code>th:insert</code>和<code>th:replace</code>和<code>th:include</code>这三种方法来进行页面内容替换。</p>
<ul>
<li><code>th:insert</code> - 它只会插入指定的片段作为标签的主体。</li>
<li><code>th:replace</code> - 实际上将标签直接替换为指定的片段。</li>
<li><code>th:include</code> - 与<code>th:insert</code>相似，但没有插入片段，而是只插入此片段的内容。</li>
</ul>
<p>它还支持参数传递，比如我们现在希望插入二级标题，并且由我们的子页面决定：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;head-title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题内容，每个页面都有<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>二级标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加一个参数名称：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;head&quot;</span> <span class="attr">th:fragment</span>=<span class="string">&quot;head-title(sub)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题内容，每个页面都有<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;sub&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在替换位置添加一个参数：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;head.html::head-title(&#x27;Page1&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">th:each</span>=<span class="string">&quot;title, iterStat : $&#123;list&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;iterStat.index&#125;+&#x27;.《&#x27;+$&#123;title&#125;+&#x27;》&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;head.html::head-title(&#x27;Page2&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>这个页面的样子是这样的<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样，不同的页面还有着各自的二级标题。</p>
<br/>

<h1 id="Tomcat类加载机制"><a href="#Tomcat类加载机制" class="headerlink" title="Tomcat类加载机制"></a>Tomcat类加载机制</h1><p>Tomcat服务器既然要同时运行多个Web应用程序，那么就必须要实现不同应用程序之间的隔离。</p>
<p>也就是说，Tomcat需要分别去加载不同应用程序的类以及依赖，还必须保证应用程序之间的类无法相互访问，而传统的类加载机制无法做到这一点。</p>
<p>同时每个应用程序都有自己的依赖，如果两个应用程序使用了同一个版本的同一个依赖，那么还有必要去重新加载吗？</p>
<p>Tomcat服务器编写了一套自己的类加载机制。</p>
<img src="https://s1.imagehub.cc/images/2022/03/27/32211c0d654a3a2cd0d0c6a00fe2ebf8.png" alt="32211c0d654a3a2cd0d0c6a00fe2ebf8.png" style="zoom:80%;" />



<p>Tomcat本身也是一个Java程序，它要做的是去动态加载我们编写的Web应用程序中的类，而要解决以上提到的一些问题，就出现了几个新的类加载器，我们来看看各个加载器的不同之处：</p>
<ul>
<li>Common ClassLoader：Tomcat最基本的类加载器，加载路径中的class可以被Tomcat容器本身以及各个Web应用程序访问。</li>
<li>Catalina ClassLoader：Tomcat容器私有的类加载器，加载路径中的class对于Web应用程序不可见。</li>
<li>Shared ClassLoader：各个Web应用程序共享的类加载器，加载路径中的class对于所有Web应用程序可见，但是对于Tomcat容器不可见。</li>
<li>Webapp ClassLoader：各个Web应用程序私有的类加载器，加载路径中的class只对当前Web应用程序可见，每个Web应用程序都有一个自己的类加载器，此加载器可能存在多个实例。</li>
<li>JasperLoader：JSP类加载器，每个JSP文件都有一个自己的类加载器，也就是说，此加载器可能会存在多个实例。</li>
</ul>
<p>通过这样进行划分，就很好地解决了上面所提到的问题。</p>
<p>但是这样的类加载机制，破坏了JVM的双亲委派机制，比如Webapp ClassLoader，它只加载自己的class文件，它没有将类交给父类加载器进行加载。</p>
<p>实际上，WebAppClassLoader的加载机制是：</p>
<p><strong>WebAppClassLoader加载类的时候，绕开了AppClassLoader，直接先使用ExtClassLoader来加载类。</strong></p>
<p>这样如果定义了同包同名的类，就不会被加载，而如果是自己定义的类，由于该类并不是JDK内部或是扩展类所以不会被加载，而是再次回到WebAppClassLoader进行加载。如果仍失败再使用AppClassloader进行加载。</p>
<img src="https://s1.imagehub.cc/images/2022/03/27/f6a715e576e334b524fbc08eca5a8a32.jpg" alt="f6a715e576e334b524fbc08eca5a8a32.jpg" style="zoom:80%;" />

<br/>

<p>end</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button onclick="document.querySelector('.post-reward').classList.toggle('active');">
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ssssv11 WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/JavaWeb/" rel="tag"># JavaWeb</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/29/Maven/" rel="prev" title="Maven">
                  <i class="fa fa-chevron-left"></i> Maven
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04/29/Mybatis/" rel="next" title="Mybatis">
                  Mybatis <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ssssv11</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script size="90" alpha="0.6" zIndex="-1" src="/js/ribbon/ribbon.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>

<script src="/js/cursor/fireworks.js"></script>

